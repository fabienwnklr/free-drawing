var xa=Object.defineProperty;var Ea=(J,rt,ot)=>rt in J?xa(J,rt,{enumerable:!0,configurable:!0,writable:!0,value:ot}):J[rt]=ot;var m=(J,rt,ot)=>(Ea(J,typeof rt!="symbol"?rt+"":rt,ot),ot),Ki=(J,rt,ot)=>{if(!rt.has(J))throw TypeError("Cannot "+ot)};var st=(J,rt,ot)=>(Ki(J,rt,"read from private field"),ot?ot.call(J):rt.get(J)),Mt=(J,rt,ot)=>{if(rt.has(J))throw TypeError("Cannot add the same private member more than once");rt instanceof WeakSet?rt.add(J):rt.set(J,ot)},Et=(J,rt,ot,se)=>(Ki(J,rt,"write to private field"),se?se.call(J,ot):rt.set(J,ot),ot);var Drawer=function(J){var Rt,ee,Wt,ie,re,Yt,Xt,me;"use strict";const rt="";var ot=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},se={},ct={},ht={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a._registerNode=a.Konva=a.glob=void 0;const t=Math.PI/180;function e(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}a.glob=typeof ot<"u"?ot:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},a.Konva={_global:a.glob,version:"9.3.1",isBrowser:e(),isUnminified:/param/.test((function(r){}).toString()),dblClickWindow:400,getAngle(r){return a.Konva.angleDeg?r*t:r},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return a.Konva.DD.isDragging},isDragReady(){return!!a.Konva.DD.node},releaseCanvasOnDestroy:!0,document:a.glob.document,_injectGlobal(r){a.glob.Konva=r}};const i=r=>{a.Konva[r.prototype.getClassName()]=r};a._registerNode=i,a.Konva._injectGlobal(a.Konva)})(ht),function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.Util=a.Transform=void 0;const t=ht;class e{constructor(d=[1,0,0,1,0,0]){this.dirty=!1,this.m=d&&d.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new e(this.m)}copyInto(d){d.m[0]=this.m[0],d.m[1]=this.m[1],d.m[2]=this.m[2],d.m[3]=this.m[3],d.m[4]=this.m[4],d.m[5]=this.m[5]}point(d){var p=this.m;return{x:p[0]*d.x+p[2]*d.y+p[4],y:p[1]*d.x+p[3]*d.y+p[5]}}translate(d,p){return this.m[4]+=this.m[0]*d+this.m[2]*p,this.m[5]+=this.m[1]*d+this.m[3]*p,this}scale(d,p){return this.m[0]*=d,this.m[1]*=d,this.m[2]*=p,this.m[3]*=p,this}rotate(d){var p=Math.cos(d),C=Math.sin(d),T=this.m[0]*p+this.m[2]*C,f=this.m[1]*p+this.m[3]*C,E=this.m[0]*-C+this.m[2]*p,v=this.m[1]*-C+this.m[3]*p;return this.m[0]=T,this.m[1]=f,this.m[2]=E,this.m[3]=v,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(d,p){var C=this.m[0]+this.m[2]*p,T=this.m[1]+this.m[3]*p,f=this.m[2]+this.m[0]*d,E=this.m[3]+this.m[1]*d;return this.m[0]=C,this.m[1]=T,this.m[2]=f,this.m[3]=E,this}multiply(d){var p=this.m[0]*d.m[0]+this.m[2]*d.m[1],C=this.m[1]*d.m[0]+this.m[3]*d.m[1],T=this.m[0]*d.m[2]+this.m[2]*d.m[3],f=this.m[1]*d.m[2]+this.m[3]*d.m[3],E=this.m[0]*d.m[4]+this.m[2]*d.m[5]+this.m[4],v=this.m[1]*d.m[4]+this.m[3]*d.m[5]+this.m[5];return this.m[0]=p,this.m[1]=C,this.m[2]=T,this.m[3]=f,this.m[4]=E,this.m[5]=v,this}invert(){var d=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),p=this.m[3]*d,C=-this.m[1]*d,T=-this.m[2]*d,f=this.m[0]*d,E=d*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),v=d*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=p,this.m[1]=C,this.m[2]=T,this.m[3]=f,this.m[4]=E,this.m[5]=v,this}getMatrix(){return this.m}decompose(){var d=this.m[0],p=this.m[1],C=this.m[2],T=this.m[3],f=this.m[4],E=this.m[5],v=d*T-p*C;let _={x:f,y:E,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(d!=0||p!=0){var P=Math.sqrt(d*d+p*p);_.rotation=p>0?Math.acos(d/P):-Math.acos(d/P),_.scaleX=P,_.scaleY=v/P,_.skewX=(d*C+p*T)/v,_.skewY=0}else if(C!=0||T!=0){var S=Math.sqrt(C*C+T*T);_.rotation=Math.PI/2-(T>0?Math.acos(-C/S):-Math.acos(C/S)),_.scaleX=v/S,_.scaleY=S,_.skewX=0,_.skewY=(d*C+p*T)/v}return _.rotation=a.Util._getRotation(_.rotation),_}}a.Transform=e;var i="[object Array]",r="[object Number]",n="[object String]",s="[object Boolean]",o=Math.PI/180,l=180/Math.PI,c="#",g="",w="0",y="Konva warning: ",x="Konva error: ",L="rgb(",k={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},M=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,$=[];const U=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(h){setTimeout(h,60)};a.Util={_isElement(h){return!!(h&&h.nodeType==1)},_isFunction(h){return!!(h&&h.constructor&&h.call&&h.apply)},_isPlainObject(h){return!!h&&h.constructor===Object},_isArray(h){return Object.prototype.toString.call(h)===i},_isNumber(h){return Object.prototype.toString.call(h)===r&&!isNaN(h)&&isFinite(h)},_isString(h){return Object.prototype.toString.call(h)===n},_isBoolean(h){return Object.prototype.toString.call(h)===s},isObject(h){return h instanceof Object},isValidSelector(h){if(typeof h!="string")return!1;var d=h[0];return d==="#"||d==="."||d===d.toUpperCase()},_sign(h){return h===0||h>0?1:-1},requestAnimFrame(h){$.push(h),$.length===1&&U(function(){const d=$;$=[],d.forEach(function(p){p()})})},createCanvasElement(){var h=document.createElement("canvas");try{h.style=h.style||{}}catch{}return h},createImageElement(){return document.createElement("img")},_isInDocument(h){for(;h=h.parentNode;)if(h==document)return!0;return!1},_urlToImage(h,d){var p=a.Util.createImageElement();p.onload=function(){d(p)},p.src=h},_rgbToHex(h,d,p){return(16777216+(h<<16)+(d<<8)+p).toString(16).slice(1)},_hexToRgb(h){h=h.replace(c,g);var d=parseInt(h,16);return{r:d>>16&255,g:d>>8&255,b:d&255}},getRandomColor(){for(var h=(Math.random()*16777215<<0).toString(16);h.length<6;)h=w+h;return c+h},getRGB(h){var d;return h in k?(d=k[h],{r:d[0],g:d[1],b:d[2]}):h[0]===c?this._hexToRgb(h.substring(1)):h.substr(0,4)===L?(d=M.exec(h.replace(/ /g,"")),{r:parseInt(d[1],10),g:parseInt(d[2],10),b:parseInt(d[3],10)}):{r:0,g:0,b:0}},colorToRGBA(h){return h=h||"black",a.Util._namedColorToRBA(h)||a.Util._hex3ColorToRGBA(h)||a.Util._hex4ColorToRGBA(h)||a.Util._hex6ColorToRGBA(h)||a.Util._hex8ColorToRGBA(h)||a.Util._rgbColorToRGBA(h)||a.Util._rgbaColorToRGBA(h)||a.Util._hslColorToRGBA(h)},_namedColorToRBA(h){var d=k[h.toLowerCase()];return d?{r:d[0],g:d[1],b:d[2],a:1}:null},_rgbColorToRGBA(h){if(h.indexOf("rgb(")===0){h=h.match(/rgb\(([^)]+)\)/)[1];var d=h.split(/ *, */).map(Number);return{r:d[0],g:d[1],b:d[2],a:1}}},_rgbaColorToRGBA(h){if(h.indexOf("rgba(")===0){h=h.match(/rgba\(([^)]+)\)/)[1];var d=h.split(/ *, */).map((p,C)=>p.slice(-1)==="%"?C===3?parseInt(p)/100:parseInt(p)/100*255:Number(p));return{r:d[0],g:d[1],b:d[2],a:d[3]}}},_hex8ColorToRGBA(h){if(h[0]==="#"&&h.length===9)return{r:parseInt(h.slice(1,3),16),g:parseInt(h.slice(3,5),16),b:parseInt(h.slice(5,7),16),a:parseInt(h.slice(7,9),16)/255}},_hex6ColorToRGBA(h){if(h[0]==="#"&&h.length===7)return{r:parseInt(h.slice(1,3),16),g:parseInt(h.slice(3,5),16),b:parseInt(h.slice(5,7),16),a:1}},_hex4ColorToRGBA(h){if(h[0]==="#"&&h.length===5)return{r:parseInt(h[1]+h[1],16),g:parseInt(h[2]+h[2],16),b:parseInt(h[3]+h[3],16),a:parseInt(h[4]+h[4],16)/255}},_hex3ColorToRGBA(h){if(h[0]==="#"&&h.length===4)return{r:parseInt(h[1]+h[1],16),g:parseInt(h[2]+h[2],16),b:parseInt(h[3]+h[3],16),a:1}},_hslColorToRGBA(h){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(h)){const[d,...p]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(h),C=Number(p[0])/360,T=Number(p[1])/100,f=Number(p[2])/100;let E,v,_;if(T===0)return _=f*255,{r:Math.round(_),g:Math.round(_),b:Math.round(_),a:1};f<.5?E=f*(1+T):E=f+T-f*T;const P=2*f-E,S=[0,0,0];for(let O=0;O<3;O++)v=C+.3333333333333333*-(O-1),v<0&&v++,v>1&&v--,6*v<1?_=P+(E-P)*6*v:2*v<1?_=E:3*v<2?_=P+(E-P)*(.6666666666666666-v)*6:_=P,S[O]=_*255;return{r:Math.round(S[0]),g:Math.round(S[1]),b:Math.round(S[2]),a:1}}},haveIntersection(h,d){return!(d.x>h.x+h.width||d.x+d.width<h.x||d.y>h.y+h.height||d.y+d.height<h.y)},cloneObject(h){var d={};for(var p in h)this._isPlainObject(h[p])?d[p]=this.cloneObject(h[p]):this._isArray(h[p])?d[p]=this.cloneArray(h[p]):d[p]=h[p];return d},cloneArray(h){return h.slice(0)},degToRad(h){return h*o},radToDeg(h){return h*l},_degToRad(h){return a.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),a.Util.degToRad(h)},_radToDeg(h){return a.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),a.Util.radToDeg(h)},_getRotation(h){return t.Konva.angleDeg?a.Util.radToDeg(h):h},_capitalize(h){return h.charAt(0).toUpperCase()+h.slice(1)},throw(h){throw new Error(x+h)},error(h){console.error(x+h)},warn(h){t.Konva.showWarnings&&console.warn(y+h)},each(h,d){for(var p in h)d(p,h[p])},_inRange(h,d,p){return d<=h&&h<p},_getProjectionToSegment(h,d,p,C,T,f){var E,v,_,P=(h-p)*(h-p)+(d-C)*(d-C);if(P==0)E=h,v=d,_=(T-p)*(T-p)+(f-C)*(f-C);else{var S=((T-h)*(p-h)+(f-d)*(C-d))/P;S<0?(E=h,v=d,_=(h-T)*(h-T)+(d-f)*(d-f)):S>1?(E=p,v=C,_=(p-T)*(p-T)+(C-f)*(C-f)):(E=h+S*(p-h),v=d+S*(C-d),_=(E-T)*(E-T)+(v-f)*(v-f))}return[E,v,_]},_getProjectionToLine(h,d,p){var C=a.Util.cloneObject(h),T=Number.MAX_VALUE;return d.forEach(function(f,E){if(!(!p&&E===d.length-1)){var v=d[(E+1)%d.length],_=a.Util._getProjectionToSegment(f.x,f.y,v.x,v.y,h.x,h.y),P=_[0],S=_[1],O=_[2];O<T&&(C.x=P,C.y=S,T=O)}}),C},_prepareArrayForTween(h,d,p){var C,T=[],f=[];if(h.length>d.length){var E=d;d=h,h=E}for(C=0;C<h.length;C+=2)T.push({x:h[C],y:h[C+1]});for(C=0;C<d.length;C+=2)f.push({x:d[C],y:d[C+1]});var v=[];return f.forEach(function(_){var P=a.Util._getProjectionToLine(_,T,p);v.push(P.x),v.push(P.y)}),v},_prepareToStringify(h){var d;h.visitedByCircularReferenceRemoval=!0;for(var p in h)if(h.hasOwnProperty(p)&&h[p]&&typeof h[p]=="object"){if(d=Object.getOwnPropertyDescriptor(h,p),h[p].visitedByCircularReferenceRemoval||a.Util._isElement(h[p]))if(d.configurable)delete h[p];else return null;else if(a.Util._prepareToStringify(h[p])===null)if(d.configurable)delete h[p];else return null}return delete h.visitedByCircularReferenceRemoval,h},_assign(h,d){for(var p in d)h[p]=d[p];return h},_getFirstPointerId(h){return h.touches?h.changedTouches[0].identifier:h.pointerId||999},releaseCanvas(...h){t.Konva.releaseCanvasOnDestroy&&h.forEach(d=>{d.width=0,d.height=0})},drawRoundedRectPath(h,d,p,C){let T=0,f=0,E=0,v=0;typeof C=="number"?T=f=E=v=Math.min(C,d/2,p/2):(T=Math.min(C[0]||0,d/2,p/2),f=Math.min(C[1]||0,d/2,p/2),v=Math.min(C[2]||0,d/2,p/2),E=Math.min(C[3]||0,d/2,p/2)),h.moveTo(T,0),h.lineTo(d-f,0),h.arc(d-f,f,f,Math.PI*3/2,0,!1),h.lineTo(d,p-v),h.arc(d-v,p-v,v,0,Math.PI/2,!1),h.lineTo(E,p),h.arc(E,p-E,E,Math.PI/2,Math.PI,!1),h.lineTo(0,T),h.arc(T,T,T,Math.PI,Math.PI*3/2,!1)}}}(ct);var bt={},z={};Object.defineProperty(z,"__esModule",{value:!0}),z.getComponentValidator=z.getBooleanValidator=z.getNumberArrayValidator=z.getFunctionValidator=z.getStringOrGradientValidator=z.getStringValidator=z.getNumberOrAutoValidator=z.getNumberOrArrayOfNumbersValidator=z.getNumberValidator=z.alphaComponent=z.RGBComponent=void 0;const Lt=ht,tt=ct;function Pt(a){return tt.Util._isString(a)?'"'+a+'"':Object.prototype.toString.call(a)==="[object Number]"||tt.Util._isBoolean(a)?a:Object.prototype.toString.call(a)}function ji(a){return a>255?255:a<0?0:Math.round(a)}z.RGBComponent=ji;function qi(a){return a>1?1:a<1e-4?1e-4:a}z.alphaComponent=qi;function Zi(){if(Lt.Konva.isUnminified)return function(a,t){return tt.Util._isNumber(a)||tt.Util.warn(Pt(a)+' is a not valid value for "'+t+'" attribute. The value should be a number.'),a}}z.getNumberValidator=Zi;function Ji(a){if(Lt.Konva.isUnminified)return function(t,e){let i=tt.Util._isNumber(t),r=tt.Util._isArray(t)&&t.length==a;return!i&&!r&&tt.Util.warn(Pt(t)+' is a not valid value for "'+e+'" attribute. The value should be a number or Array<number>('+a+")"),t}}z.getNumberOrArrayOfNumbersValidator=Ji;function Qi(){if(Lt.Konva.isUnminified)return function(a,t){var e=tt.Util._isNumber(a),i=a==="auto";return e||i||tt.Util.warn(Pt(a)+' is a not valid value for "'+t+'" attribute. The value should be a number or "auto".'),a}}z.getNumberOrAutoValidator=Qi;function tr(){if(Lt.Konva.isUnminified)return function(a,t){return tt.Util._isString(a)||tt.Util.warn(Pt(a)+' is a not valid value for "'+t+'" attribute. The value should be a string.'),a}}z.getStringValidator=tr;function er(){if(Lt.Konva.isUnminified)return function(a,t){const e=tt.Util._isString(a),i=Object.prototype.toString.call(a)==="[object CanvasGradient]"||a&&a.addColorStop;return e||i||tt.Util.warn(Pt(a)+' is a not valid value for "'+t+'" attribute. The value should be a string or a native gradient.'),a}}z.getStringOrGradientValidator=er;function ir(){if(Lt.Konva.isUnminified)return function(a,t){return tt.Util._isFunction(a)||tt.Util.warn(Pt(a)+' is a not valid value for "'+t+'" attribute. The value should be a function.'),a}}z.getFunctionValidator=ir;function rr(){if(Lt.Konva.isUnminified)return function(a,t){const e=Int8Array?Object.getPrototypeOf(Int8Array):null;return e&&a instanceof e||(tt.Util._isArray(a)?a.forEach(function(i){tt.Util._isNumber(i)||tt.Util.warn('"'+t+'" attribute has non numeric element '+i+". Make sure that all elements are numbers.")}):tt.Util.warn(Pt(a)+' is a not valid value for "'+t+'" attribute. The value should be a array of numbers.')),a}}z.getNumberArrayValidator=rr;function nr(){if(Lt.Konva.isUnminified)return function(a,t){var e=a===!0||a===!1;return e||tt.Util.warn(Pt(a)+' is a not valid value for "'+t+'" attribute. The value should be a boolean.'),a}}z.getBooleanValidator=nr;function ar(a){if(Lt.Konva.isUnminified)return function(t,e){return t==null||tt.Util.isObject(t)||tt.Util.warn(Pt(t)+' is a not valid value for "'+e+'" attribute. The value should be an object with properties '+a),t}}z.getComponentValidator=ar,function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.Factory=void 0;const t=ct,e=z;var i="get",r="set";a.Factory={addGetterSetter(n,s,o,l,c){a.Factory.addGetter(n,s,o),a.Factory.addSetter(n,s,l,c),a.Factory.addOverloadedGetterSetter(n,s)},addGetter(n,s,o){var l=i+t.Util._capitalize(s);n.prototype[l]=n.prototype[l]||function(){var c=this.attrs[s];return c===void 0?o:c}},addSetter(n,s,o,l){var c=r+t.Util._capitalize(s);n.prototype[c]||a.Factory.overWriteSetter(n,s,o,l)},overWriteSetter(n,s,o,l){var c=r+t.Util._capitalize(s);n.prototype[c]=function(g){return o&&g!==void 0&&g!==null&&(g=o.call(this,g,s)),this._setAttr(s,g),l&&l.call(this),this}},addComponentsGetterSetter(n,s,o,l,c){var g=o.length,w=t.Util._capitalize,y=i+w(s),x=r+w(s),L,k;n.prototype[y]=function(){var $={};for(L=0;L<g;L++)k=o[L],$[k]=this.getAttr(s+w(k));return $};var M=(0,e.getComponentValidator)(o);n.prototype[x]=function($){var U=this.attrs[s],h;l&&($=l.call(this,$)),M&&M.call(this,$,s);for(h in $)$.hasOwnProperty(h)&&this._setAttr(s+w(h),$[h]);return $||o.forEach(d=>{this._setAttr(s+w(d),void 0)}),this._fireChangeEvent(s,U,$),c&&c.call(this),this},a.Factory.addOverloadedGetterSetter(n,s)},addOverloadedGetterSetter(n,s){var o=t.Util._capitalize(s),l=r+o,c=i+o;n.prototype[s]=function(){return arguments.length?(this[l](arguments[0]),this):this[c]()}},addDeprecatedGetterSetter(n,s,o,l){t.Util.error("Adding deprecated "+s);var c=i+t.Util._capitalize(s),g=s+" property is deprecated and will be removed soon. Look at Konva change log for more information.";n.prototype[c]=function(){t.Util.error(g);var w=this.attrs[s];return w===void 0?o:w},a.Factory.addSetter(n,s,l,function(){t.Util.error(g)}),a.Factory.addOverloadedGetterSetter(n,s)},backCompat(n,s){t.Util.each(s,function(o,l){var c=n.prototype[l],g=i+t.Util._capitalize(o),w=r+t.Util._capitalize(o);function y(){c.apply(this,arguments),t.Util.error('"'+o+'" method is deprecated and will be removed soon. Use ""'+l+'" instead.')}n.prototype[o]=y,n.prototype[g]=y,n.prototype[w]=y})},afterSetFilter(){this._filterUpToDate=!1}}}(bt);var Kt={},It={},kt={},Ot={};Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.HitContext=Ot.SceneContext=Ot.Context=void 0;const Qe=ct,sr=ht;function or(a){var t=[],e=a.length,i=Qe.Util,r,n;for(r=0;r<e;r++)n=a[r],i._isNumber(n)?n=Math.round(n*1e3)/1e3:i._isString(n)||(n=n+""),t.push(n);return t}var ti=",",hr="(",lr=")",dr="([",cr="])",ur=";",gr="()",fr="=",ei=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],pr=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"];const vr=100;class ye{constructor(t){this.canvas=t,sr.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(t){t.fillEnabled()&&this._fill(t)}_fill(t){}strokeShape(t){t.hasStroke()&&this._stroke(t)}_stroke(t){}fillStrokeShape(t){t.attrs.fillAfterStrokeEnabled?(this.strokeShape(t),this.fillShape(t)):(this.fillShape(t),this.strokeShape(t))}getTrace(t,e){var i=this.traceArr,r=i.length,n="",s,o,l,c;for(s=0;s<r;s++)o=i[s],l=o.method,l?(c=o.args,n+=l,t?n+=gr:Qe.Util._isArray(c[0])?n+=dr+c.join(ti)+cr:(e&&(c=c.map(g=>typeof g=="number"?Math.floor(g):g)),n+=hr+c.join(ti)+lr)):(n+=o.property,t||(n+=fr+o.val)),n+=ur;return n}clearTrace(){this.traceArr=[]}_trace(t){var e=this.traceArr,i;e.push(t),i=e.length,i>=vr&&e.shift()}reset(){var t=this.getCanvas().getPixelRatio();this.setTransform(1*t,0,0,1*t,0,0)}getCanvas(){return this.canvas}clear(t){var e=this.getCanvas();t?this.clearRect(t.x||0,t.y||0,t.width||0,t.height||0):this.clearRect(0,0,e.getWidth()/e.pixelRatio,e.getHeight()/e.pixelRatio)}_applyLineCap(t){const e=t.attrs.lineCap;e&&this.setAttr("lineCap",e)}_applyOpacity(t){var e=t.getAbsoluteOpacity();e!==1&&this.setAttr("globalAlpha",e)}_applyLineJoin(t){const e=t.attrs.lineJoin;e&&this.setAttr("lineJoin",e)}setAttr(t,e){this._context[t]=e}arc(t,e,i,r,n,s){this._context.arc(t,e,i,r,n,s)}arcTo(t,e,i,r,n){this._context.arcTo(t,e,i,r,n)}beginPath(){this._context.beginPath()}bezierCurveTo(t,e,i,r,n,s){this._context.bezierCurveTo(t,e,i,r,n,s)}clearRect(t,e,i,r){this._context.clearRect(t,e,i,r)}clip(...t){this._context.clip.apply(this._context,t)}closePath(){this._context.closePath()}createImageData(t,e){var i=arguments;if(i.length===2)return this._context.createImageData(t,e);if(i.length===1)return this._context.createImageData(t)}createLinearGradient(t,e,i,r){return this._context.createLinearGradient(t,e,i,r)}createPattern(t,e){return this._context.createPattern(t,e)}createRadialGradient(t,e,i,r,n,s){return this._context.createRadialGradient(t,e,i,r,n,s)}drawImage(t,e,i,r,n,s,o,l,c){var g=arguments,w=this._context;g.length===3?w.drawImage(t,e,i):g.length===5?w.drawImage(t,e,i,r,n):g.length===9&&w.drawImage(t,e,i,r,n,s,o,l,c)}ellipse(t,e,i,r,n,s,o,l){this._context.ellipse(t,e,i,r,n,s,o,l)}isPointInPath(t,e,i,r){return i?this._context.isPointInPath(i,t,e,r):this._context.isPointInPath(t,e,r)}fill(...t){this._context.fill.apply(this._context,t)}fillRect(t,e,i,r){this._context.fillRect(t,e,i,r)}strokeRect(t,e,i,r){this._context.strokeRect(t,e,i,r)}fillText(t,e,i,r){r?this._context.fillText(t,e,i,r):this._context.fillText(t,e,i)}measureText(t){return this._context.measureText(t)}getImageData(t,e,i,r){return this._context.getImageData(t,e,i,r)}lineTo(t,e){this._context.lineTo(t,e)}moveTo(t,e){this._context.moveTo(t,e)}rect(t,e,i,r){this._context.rect(t,e,i,r)}roundRect(t,e,i,r,n){this._context.roundRect(t,e,i,r,n)}putImageData(t,e,i){this._context.putImageData(t,e,i)}quadraticCurveTo(t,e,i,r){this._context.quadraticCurveTo(t,e,i,r)}restore(){this._context.restore()}rotate(t){this._context.rotate(t)}save(){this._context.save()}scale(t,e){this._context.scale(t,e)}setLineDash(t){this._context.setLineDash?this._context.setLineDash(t):"mozDash"in this._context?this._context.mozDash=t:"webkitLineDash"in this._context&&(this._context.webkitLineDash=t)}getLineDash(){return this._context.getLineDash()}setTransform(t,e,i,r,n,s){this._context.setTransform(t,e,i,r,n,s)}stroke(t){t?this._context.stroke(t):this._context.stroke()}strokeText(t,e,i,r){this._context.strokeText(t,e,i,r)}transform(t,e,i,r,n,s){this._context.transform(t,e,i,r,n,s)}translate(t,e){this._context.translate(t,e)}_enableTrace(){var t=this,e=ei.length,i=this.setAttr,r,n,s=function(o){var l=t[o],c;t[o]=function(){return n=or(Array.prototype.slice.call(arguments,0)),c=l.apply(t,arguments),t._trace({method:o,args:n}),c}};for(r=0;r<e;r++)s(ei[r]);t.setAttr=function(){i.apply(t,arguments);var o=arguments[0],l=arguments[1];(o==="shadowOffsetX"||o==="shadowOffsetY"||o==="shadowBlur")&&(l=l/this.canvas.getPixelRatio()),t._trace({property:o,val:l})}}_applyGlobalCompositeOperation(t){const e=t.attrs.globalCompositeOperation;var i=!e||e==="source-over";i||this.setAttr("globalCompositeOperation",e)}}Ot.Context=ye,pr.forEach(function(a){Object.defineProperty(ye.prototype,a,{get(){return this._context[a]},set(t){this._context[a]=t}})});class mr extends ye{constructor(t,{willReadFrequently:e=!1}={}){super(t),this._context=t._canvas.getContext("2d",{willReadFrequently:e})}_fillColor(t){var e=t.fill();this.setAttr("fillStyle",e),t._fillFunc(this)}_fillPattern(t){this.setAttr("fillStyle",t._getFillPattern()),t._fillFunc(this)}_fillLinearGradient(t){var e=t._getLinearGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fillRadialGradient(t){const e=t._getRadialGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fill(t){const e=t.fill(),i=t.getFillPriority();if(e&&i==="color"){this._fillColor(t);return}const r=t.getFillPatternImage();if(r&&i==="pattern"){this._fillPattern(t);return}const n=t.getFillLinearGradientColorStops();if(n&&i==="linear-gradient"){this._fillLinearGradient(t);return}const s=t.getFillRadialGradientColorStops();if(s&&i==="radial-gradient"){this._fillRadialGradient(t);return}e?this._fillColor(t):r?this._fillPattern(t):n?this._fillLinearGradient(t):s&&this._fillRadialGradient(t)}_strokeLinearGradient(t){const e=t.getStrokeLinearGradientStartPoint(),i=t.getStrokeLinearGradientEndPoint(),r=t.getStrokeLinearGradientColorStops(),n=this.createLinearGradient(e.x,e.y,i.x,i.y);if(r){for(var s=0;s<r.length;s+=2)n.addColorStop(r[s],r[s+1]);this.setAttr("strokeStyle",n)}}_stroke(t){var e=t.dash(),i=t.getStrokeScaleEnabled();if(t.hasStroke()){if(!i){this.save();var r=this.getCanvas().getPixelRatio();this.setTransform(r,0,0,r,0,0)}this._applyLineCap(t),e&&t.dashEnabled()&&(this.setLineDash(e),this.setAttr("lineDashOffset",t.dashOffset())),this.setAttr("lineWidth",t.strokeWidth()),t.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)");var n=t.getStrokeLinearGradientColorStops();n?this._strokeLinearGradient(t):this.setAttr("strokeStyle",t.stroke()),t._strokeFunc(this),i||this.restore()}}_applyShadow(t){var e,i,r,n=(e=t.getShadowRGBA())!==null&&e!==void 0?e:"black",s=(i=t.getShadowBlur())!==null&&i!==void 0?i:5,o=(r=t.getShadowOffset())!==null&&r!==void 0?r:{x:0,y:0},l=t.getAbsoluteScale(),c=this.canvas.getPixelRatio(),g=l.x*c,w=l.y*c;this.setAttr("shadowColor",n),this.setAttr("shadowBlur",s*Math.min(Math.abs(g),Math.abs(w))),this.setAttr("shadowOffsetX",o.x*g),this.setAttr("shadowOffsetY",o.y*w)}}Ot.SceneContext=mr;class yr extends ye{constructor(t){super(t),this._context=t._canvas.getContext("2d",{willReadFrequently:!0})}_fill(t){this.save(),this.setAttr("fillStyle",t.colorKey),t._fillFuncHit(this),this.restore()}strokeShape(t){t.hasHitStroke()&&this._stroke(t)}_stroke(t){if(t.hasHitStroke()){const n=t.getStrokeScaleEnabled();if(!n){this.save();var e=this.getCanvas().getPixelRatio();this.setTransform(e,0,0,e,0,0)}this._applyLineCap(t);var i=t.hitStrokeWidth(),r=i==="auto"?t.strokeWidth():i;this.setAttr("lineWidth",r),this.setAttr("strokeStyle",t.colorKey),t._strokeFuncHit(this),n||this.restore()}}}Ot.HitContext=yr,Object.defineProperty(kt,"__esModule",{value:!0}),kt.HitCanvas=kt.SceneCanvas=kt.Canvas=void 0;const we=ct,ii=Ot,ri=ht,wr=bt,_r=z;var _e;function br(){if(_e)return _e;var a=we.Util.createCanvasElement(),t=a.getContext("2d");return _e=function(){var e=ri.Konva._global.devicePixelRatio||1,i=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return e/i}(),we.Util.releaseCanvas(a),_e}class be{constructor(t){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;var e=t||{},i=e.pixelRatio||ri.Konva.pixelRatio||br();this.pixelRatio=i,this._canvas=we.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(t){var e=this.pixelRatio;this.pixelRatio=t,this.setSize(this.getWidth()/e,this.getHeight()/e)}setWidth(t){this.width=this._canvas.width=t*this.pixelRatio,this._canvas.style.width=t+"px";var e=this.pixelRatio,i=this.getContext()._context;i.scale(e,e)}setHeight(t){this.height=this._canvas.height=t*this.pixelRatio,this._canvas.style.height=t+"px";var e=this.pixelRatio,i=this.getContext()._context;i.scale(e,e)}getWidth(){return this.width}getHeight(){return this.height}setSize(t,e){this.setWidth(t||0),this.setHeight(e||0)}toDataURL(t,e){try{return this._canvas.toDataURL(t,e)}catch{try{return this._canvas.toDataURL()}catch(r){return we.Util.error("Unable to get data URL. "+r.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}kt.Canvas=be,wr.Factory.addGetterSetter(be,"pixelRatio",void 0,(0,_r.getNumberValidator)());class Cr extends be{constructor(t={width:0,height:0,willReadFrequently:!1}){super(t),this.context=new ii.SceneContext(this,{willReadFrequently:t.willReadFrequently}),this.setSize(t.width,t.height)}}kt.SceneCanvas=Cr;class Sr extends be{constructor(t={width:0,height:0}){super(t),this.hitCanvas=!0,this.context=new ii.HitContext(this),this.setSize(t.width,t.height)}}kt.HitCanvas=Sr;var Me={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.DD=void 0;const t=ht,e=ct;a.DD={get isDragging(){var i=!1;return a.DD._dragElements.forEach(r=>{r.dragStatus==="dragging"&&(i=!0)}),i},justDragged:!1,get node(){var i;return a.DD._dragElements.forEach(r=>{i=r.node}),i},_dragElements:new Map,_drag(i){const r=[];a.DD._dragElements.forEach((n,s)=>{const{node:o}=n,l=o.getStage();l.setPointersPositions(i),n.pointerId===void 0&&(n.pointerId=e.Util._getFirstPointerId(i));const c=l._changedPointerPositions.find(y=>y.id===n.pointerId);if(c){if(n.dragStatus!=="dragging"){var g=o.dragDistance(),w=Math.max(Math.abs(c.x-n.startPointerPos.x),Math.abs(c.y-n.startPointerPos.y));if(w<g||(o.startDrag({evt:i}),!o.isDragging()))return}o._setDragPosition(i,n),r.push(o)}}),r.forEach(n=>{n.fire("dragmove",{type:"dragmove",target:n,evt:i},!0)})},_endDragBefore(i){const r=[];a.DD._dragElements.forEach(n=>{const{node:s}=n,o=s.getStage();if(i&&o.setPointersPositions(i),!o._changedPointerPositions.find(g=>g.id===n.pointerId))return;(n.dragStatus==="dragging"||n.dragStatus==="stopped")&&(a.DD.justDragged=!0,t.Konva._mouseListenClick=!1,t.Konva._touchListenClick=!1,t.Konva._pointerListenClick=!1,n.dragStatus="stopped");const c=n.node.getLayer()||n.node instanceof t.Konva.Stage&&n.node;c&&r.indexOf(c)===-1&&r.push(c)}),r.forEach(n=>{n.draw()})},_endDragAfter(i){a.DD._dragElements.forEach((r,n)=>{r.dragStatus==="stopped"&&r.node.fire("dragend",{type:"dragend",target:r.node,evt:i},!0),r.dragStatus!=="dragging"&&a.DD._dragElements.delete(n)})}},t.Konva.isBrowser&&(window.addEventListener("mouseup",a.DD._endDragBefore,!0),window.addEventListener("touchend",a.DD._endDragBefore,!0),window.addEventListener("mousemove",a.DD._drag),window.addEventListener("touchmove",a.DD._drag),window.addEventListener("mouseup",a.DD._endDragAfter,!1),window.addEventListener("touchend",a.DD._endDragAfter,!1))})(Me),Object.defineProperty(It,"__esModule",{value:!0});var ni=It.Node=void 0;const I=ct,oe=bt,he=kt,Ht=ht,vt=Me,nt=z;var Ce="absoluteOpacity",Se="allEventListeners",$t="absoluteTransform",ai="absoluteScale",zt="canvas",xr="Change",Er="children",kr="konva",Oe="listening",si="mouseenter",oi="mouseleave",hi="set",li="Shape",xe=" ",di="stage",Gt="transform",Tr="Stage",Ge="visible",Lr=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(xe);let Pr=1;class G{constructor(t){this._id=Pr++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(t),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(t){(t===Gt||t===$t)&&this._cache.get(t)?this._cache.get(t).dirty=!0:t?this._cache.delete(t):this._cache.clear()}_getCache(t,e){var i=this._cache.get(t),r=t===Gt||t===$t,n=i===void 0||r&&i.dirty===!0;return n&&(i=e.call(this),this._cache.set(t,i)),i}_calculate(t,e,i){if(!this._attachedDepsListeners.get(t)){const r=e.map(n=>n+"Change.konva").join(xe);this.on(r,()=>{this._clearCache(t)}),this._attachedDepsListeners.set(t,!0)}return this._getCache(t,i)}_getCanvasCache(){return this._cache.get(zt)}_clearSelfAndDescendantCache(t){this._clearCache(t),t===$t&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(zt)){const{scene:t,filter:e,hit:i}=this._cache.get(zt);I.Util.releaseCanvas(t,e,i),this._cache.delete(zt)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(t){var e=t||{},i={};(e.x===void 0||e.y===void 0||e.width===void 0||e.height===void 0)&&(i=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));var r=Math.ceil(e.width||i.width),n=Math.ceil(e.height||i.height),s=e.pixelRatio,o=e.x===void 0?Math.floor(i.x):e.x,l=e.y===void 0?Math.floor(i.y):e.y,c=e.offset||0,g=e.drawBorder||!1,w=e.hitCanvasPixelRatio||1;if(!r||!n){I.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const y=Math.abs(Math.round(i.x)-o)>.5?1:0,x=Math.abs(Math.round(i.y)-l)>.5?1:0;r+=c*2+y,n+=c*2+x,o-=c,l-=c;var L=new he.SceneCanvas({pixelRatio:s,width:r,height:n}),k=new he.SceneCanvas({pixelRatio:s,width:0,height:0,willReadFrequently:!0}),M=new he.HitCanvas({pixelRatio:w,width:r,height:n}),$=L.getContext(),U=M.getContext();return M.isCache=!0,L.isCache=!0,this._cache.delete(zt),this._filterUpToDate=!1,e.imageSmoothingEnabled===!1&&(L.getContext()._context.imageSmoothingEnabled=!1,k.getContext()._context.imageSmoothingEnabled=!1),$.save(),U.save(),$.translate(-o,-l),U.translate(-o,-l),this._isUnderCache=!0,this._clearSelfAndDescendantCache(Ce),this._clearSelfAndDescendantCache(ai),this.drawScene(L,this),this.drawHit(M,this),this._isUnderCache=!1,$.restore(),U.restore(),g&&($.save(),$.beginPath(),$.rect(0,0,r,n),$.closePath(),$.setAttr("strokeStyle","red"),$.setAttr("lineWidth",5),$.stroke(),$.restore()),this._cache.set(zt,{scene:L,filter:k,hit:M,x:o,y:l}),this._requestDraw(),this}isCached(){return this._cache.has(zt)}getClientRect(t){throw new Error('abstract "getClientRect" method call')}_transformedRect(t,e){var i=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}],r=1/0,n=1/0,s=-1/0,o=-1/0,l=this.getAbsoluteTransform(e);return i.forEach(function(c){var g=l.point(c);r===void 0&&(r=s=g.x,n=o=g.y),r=Math.min(r,g.x),n=Math.min(n,g.y),s=Math.max(s,g.x),o=Math.max(o,g.y)}),{x:r,y:n,width:s-r,height:o-n}}_drawCachedSceneCanvas(t){t.save(),t._applyOpacity(this),t._applyGlobalCompositeOperation(this);const e=this._getCanvasCache();t.translate(e.x,e.y);var i=this._getCachedSceneCanvas(),r=i.pixelRatio;t.drawImage(i._canvas,0,0,i.width/r,i.height/r),t.restore()}_drawCachedHitCanvas(t){var e=this._getCanvasCache(),i=e.hit;t.save(),t.translate(e.x,e.y),t.drawImage(i._canvas,0,0,i.width/i.pixelRatio,i.height/i.pixelRatio),t.restore()}_getCachedSceneCanvas(){var t=this.filters(),e=this._getCanvasCache(),i=e.scene,r=e.filter,n=r.getContext(),s,o,l,c;if(t){if(!this._filterUpToDate){var g=i.pixelRatio;r.setSize(i.width/i.pixelRatio,i.height/i.pixelRatio);try{for(s=t.length,n.clear(),n.drawImage(i._canvas,0,0,i.getWidth()/g,i.getHeight()/g),o=n.getImageData(0,0,r.getWidth(),r.getHeight()),l=0;l<s;l++){if(c=t[l],typeof c!="function"){I.Util.error("Filter should be type of function, but got "+typeof c+" instead. Please check correct filters");continue}c.call(this,o),n.putImageData(o,0,0)}}catch(w){I.Util.error("Unable to apply filter. "+w.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return r}return i}on(t,e){if(this._cache&&this._cache.delete(Se),arguments.length===3)return this._delegate.apply(this,arguments);var i=t.split(xe),r=i.length,n,s,o,l,c;for(n=0;n<r;n++)s=i[n],o=s.split("."),l=o[0],c=o[1]||"",this.eventListeners[l]||(this.eventListeners[l]=[]),this.eventListeners[l].push({name:c,handler:e});return this}off(t,e){var i=(t||"").split(xe),r=i.length,n,s,o,l,c,g;if(this._cache&&this._cache.delete(Se),!t)for(s in this.eventListeners)this._off(s);for(n=0;n<r;n++)if(o=i[n],l=o.split("."),c=l[0],g=l[1],c)this.eventListeners[c]&&this._off(c,g,e);else for(s in this.eventListeners)this._off(s,g,e);return this}dispatchEvent(t){var e={target:this,type:t.type,evt:t};return this.fire(t.type,e),this}addEventListener(t,e){return this.on(t,function(i){e.call(this,i.evt)}),this}removeEventListener(t){return this.off(t),this}_delegate(t,e,i){var r=this;this.on(t,function(n){for(var s=n.target.findAncestors(e,!0,r),o=0;o<s.length;o++)n=I.Util.cloneObject(n),n.currentTarget=s[o],i.call(s[o],n)})}remove(){return this.isDragging()&&this.stopDrag(),vt.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache($t),this._clearSelfAndDescendantCache(Ce),this._clearSelfAndDescendantCache(ai),this._clearSelfAndDescendantCache(di),this._clearSelfAndDescendantCache(Ge),this._clearSelfAndDescendantCache(Oe)}_remove(){this._clearCaches();var t=this.getParent();t&&t.children&&(t.children.splice(this.index,1),t._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(t){var e="get"+I.Util._capitalize(t);return I.Util._isFunction(this[e])?this[e]():this.attrs[t]}getAncestors(){for(var t=this.getParent(),e=[];t;)e.push(t),t=t.getParent();return e}getAttrs(){return this.attrs||{}}setAttrs(t){return this._batchTransformChanges(()=>{var e,i;if(!t)return this;for(e in t)e!==Er&&(i=hi+I.Util._capitalize(e),I.Util._isFunction(this[i])?this[i](t[e]):this._setAttr(e,t[e]))}),this}isListening(){return this._getCache(Oe,this._isListening)}_isListening(t){if(!this.listening())return!1;const i=this.getParent();return i&&i!==t&&this!==t?i._isListening(t):!0}isVisible(){return this._getCache(Ge,this._isVisible)}_isVisible(t){if(!this.visible())return!1;const i=this.getParent();return i&&i!==t&&this!==t?i._isVisible(t):!0}shouldDrawHit(t,e=!1){if(t)return this._isVisible(t)&&this._isListening(t);var i=this.getLayer(),r=!1;vt.DD._dragElements.forEach(s=>{s.dragStatus==="dragging"&&(s.node.nodeType==="Stage"||s.node.getLayer()===i)&&(r=!0)});var n=!e&&!Ht.Konva.hitOnDragEnabled&&r;return this.isListening()&&this.isVisible()&&!n}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){var t=this.getDepth(),e=this,i=0,r,n,s,o;function l(g){for(r=[],n=g.length,s=0;s<n;s++)o=g[s],i++,o.nodeType!==li&&(r=r.concat(o.getChildren().slice())),o._id===e._id&&(s=n);r.length>0&&r[0].getDepth()<=t&&l(r)}const c=this.getStage();return e.nodeType!==Tr&&c&&l(c.getChildren()),i}getDepth(){for(var t=0,e=this.parent;e;)t++,e=e.parent;return t}_batchTransformChanges(t){this._batchingTransformChange=!0,t(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(Gt),this._clearSelfAndDescendantCache($t)),this._needClearTransformCache=!1}setPosition(t){return this._batchTransformChanges(()=>{this.x(t.x),this.y(t.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const t=this.getStage();if(!t)return null;var e=t.getPointerPosition();if(!e)return null;var i=this.getAbsoluteTransform().copy();return i.invert(),i.point(e)}getAbsolutePosition(t){let e=!1,i=this.parent;for(;i;){if(i.isCached()){e=!0;break}i=i.parent}e&&!t&&(t=!0);var r=this.getAbsoluteTransform(t).getMatrix(),n=new I.Transform,s=this.offset();return n.m=r.slice(),n.translate(s.x,s.y),n.getTranslation()}setAbsolutePosition(t){const{x:e,y:i,...r}=this._clearTransform();this.attrs.x=e,this.attrs.y=i,this._clearCache(Gt);var n=this._getAbsoluteTransform().copy();return n.invert(),n.translate(t.x,t.y),t={x:this.attrs.x+n.getTranslation().x,y:this.attrs.y+n.getTranslation().y},this._setTransform(r),this.setPosition({x:t.x,y:t.y}),this._clearCache(Gt),this._clearSelfAndDescendantCache($t),this}_setTransform(t){var e;for(e in t)this.attrs[e]=t[e]}_clearTransform(){var t={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,t}move(t){var e=t.x,i=t.y,r=this.x(),n=this.y();return e!==void 0&&(r+=e),i!==void 0&&(n+=i),this.setPosition({x:r,y:n}),this}_eachAncestorReverse(t,e){var i=[],r=this.getParent(),n,s;if(!(e&&e._id===this._id)){for(i.unshift(this);r&&(!e||r._id!==e._id);)i.unshift(r),r=r.parent;for(n=i.length,s=0;s<n;s++)t(i[s])}}rotate(t){return this.rotation(this.rotation()+t),this}moveToTop(){if(!this.parent)return I.Util.warn("Node has no parent. moveToTop function is ignored."),!1;var t=this.index,e=this.parent.getChildren().length;return t<e-1?(this.parent.children.splice(t,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return I.Util.warn("Node has no parent. moveUp function is ignored."),!1;var t=this.index,e=this.parent.getChildren().length;return t<e-1?(this.parent.children.splice(t,1),this.parent.children.splice(t+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return I.Util.warn("Node has no parent. moveDown function is ignored."),!1;var t=this.index;return t>0?(this.parent.children.splice(t,1),this.parent.children.splice(t-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return I.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;var t=this.index;return t>0?(this.parent.children.splice(t,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(t){if(!this.parent)return I.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(t<0||t>=this.parent.children.length)&&I.Util.warn("Unexpected value "+t+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");var e=this.index;return this.parent.children.splice(e,1),this.parent.children.splice(t,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(Ce,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){var t=this.opacity(),e=this.getParent();return e&&!e._isUnderCache&&(t*=e.getAbsoluteOpacity()),t}moveTo(t){return this.getParent()!==t&&(this._remove(),t.add(this)),this}toObject(){var t=this.getAttrs(),e,i,r,n,s;const o={attrs:{},className:this.getClassName()};for(e in t)i=t[e],s=I.Util.isObject(i)&&!I.Util._isPlainObject(i)&&!I.Util._isArray(i),!s&&(r=typeof this[e]=="function"&&this[e],delete t[e],n=r?r.call(this):null,t[e]=i,n!==i&&(o.attrs[e]=i));return I.Util._prepareToStringify(o)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(t,e,i){var r=[];e&&this._isMatch(t)&&r.push(this);for(var n=this.parent;n;){if(n===i)return r;n._isMatch(t)&&r.push(n),n=n.parent}return r}isAncestorOf(t){return!1}findAncestor(t,e,i){return this.findAncestors(t,e,i)[0]}_isMatch(t){if(!t)return!1;if(typeof t=="function")return t(this);var e=t.replace(/ /g,"").split(","),i=e.length,r,n;for(r=0;r<i;r++)if(n=e[r],I.Util.isValidSelector(n)||(I.Util.warn('Selector "'+n+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),I.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),I.Util.warn("Konva is awesome, right?")),n.charAt(0)==="#"){if(this.id()===n.slice(1))return!0}else if(n.charAt(0)==="."){if(this.hasName(n.slice(1)))return!0}else if(this.className===n||this.nodeType===n)return!0;return!1}getLayer(){var t=this.getParent();return t?t.getLayer():null}getStage(){return this._getCache(di,this._getStage)}_getStage(){var t=this.getParent();return t?t.getStage():null}fire(t,e={},i){return e.target=e.target||this,i?this._fireAndBubble(t,e):this._fire(t,e),this}getAbsoluteTransform(t){return t?this._getAbsoluteTransform(t):this._getCache($t,this._getAbsoluteTransform)}_getAbsoluteTransform(t){var e;if(t)return e=new I.Transform,this._eachAncestorReverse(function(r){var n=r.transformsEnabled();n==="all"?e.multiply(r.getTransform()):n==="position"&&e.translate(r.x()-r.offsetX(),r.y()-r.offsetY())},t),e;e=this._cache.get($t)||new I.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(e):e.reset();var i=this.transformsEnabled();if(i==="all")e.multiply(this.getTransform());else if(i==="position"){const r=this.attrs.x||0,n=this.attrs.y||0,s=this.attrs.offsetX||0,o=this.attrs.offsetY||0;e.translate(r-s,n-o)}return e.dirty=!1,e}getAbsoluteScale(t){for(var e=this;e;)e._isUnderCache&&(t=e),e=e.getParent();const r=this.getAbsoluteTransform(t).decompose();return{x:r.scaleX,y:r.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(Gt,this._getTransform)}_getTransform(){var t,e,i=this._cache.get(Gt)||new I.Transform;i.reset();var r=this.x(),n=this.y(),s=Ht.Konva.getAngle(this.rotation()),o=(t=this.attrs.scaleX)!==null&&t!==void 0?t:1,l=(e=this.attrs.scaleY)!==null&&e!==void 0?e:1,c=this.attrs.skewX||0,g=this.attrs.skewY||0,w=this.attrs.offsetX||0,y=this.attrs.offsetY||0;return(r!==0||n!==0)&&i.translate(r,n),s!==0&&i.rotate(s),(c!==0||g!==0)&&i.skew(c,g),(o!==1||l!==1)&&i.scale(o,l),(w!==0||y!==0)&&i.translate(-1*w,-1*y),i.dirty=!1,i}clone(t){var e=I.Util.cloneObject(this.attrs),i,r,n,s,o;for(i in t)e[i]=t[i];var l=new this.constructor(e);for(i in this.eventListeners)for(r=this.eventListeners[i],n=r.length,s=0;s<n;s++)o=r[s],o.name.indexOf(kr)<0&&(l.eventListeners[i]||(l.eventListeners[i]=[]),l.eventListeners[i].push(o));return l}_toKonvaCanvas(t){t=t||{};var e=this.getClientRect(),i=this.getStage(),r=t.x!==void 0?t.x:Math.floor(e.x),n=t.y!==void 0?t.y:Math.floor(e.y),s=t.pixelRatio||1,o=new he.SceneCanvas({width:t.width||Math.ceil(e.width)||(i?i.width():0),height:t.height||Math.ceil(e.height)||(i?i.height():0),pixelRatio:s}),l=o.getContext();const c=new he.SceneCanvas({width:o.width,height:o.height,pixelRatio:o.pixelRatio});return t.imageSmoothingEnabled===!1&&(l._context.imageSmoothingEnabled=!1),l.save(),(r||n)&&l.translate(-1*r,-1*n),this.drawScene(o,void 0,c),l.restore(),o}toCanvas(t){return this._toKonvaCanvas(t)._canvas}toDataURL(t){t=t||{};var e=t.mimeType||null,i=t.quality||null,r=this._toKonvaCanvas(t).toDataURL(e,i);return t.callback&&t.callback(r),r}toImage(t){return new Promise((e,i)=>{try{const r=t==null?void 0:t.callback;r&&delete t.callback,I.Util._urlToImage(this.toDataURL(t),function(n){e(n),r==null||r(n)})}catch(r){i(r)}})}toBlob(t){return new Promise((e,i)=>{try{const r=t==null?void 0:t.callback;r&&delete t.callback,this.toCanvas(t).toBlob(n=>{e(n),r==null||r(n)},t==null?void 0:t.mimeType,t==null?void 0:t.quality)}catch(r){i(r)}})}setSize(t){return this.width(t.width),this.height(t.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():Ht.Konva.dragDistance}_off(t,e,i){var r=this.eventListeners[t],n,s,o;for(n=0;n<r.length;n++)if(s=r[n].name,o=r[n].handler,(s!=="konva"||e==="konva")&&(!e||s===e)&&(!i||i===o)){if(r.splice(n,1),r.length===0){delete this.eventListeners[t];break}n--}}_fireChangeEvent(t,e,i){this._fire(t+xr,{oldVal:e,newVal:i})}addName(t){if(!this.hasName(t)){var e=this.name(),i=e?e+" "+t:t;this.name(i)}return this}hasName(t){if(!t)return!1;const e=this.name();if(!e)return!1;var i=(e||"").split(/\s/g);return i.indexOf(t)!==-1}removeName(t){var e=(this.name()||"").split(/\s/g),i=e.indexOf(t);return i!==-1&&(e.splice(i,1),this.name(e.join(" "))),this}setAttr(t,e){var i=this[hi+I.Util._capitalize(t)];return I.Util._isFunction(i)?i.call(this,e):this._setAttr(t,e),this}_requestDraw(){if(Ht.Konva.autoDrawEnabled){const t=this.getLayer()||this.getStage();t==null||t.batchDraw()}}_setAttr(t,e){var i=this.attrs[t];i===e&&!I.Util.isObject(e)||(e==null?delete this.attrs[t]:this.attrs[t]=e,this._shouldFireChangeEvents&&this._fireChangeEvent(t,i,e),this._requestDraw())}_setComponentAttr(t,e,i){var r;i!==void 0&&(r=this.attrs[t],r||(this.attrs[t]=this.getAttr(t)),this.attrs[t][e]=i,this._fireChangeEvent(t,r,i))}_fireAndBubble(t,e,i){e&&this.nodeType===li&&(e.target=this);var r=(t===si||t===oi)&&(i&&(this===i||this.isAncestorOf&&this.isAncestorOf(i))||this.nodeType==="Stage"&&!i);if(!r){this._fire(t,e);var n=(t===si||t===oi)&&i&&i.isAncestorOf&&i.isAncestorOf(this)&&!i.isAncestorOf(this.parent);(e&&!e.cancelBubble||!e)&&this.parent&&this.parent.isListening()&&!n&&(i&&i.parent?this._fireAndBubble.call(this.parent,t,e,i):this._fireAndBubble.call(this.parent,t,e))}}_getProtoListeners(t){var e,i,r;const n=(e=this._cache.get(Se))!==null&&e!==void 0?e:{};let s=n==null?void 0:n[t];if(s===void 0){s=[];let o=Object.getPrototypeOf(this);for(;o;){const l=(r=(i=o.eventListeners)===null||i===void 0?void 0:i[t])!==null&&r!==void 0?r:[];s.push(...l),o=Object.getPrototypeOf(o)}n[t]=s,this._cache.set(Se,n)}return s}_fire(t,e){e=e||{},e.currentTarget=this,e.type=t;const i=this._getProtoListeners(t);if(i)for(var r=0;r<i.length;r++)i[r].handler.call(this,e);const n=this.eventListeners[t];if(n)for(var r=0;r<n.length;r++)n[r].handler.call(this,e)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(t){var e=t?t.pointerId:void 0,i=this.getStage(),r=this.getAbsolutePosition();if(i){var n=i._getPointerById(e)||i._changedPointerPositions[0]||r;vt.DD._dragElements.set(this._id,{node:this,startPointerPos:n,offset:{x:n.x-r.x,y:n.y-r.y},dragStatus:"ready",pointerId:e})}}startDrag(t,e=!0){vt.DD._dragElements.has(this._id)||this._createDragElement(t);const i=vt.DD._dragElements.get(this._id);i.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:t&&t.evt},e)}_setDragPosition(t,e){const i=this.getStage()._getPointerById(e.pointerId);if(i){var r={x:i.x-e.offset.x,y:i.y-e.offset.y},n=this.dragBoundFunc();if(n!==void 0){const s=n.call(this,r,t);s?r=s:I.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==r.x||this._lastPos.y!==r.y)&&(this.setAbsolutePosition(r),this._requestDraw()),this._lastPos=r}}stopDrag(t){const e=vt.DD._dragElements.get(this._id);e&&(e.dragStatus="stopped"),vt.DD._endDragBefore(t),vt.DD._endDragAfter(t)}setDraggable(t){this._setAttr("draggable",t),this._dragChange()}isDragging(){const t=vt.DD._dragElements.get(this._id);return t?t.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(t){var e=t.evt.button!==void 0,i=!e||Ht.Konva.dragButtons.indexOf(t.evt.button)>=0;if(i&&!this.isDragging()){var r=!1;vt.DD._dragElements.forEach(n=>{this.isAncestorOf(n.node)&&(r=!0)}),r||this._createDragElement(t)}})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var t=this.getStage();if(!t)return;const e=vt.DD._dragElements.get(this._id),i=e&&e.dragStatus==="dragging",r=e&&e.dragStatus==="ready";i?this.stopDrag():r&&vt.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(t={x:0,y:0}){const e=this.getStage();if(!e)return!1;const i={x:-t.x,y:-t.y,width:e.width()+2*t.x,height:e.height()+2*t.y};return I.Util.haveIntersection(i,this.getClientRect())}static create(t,e){return I.Util._isString(t)&&(t=JSON.parse(t)),this._createNode(t,e)}static _createNode(t,e){var i=G.prototype.getClassName.call(t),r=t.children,n,s,o;e&&(t.attrs.container=e),Ht.Konva[i]||(I.Util.warn('Can not find a node with class name "'+i+'". Fallback to "Shape".'),i="Shape");const l=Ht.Konva[i];if(n=new l(t.attrs),r)for(s=r.length,o=0;o<s;o++)n.add(G._createNode(r[o]));return n}}ni=It.Node=G,G.prototype.nodeType="Node",G.prototype._attrsAffectingSize=[],G.prototype.eventListeners={},G.prototype.on.call(G.prototype,Lr,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(Gt),this._clearSelfAndDescendantCache($t)}),G.prototype.on.call(G.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(Ge)}),G.prototype.on.call(G.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(Oe)}),G.prototype.on.call(G.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(Ce)});const j=oe.Factory.addGetterSetter;j(G,"zIndex"),j(G,"absolutePosition"),j(G,"position"),j(G,"x",0,(0,nt.getNumberValidator)()),j(G,"y",0,(0,nt.getNumberValidator)()),j(G,"globalCompositeOperation","source-over",(0,nt.getStringValidator)()),j(G,"opacity",1,(0,nt.getNumberValidator)()),j(G,"name","",(0,nt.getStringValidator)()),j(G,"id","",(0,nt.getStringValidator)()),j(G,"rotation",0,(0,nt.getNumberValidator)()),oe.Factory.addComponentsGetterSetter(G,"scale",["x","y"]),j(G,"scaleX",1,(0,nt.getNumberValidator)()),j(G,"scaleY",1,(0,nt.getNumberValidator)()),oe.Factory.addComponentsGetterSetter(G,"skew",["x","y"]),j(G,"skewX",0,(0,nt.getNumberValidator)()),j(G,"skewY",0,(0,nt.getNumberValidator)()),oe.Factory.addComponentsGetterSetter(G,"offset",["x","y"]),j(G,"offsetX",0,(0,nt.getNumberValidator)()),j(G,"offsetY",0,(0,nt.getNumberValidator)()),j(G,"dragDistance",null,(0,nt.getNumberValidator)()),j(G,"width",0,(0,nt.getNumberValidator)()),j(G,"height",0,(0,nt.getNumberValidator)()),j(G,"listening",!0,(0,nt.getBooleanValidator)()),j(G,"preventDefault",!0,(0,nt.getBooleanValidator)()),j(G,"filters",null,function(a){return this._filterUpToDate=!1,a}),j(G,"visible",!0,(0,nt.getBooleanValidator)()),j(G,"transformsEnabled","all",(0,nt.getStringValidator)()),j(G,"size"),j(G,"dragBoundFunc"),j(G,"draggable",!1,(0,nt.getBooleanValidator)()),oe.Factory.backCompat(G,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.Container=void 0;const jt=bt,Fe=It,Ee=z;class Vt extends Fe.Node{constructor(){super(...arguments),this.children=[]}getChildren(t){if(!t)return this.children||[];const e=this.children||[];var i=[];return e.forEach(function(r){t(r)&&i.push(r)}),i}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(t=>{t.parent=null,t.index=0,t.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(t=>{t.parent=null,t.index=0,t.destroy()}),this.children=[],this._requestDraw(),this}add(...t){if(t.length===0)return this;if(t.length>1){for(var e=0;e<t.length;e++)this.add(t[e]);return this}const i=t[0];return i.getParent()?(i.moveTo(this),this):(this._validateAdd(i),i.index=this.getChildren().length,i.parent=this,i._clearCaches(),this.getChildren().push(i),this._fire("add",{child:i}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(t){return this._generalFind(t,!1)}findOne(t){var e=this._generalFind(t,!0);return e.length>0?e[0]:void 0}_generalFind(t,e){var i=[];return this._descendants(r=>{const n=r._isMatch(t);return n&&i.push(r),!!(n&&e)}),i}_descendants(t){let e=!1;const i=this.getChildren();for(const r of i){if(e=t(r),e)return!0;if(r.hasChildren()&&(e=r._descendants(t),e))return!0}return!1}toObject(){var t=Fe.Node.prototype.toObject.call(this);return t.children=[],this.getChildren().forEach(e=>{t.children.push(e.toObject())}),t}isAncestorOf(t){for(var e=t.getParent();e;){if(e._id===this._id)return!0;e=e.getParent()}return!1}clone(t){var e=Fe.Node.prototype.clone.call(this,t);return this.getChildren().forEach(function(i){e.add(i.clone())}),e}getAllIntersections(t){var e=[];return this.find("Shape").forEach(i=>{i.isVisible()&&i.intersects(t)&&e.push(i)}),e}_clearSelfAndDescendantCache(t){var e;super._clearSelfAndDescendantCache(t),!this.isCached()&&((e=this.children)===null||e===void 0||e.forEach(function(i){i._clearSelfAndDescendantCache(t)}))}_setChildrenIndices(){var t;(t=this.children)===null||t===void 0||t.forEach(function(e,i){e.index=i}),this._requestDraw()}drawScene(t,e,i){var r=this.getLayer(),n=t||r&&r.getCanvas(),s=n&&n.getContext(),o=this._getCanvasCache(),l=o&&o.scene,c=n&&n.isCache;if(!this.isVisible()&&!c)return this;if(l){s.save();var g=this.getAbsoluteTransform(e).getMatrix();s.transform(g[0],g[1],g[2],g[3],g[4],g[5]),this._drawCachedSceneCanvas(s),s.restore()}else this._drawChildren("drawScene",n,e,i);return this}drawHit(t,e){if(!this.shouldDrawHit(e))return this;var i=this.getLayer(),r=t||i&&i.hitCanvas,n=r&&r.getContext(),s=this._getCanvasCache(),o=s&&s.hit;if(o){n.save();var l=this.getAbsoluteTransform(e).getMatrix();n.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this._drawCachedHitCanvas(n),n.restore()}else this._drawChildren("drawHit",r,e);return this}_drawChildren(t,e,i,r){var n,s=e&&e.getContext(),o=this.clipWidth(),l=this.clipHeight(),c=this.clipFunc(),g=o&&l||c;const w=i===this;if(g){s.save();var y=this.getAbsoluteTransform(i),x=y.getMatrix();s.transform(x[0],x[1],x[2],x[3],x[4],x[5]),s.beginPath();let $;if(c)$=c.call(this,s,this);else{var L=this.clipX(),k=this.clipY();s.rect(L,k,o,l)}s.clip.apply(s,$),x=y.copy().invert().getMatrix(),s.transform(x[0],x[1],x[2],x[3],x[4],x[5])}var M=!w&&this.globalCompositeOperation()!=="source-over"&&t==="drawScene";M&&(s.save(),s._applyGlobalCompositeOperation(this)),(n=this.children)===null||n===void 0||n.forEach(function($){$[t](e,i,r)}),M&&s.restore(),g&&s.restore()}getClientRect(t={}){var e,i=t.skipTransform,r=t.relativeTo,n,s,o,l,c={x:1/0,y:1/0,width:0,height:0},g=this;(e=this.children)===null||e===void 0||e.forEach(function(k){if(k.visible()){var M=k.getClientRect({relativeTo:g,skipShadow:t.skipShadow,skipStroke:t.skipStroke});M.width===0&&M.height===0||(n===void 0?(n=M.x,s=M.y,o=M.x+M.width,l=M.y+M.height):(n=Math.min(n,M.x),s=Math.min(s,M.y),o=Math.max(o,M.x+M.width),l=Math.max(l,M.y+M.height)))}});for(var w=this.find("Shape"),y=!1,x=0;x<w.length;x++){var L=w[x];if(L._isVisible(this)){y=!0;break}}return y&&n!==void 0?c={x:n,y:s,width:o-n,height:l-s}:c={x:0,y:0,width:0,height:0},i?c:this._transformedRect(c,r)}}Kt.Container=Vt,jt.Factory.addComponentsGetterSetter(Vt,"clip",["x","y","width","height"]),jt.Factory.addGetterSetter(Vt,"clipX",void 0,(0,Ee.getNumberValidator)()),jt.Factory.addGetterSetter(Vt,"clipY",void 0,(0,Ee.getNumberValidator)()),jt.Factory.addGetterSetter(Vt,"clipWidth",void 0,(0,Ee.getNumberValidator)()),jt.Factory.addGetterSetter(Vt,"clipHeight",void 0,(0,Ee.getNumberValidator)()),jt.Factory.addGetterSetter(Vt,"clipFunc");var ft={};Object.defineProperty(ft,"__esModule",{value:!0}),ft.releaseCapture=ft.setPointerCapture=ft.hasPointerCapture=ft.createEvent=ft.getCapturedShape=void 0;const $r=ht,le=new Map,ci=$r.Konva._global.PointerEvent!==void 0;function Ar(a){return le.get(a)}ft.getCapturedShape=Ar;function Be(a){return{evt:a,pointerId:a.pointerId}}ft.createEvent=Be;function Rr(a,t){return le.get(a)===t}ft.hasPointerCapture=Rr;function Dr(a,t){ui(a),t.getStage()&&(le.set(a,t),ci&&t._fire("gotpointercapture",Be(new PointerEvent("gotpointercapture"))))}ft.setPointerCapture=Dr;function ui(a,t){const e=le.get(a);if(!e)return;const i=e.getStage();i&&i.content,le.delete(a),ci&&e._fire("lostpointercapture",Be(new PointerEvent("lostpointercapture")))}ft.releaseCapture=ui,function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.Stage=a.stages=void 0;const t=ct,e=bt,i=Kt,r=ht,n=kt,s=Me,o=ht,l=ft;var c="Stage",g="string",w="px",y="mouseout",x="mouseleave",L="mouseover",k="mouseenter",M="mousemove",$="mousedown",U="mouseup",h="pointermove",d="pointerdown",p="pointerup",C="pointercancel",T="lostpointercapture",f="pointerout",E="pointerleave",v="pointerover",_="pointerenter",P="contextmenu",S="touchstart",O="touchend",D="touchmove",it="touchcancel",A="wheel",N=5,F=[[k,"_pointerenter"],[$,"_pointerdown"],[M,"_pointermove"],[U,"_pointerup"],[x,"_pointerleave"],[S,"_pointerdown"],[D,"_pointermove"],[O,"_pointerup"],[it,"_pointercancel"],[L,"_pointerover"],[A,"_wheel"],[P,"_contextmenu"],[d,"_pointerdown"],[h,"_pointermove"],[p,"_pointerup"],[C,"_pointercancel"],[T,"_lostpointercapture"]];const B={mouse:{[f]:y,[E]:x,[v]:L,[_]:k,[h]:M,[d]:$,[p]:U,[C]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[f]:"touchout",[E]:"touchleave",[v]:"touchover",[_]:"touchenter",[h]:D,[d]:S,[p]:O,[C]:it,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[f]:f,[E]:E,[v]:v,[_]:_,[h]:h,[d]:d,[p]:p,[C]:C,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},X=Q=>Q.indexOf("pointer")>=0?"pointer":Q.indexOf("touch")>=0?"touch":"mouse",at=Q=>{const u=X(Q);if(u==="pointer")return r.Konva.pointerEventsEnabled&&B.pointer;if(u==="touch")return B.touch;if(u==="mouse")return B.mouse};function dt(Q={}){return(Q.clipFunc||Q.clipWidth||Q.clipHeight)&&t.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),Q}const lt="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";a.stages=[];class wt extends i.Container{constructor(u){super(dt(u)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),a.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{dt(this.attrs)}),this._checkVisibility()}_validateAdd(u){const b=u.getType()==="Layer",R=u.getType()==="FastLayer";b||R||t.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const u=this.visible()?"":"none";this.content.style.display=u}setContainer(u){if(typeof u===g){if(u.charAt(0)==="."){var b=u.slice(1);u=document.getElementsByClassName(b)[0]}else{var R;u.charAt(0)!=="#"?R=u:R=u.slice(1),u=document.getElementById(R)}if(!u)throw"Can not find container in document with id "+R}return this._setAttr("container",u),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),u.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){var u=this.children,b=u.length,R;for(R=0;R<b;R++)u[R].clear();return this}clone(u){return u||(u={}),u.container=typeof document<"u"&&document.createElement("div"),i.Container.prototype.clone.call(this,u)}destroy(){super.destroy();var u=this.content;u&&t.Util._isInDocument(u)&&this.container().removeChild(u);var b=a.stages.indexOf(this);return b>-1&&a.stages.splice(b,1),t.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const u=this._pointerPositions[0]||this._changedPointerPositions[0];return u?{x:u.x,y:u.y}:(t.Util.warn(lt),null)}_getPointerById(u){return this._pointerPositions.find(b=>b.id===u)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(u){u=u||{},u.x=u.x||0,u.y=u.y||0,u.width=u.width||this.width(),u.height=u.height||this.height();var b=new n.SceneCanvas({width:u.width,height:u.height,pixelRatio:u.pixelRatio||1}),R=b.getContext()._context,V=this.children;return(u.x||u.y)&&R.translate(-1*u.x,-1*u.y),V.forEach(function(W){if(W.isVisible()){var q=W._toKonvaCanvas(u);R.drawImage(q._canvas,u.x,u.y,q.getWidth()/q.getPixelRatio(),q.getHeight()/q.getPixelRatio())}}),b}getIntersection(u){if(!u)return null;var b=this.children,R=b.length,V=R-1,W;for(W=V;W>=0;W--){const q=b[W].getIntersection(u);if(q)return q}return null}_resizeDOM(){var u=this.width(),b=this.height();this.content&&(this.content.style.width=u+w,this.content.style.height=b+w),this.bufferCanvas.setSize(u,b),this.bufferHitCanvas.setSize(u,b),this.children.forEach(R=>{R.setSize({width:u,height:b}),R.draw()})}add(u,...b){if(arguments.length>1){for(var R=0;R<arguments.length;R++)this.add(arguments[R]);return this}super.add(u);var V=this.children.length;return V>N&&t.Util.warn("The stage has "+V+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),u.setSize({width:this.width(),height:this.height()}),u.draw(),r.Konva.isBrowser&&this.content.appendChild(u.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(u){return l.hasPointerCapture(u,this)}setPointerCapture(u){l.setPointerCapture(u,this)}releaseCapture(u){l.releaseCapture(u,this)}getLayers(){return this.children}_bindContentEvents(){r.Konva.isBrowser&&F.forEach(([u,b])=>{this.content.addEventListener(u,R=>{this[b](R)},{passive:!1})})}_pointerenter(u){this.setPointersPositions(u);const b=at(u.type);b&&this._fire(b.pointerenter,{evt:u,target:this,currentTarget:this})}_pointerover(u){this.setPointersPositions(u);const b=at(u.type);b&&this._fire(b.pointerover,{evt:u,target:this,currentTarget:this})}_getTargetShape(u){let b=this[u+"targetShape"];return b&&!b.getStage()&&(b=null),b}_pointerleave(u){const b=at(u.type),R=X(u.type);if(b){this.setPointersPositions(u);var V=this._getTargetShape(R),W=!s.DD.isDragging||r.Konva.hitOnDragEnabled;V&&W?(V._fireAndBubble(b.pointerout,{evt:u}),V._fireAndBubble(b.pointerleave,{evt:u}),this._fire(b.pointerleave,{evt:u,target:this,currentTarget:this}),this[R+"targetShape"]=null):W&&(this._fire(b.pointerleave,{evt:u,target:this,currentTarget:this}),this._fire(b.pointerout,{evt:u,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}}_pointerdown(u){const b=at(u.type),R=X(u.type);if(b){this.setPointersPositions(u);var V=!1;this._changedPointerPositions.forEach(W=>{var q=this.getIntersection(W);if(s.DD.justDragged=!1,r.Konva["_"+R+"ListenClick"]=!0,!q||!q.isListening())return;r.Konva.capturePointerEventsEnabled&&q.setPointerCapture(W.id),this[R+"ClickStartShape"]=q,q._fireAndBubble(b.pointerdown,{evt:u,pointerId:W.id}),V=!0;const _t=u.type.indexOf("touch")>=0;q.preventDefault()&&u.cancelable&&_t&&u.preventDefault()}),V||this._fire(b.pointerdown,{evt:u,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}}_pointermove(u){const b=at(u.type),R=X(u.type);if(!b)return;s.DD.isDragging&&s.DD.node.preventDefault()&&u.cancelable&&u.preventDefault(),this.setPointersPositions(u);var V=!s.DD.isDragging||r.Konva.hitOnDragEnabled;if(!V)return;var W={};let q=!1;var _t=this._getTargetShape(R);this._changedPointerPositions.forEach(Ut=>{const Z=l.getCapturedShape(Ut.id)||this.getIntersection(Ut),ne=Ut.id,Dt={evt:u,pointerId:ne};var ae=_t!==Z;if(ae&&_t&&(_t._fireAndBubble(b.pointerout,{...Dt},Z),_t._fireAndBubble(b.pointerleave,{...Dt},Z)),Z){if(W[Z._id])return;W[Z._id]=!0}Z&&Z.isListening()?(q=!0,ae&&(Z._fireAndBubble(b.pointerover,{...Dt},_t),Z._fireAndBubble(b.pointerenter,{...Dt},_t),this[R+"targetShape"]=Z),Z._fireAndBubble(b.pointermove,{...Dt})):_t&&(this._fire(b.pointerover,{evt:u,target:this,currentTarget:this,pointerId:ne}),this[R+"targetShape"]=null)}),q||this._fire(b.pointermove,{evt:u,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(u){const b=at(u.type),R=X(u.type);if(!b)return;this.setPointersPositions(u);const V=this[R+"ClickStartShape"],W=this[R+"ClickEndShape"];var q={};let _t=!1;this._changedPointerPositions.forEach(Ut=>{const Z=l.getCapturedShape(Ut.id)||this.getIntersection(Ut);if(Z){if(Z.releaseCapture(Ut.id),q[Z._id])return;q[Z._id]=!0}const ne=Ut.id,Dt={evt:u,pointerId:ne};let ae=!1;r.Konva["_"+R+"InDblClickWindow"]?(ae=!0,clearTimeout(this[R+"DblTimeout"])):s.DD.justDragged||(r.Konva["_"+R+"InDblClickWindow"]=!0,clearTimeout(this[R+"DblTimeout"])),this[R+"DblTimeout"]=setTimeout(function(){r.Konva["_"+R+"InDblClickWindow"]=!1},r.Konva.dblClickWindow),Z&&Z.isListening()?(_t=!0,this[R+"ClickEndShape"]=Z,Z._fireAndBubble(b.pointerup,{...Dt}),r.Konva["_"+R+"ListenClick"]&&V&&V===Z&&(Z._fireAndBubble(b.pointerclick,{...Dt}),ae&&W&&W===Z&&Z._fireAndBubble(b.pointerdblclick,{...Dt}))):(this[R+"ClickEndShape"]=null,r.Konva["_"+R+"ListenClick"]&&this._fire(b.pointerclick,{evt:u,target:this,currentTarget:this,pointerId:ne}),ae&&this._fire(b.pointerdblclick,{evt:u,target:this,currentTarget:this,pointerId:ne}))}),_t||this._fire(b.pointerup,{evt:u,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),r.Konva["_"+R+"ListenClick"]=!1,u.cancelable&&R!=="touch"&&u.preventDefault()}_contextmenu(u){this.setPointersPositions(u);var b=this.getIntersection(this.getPointerPosition());b&&b.isListening()?b._fireAndBubble(P,{evt:u}):this._fire(P,{evt:u,target:this,currentTarget:this})}_wheel(u){this.setPointersPositions(u);var b=this.getIntersection(this.getPointerPosition());b&&b.isListening()?b._fireAndBubble(A,{evt:u}):this._fire(A,{evt:u,target:this,currentTarget:this})}_pointercancel(u){this.setPointersPositions(u);const b=l.getCapturedShape(u.pointerId)||this.getIntersection(this.getPointerPosition());b&&b._fireAndBubble(p,l.createEvent(u)),l.releaseCapture(u.pointerId)}_lostpointercapture(u){l.releaseCapture(u.pointerId)}setPointersPositions(u){var b=this._getContentPosition(),R=null,V=null;u=u||window.event,u.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(u.touches,W=>{this._pointerPositions.push({id:W.identifier,x:(W.clientX-b.left)/b.scaleX,y:(W.clientY-b.top)/b.scaleY})}),Array.prototype.forEach.call(u.changedTouches||u.touches,W=>{this._changedPointerPositions.push({id:W.identifier,x:(W.clientX-b.left)/b.scaleX,y:(W.clientY-b.top)/b.scaleY})})):(R=(u.clientX-b.left)/b.scaleX,V=(u.clientY-b.top)/b.scaleY,this.pointerPos={x:R,y:V},this._pointerPositions=[{x:R,y:V,id:t.Util._getFirstPointerId(u)}],this._changedPointerPositions=[{x:R,y:V,id:t.Util._getFirstPointerId(u)}])}_setPointerPosition(u){t.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(u)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};var u=this.content.getBoundingClientRect();return{top:u.top,left:u.left,scaleX:u.width/this.content.clientWidth||1,scaleY:u.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new n.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new n.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!!r.Konva.isBrowser){var u=this.container();if(!u)throw"Stage has no container. A container is required.";u.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),u.appendChild(this.content),this._resizeDOM()}}cache(){return t.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(u){u.batchDraw()}),this}}a.Stage=wt,wt.prototype.nodeType=c,(0,o._registerNode)(wt),e.Factory.addGetterSetter(wt,"container")}(se);var Ne={},mt={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.Shape=a.shapes=void 0;const t=ht,e=ct,i=bt,r=It,n=z,s=ht,o=ft;var l="hasShadow",c="shadowRGBA",g="patternImage",w="linearGradient",y="radialGradient";let x;function L(){return x||(x=e.Util.createCanvasElement().getContext("2d"),x)}a.shapes={};function k(E){const v=this.attrs.fillRule;v?E.fill(v):E.fill()}function M(E){E.stroke()}function $(E){E.fill()}function U(E){E.stroke()}function h(){this._clearCache(l)}function d(){this._clearCache(c)}function p(){this._clearCache(g)}function C(){this._clearCache(w)}function T(){this._clearCache(y)}class f extends r.Node{constructor(v){super(v);let _;for(;_=e.Util.getRandomColor(),!(_&&!(_ in a.shapes)););this.colorKey=_,a.shapes[_]=this}getContext(){return e.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return e.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(l,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(g,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){var v=L();const _=v.createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(_&&_.setTransform){const P=new e.Transform;P.translate(this.fillPatternX(),this.fillPatternY()),P.rotate(t.Konva.getAngle(this.fillPatternRotation())),P.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),P.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const S=P.getMatrix(),O=typeof DOMMatrix>"u"?{a:S[0],b:S[1],c:S[2],d:S[3],e:S[4],f:S[5]}:new DOMMatrix(S);_.setTransform(O)}return _}}_getLinearGradient(){return this._getCache(w,this.__getLinearGradient)}__getLinearGradient(){var v=this.fillLinearGradientColorStops();if(v){for(var _=L(),P=this.fillLinearGradientStartPoint(),S=this.fillLinearGradientEndPoint(),O=_.createLinearGradient(P.x,P.y,S.x,S.y),D=0;D<v.length;D+=2)O.addColorStop(v[D],v[D+1]);return O}}_getRadialGradient(){return this._getCache(y,this.__getRadialGradient)}__getRadialGradient(){var v=this.fillRadialGradientColorStops();if(v){for(var _=L(),P=this.fillRadialGradientStartPoint(),S=this.fillRadialGradientEndPoint(),O=_.createRadialGradient(P.x,P.y,this.fillRadialGradientStartRadius(),S.x,S.y,this.fillRadialGradientEndRadius()),D=0;D<v.length;D+=2)O.addColorStop(v[D],v[D+1]);return O}}getShadowRGBA(){return this._getCache(c,this._getShadowRGBA)}_getShadowRGBA(){if(this.hasShadow()){var v=e.Util.colorToRGBA(this.shadowColor());if(v)return"rgba("+v.r+","+v.g+","+v.b+","+v.a*(this.shadowOpacity()||1)+")"}}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const v=this.hitStrokeWidth();return v==="auto"?this.hasStroke():this.strokeEnabled()&&!!v}intersects(v){var _=this.getStage();if(!_)return!1;const P=_.bufferHitCanvas;return P.getContext().clear(),this.drawHit(P,void 0,!0),P.context.getImageData(Math.round(v.x),Math.round(v.y),1,1).data[3]>0}destroy(){return r.Node.prototype.destroy.call(this),delete a.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(v){var _;if(!((_=this.attrs.perfectDrawEnabled)!==null&&_!==void 0?_:!0))return!1;const S=v||this.hasFill(),O=this.hasStroke(),D=this.getAbsoluteOpacity()!==1;if(S&&O&&D)return!0;const it=this.hasShadow(),A=this.shadowForStrokeEnabled();return!!(S&&O&&it&&A)}setStrokeHitEnabled(v){e.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),v?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){var v=this.size();return{x:this._centroid?-v.width/2:0,y:this._centroid?-v.height/2:0,width:v.width,height:v.height}}getClientRect(v={}){const _=v.skipTransform,P=v.relativeTo,S=this.getSelfRect(),D=!v.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,it=S.width+D,A=S.height+D,N=!v.skipShadow&&this.hasShadow(),F=N?this.shadowOffsetX():0,B=N?this.shadowOffsetY():0,X=it+Math.abs(F),at=A+Math.abs(B),dt=N&&this.shadowBlur()||0,lt=X+dt*2,wt=at+dt*2,Q={width:lt,height:wt,x:-(D/2+dt)+Math.min(F,0)+S.x,y:-(D/2+dt)+Math.min(B,0)+S.y};return _?Q:this._transformedRect(Q,P)}drawScene(v,_,P){var S=this.getLayer(),O=v||S.getCanvas(),D=O.getContext(),it=this._getCanvasCache(),A=this.getSceneFunc(),N=this.hasShadow(),F,B,X=O.isCache,at=_===this;if(!this.isVisible()&&!at)return this;if(it){D.save();var dt=this.getAbsoluteTransform(_).getMatrix();return D.transform(dt[0],dt[1],dt[2],dt[3],dt[4],dt[5]),this._drawCachedSceneCanvas(D),D.restore(),this}if(!A)return this;if(D.save(),this._useBufferCanvas()&&!X){F=this.getStage();const Q=P||F.bufferCanvas;B=Q.getContext(),B.clear(),B.save(),B._applyLineJoin(this);var lt=this.getAbsoluteTransform(_).getMatrix();B.transform(lt[0],lt[1],lt[2],lt[3],lt[4],lt[5]),A.call(this,B,this),B.restore();var wt=Q.pixelRatio;N&&D._applyShadow(this),D._applyOpacity(this),D._applyGlobalCompositeOperation(this),D.drawImage(Q._canvas,0,0,Q.width/wt,Q.height/wt)}else{if(D._applyLineJoin(this),!at){var lt=this.getAbsoluteTransform(_).getMatrix();D.transform(lt[0],lt[1],lt[2],lt[3],lt[4],lt[5]),D._applyOpacity(this),D._applyGlobalCompositeOperation(this)}N&&D._applyShadow(this),A.call(this,D,this)}return D.restore(),this}drawHit(v,_,P=!1){if(!this.shouldDrawHit(_,P))return this;var S=this.getLayer(),O=v||S.hitCanvas,D=O&&O.getContext(),it=this.hitFunc()||this.sceneFunc(),A=this._getCanvasCache(),N=A&&A.hit;if(this.colorKey||e.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),N){D.save();var F=this.getAbsoluteTransform(_).getMatrix();return D.transform(F[0],F[1],F[2],F[3],F[4],F[5]),this._drawCachedHitCanvas(D),D.restore(),this}if(!it)return this;if(D.save(),D._applyLineJoin(this),!(this===_)){var X=this.getAbsoluteTransform(_).getMatrix();D.transform(X[0],X[1],X[2],X[3],X[4],X[5])}return it.call(this,D,this),D.restore(),this}drawHitFromCache(v=0){var _=this._getCanvasCache(),P=this._getCachedSceneCanvas(),S=_.hit,O=S.getContext(),D=S.getWidth(),it=S.getHeight(),A,N,F,B,X,at;O.clear(),O.drawImage(P._canvas,0,0,D,it);try{for(A=O.getImageData(0,0,D,it),N=A.data,F=N.length,B=e.Util._hexToRgb(this.colorKey),X=0;X<F;X+=4)at=N[X+3],at>v?(N[X]=B.r,N[X+1]=B.g,N[X+2]=B.b,N[X+3]=255):N[X+3]=0;O.putImageData(A,0,0)}catch(dt){e.Util.error("Unable to draw hit graph from cached scene canvas. "+dt.message)}return this}hasPointerCapture(v){return o.hasPointerCapture(v,this)}setPointerCapture(v){o.setPointerCapture(v,this)}releaseCapture(v){o.releaseCapture(v,this)}}a.Shape=f,f.prototype._fillFunc=k,f.prototype._strokeFunc=M,f.prototype._fillFuncHit=$,f.prototype._strokeFuncHit=U,f.prototype._centroid=!1,f.prototype.nodeType="Shape",(0,s._registerNode)(f),f.prototype.eventListeners={},f.prototype.on.call(f.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",h),f.prototype.on.call(f.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",d),f.prototype.on.call(f.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",p),f.prototype.on.call(f.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",C),f.prototype.on.call(f.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",T),i.Factory.addGetterSetter(f,"stroke",void 0,(0,n.getStringOrGradientValidator)()),i.Factory.addGetterSetter(f,"strokeWidth",2,(0,n.getNumberValidator)()),i.Factory.addGetterSetter(f,"fillAfterStrokeEnabled",!1),i.Factory.addGetterSetter(f,"hitStrokeWidth","auto",(0,n.getNumberOrAutoValidator)()),i.Factory.addGetterSetter(f,"strokeHitEnabled",!0,(0,n.getBooleanValidator)()),i.Factory.addGetterSetter(f,"perfectDrawEnabled",!0,(0,n.getBooleanValidator)()),i.Factory.addGetterSetter(f,"shadowForStrokeEnabled",!0,(0,n.getBooleanValidator)()),i.Factory.addGetterSetter(f,"lineJoin"),i.Factory.addGetterSetter(f,"lineCap"),i.Factory.addGetterSetter(f,"sceneFunc"),i.Factory.addGetterSetter(f,"hitFunc"),i.Factory.addGetterSetter(f,"dash"),i.Factory.addGetterSetter(f,"dashOffset",0,(0,n.getNumberValidator)()),i.Factory.addGetterSetter(f,"shadowColor",void 0,(0,n.getStringValidator)()),i.Factory.addGetterSetter(f,"shadowBlur",0,(0,n.getNumberValidator)()),i.Factory.addGetterSetter(f,"shadowOpacity",1,(0,n.getNumberValidator)()),i.Factory.addComponentsGetterSetter(f,"shadowOffset",["x","y"]),i.Factory.addGetterSetter(f,"shadowOffsetX",0,(0,n.getNumberValidator)()),i.Factory.addGetterSetter(f,"shadowOffsetY",0,(0,n.getNumberValidator)()),i.Factory.addGetterSetter(f,"fillPatternImage"),i.Factory.addGetterSetter(f,"fill",void 0,(0,n.getStringOrGradientValidator)()),i.Factory.addGetterSetter(f,"fillPatternX",0,(0,n.getNumberValidator)()),i.Factory.addGetterSetter(f,"fillPatternY",0,(0,n.getNumberValidator)()),i.Factory.addGetterSetter(f,"fillLinearGradientColorStops"),i.Factory.addGetterSetter(f,"strokeLinearGradientColorStops"),i.Factory.addGetterSetter(f,"fillRadialGradientStartRadius",0),i.Factory.addGetterSetter(f,"fillRadialGradientEndRadius",0),i.Factory.addGetterSetter(f,"fillRadialGradientColorStops"),i.Factory.addGetterSetter(f,"fillPatternRepeat","repeat"),i.Factory.addGetterSetter(f,"fillEnabled",!0),i.Factory.addGetterSetter(f,"strokeEnabled",!0),i.Factory.addGetterSetter(f,"shadowEnabled",!0),i.Factory.addGetterSetter(f,"dashEnabled",!0),i.Factory.addGetterSetter(f,"strokeScaleEnabled",!0),i.Factory.addGetterSetter(f,"fillPriority","color"),i.Factory.addComponentsGetterSetter(f,"fillPatternOffset",["x","y"]),i.Factory.addGetterSetter(f,"fillPatternOffsetX",0,(0,n.getNumberValidator)()),i.Factory.addGetterSetter(f,"fillPatternOffsetY",0,(0,n.getNumberValidator)()),i.Factory.addComponentsGetterSetter(f,"fillPatternScale",["x","y"]),i.Factory.addGetterSetter(f,"fillPatternScaleX",1,(0,n.getNumberValidator)()),i.Factory.addGetterSetter(f,"fillPatternScaleY",1,(0,n.getNumberValidator)()),i.Factory.addComponentsGetterSetter(f,"fillLinearGradientStartPoint",["x","y"]),i.Factory.addComponentsGetterSetter(f,"strokeLinearGradientStartPoint",["x","y"]),i.Factory.addGetterSetter(f,"fillLinearGradientStartPointX",0),i.Factory.addGetterSetter(f,"strokeLinearGradientStartPointX",0),i.Factory.addGetterSetter(f,"fillLinearGradientStartPointY",0),i.Factory.addGetterSetter(f,"strokeLinearGradientStartPointY",0),i.Factory.addComponentsGetterSetter(f,"fillLinearGradientEndPoint",["x","y"]),i.Factory.addComponentsGetterSetter(f,"strokeLinearGradientEndPoint",["x","y"]),i.Factory.addGetterSetter(f,"fillLinearGradientEndPointX",0),i.Factory.addGetterSetter(f,"strokeLinearGradientEndPointX",0),i.Factory.addGetterSetter(f,"fillLinearGradientEndPointY",0),i.Factory.addGetterSetter(f,"strokeLinearGradientEndPointY",0),i.Factory.addComponentsGetterSetter(f,"fillRadialGradientStartPoint",["x","y"]),i.Factory.addGetterSetter(f,"fillRadialGradientStartPointX",0),i.Factory.addGetterSetter(f,"fillRadialGradientStartPointY",0),i.Factory.addComponentsGetterSetter(f,"fillRadialGradientEndPoint",["x","y"]),i.Factory.addGetterSetter(f,"fillRadialGradientEndPointX",0),i.Factory.addGetterSetter(f,"fillRadialGradientEndPointY",0),i.Factory.addGetterSetter(f,"fillPatternRotation",0),i.Factory.addGetterSetter(f,"fillRule",void 0,(0,n.getStringValidator)()),i.Factory.backCompat(f,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})})(mt),Object.defineProperty(Ne,"__esModule",{value:!0});var de=Ne.Layer=void 0;const At=ct,Ue=Kt,qt=It,Ie=bt,gi=kt,Mr=z,Or=mt,Gr=ht;var Fr="#",Br="beforeDraw",Nr="draw",fi=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],Ur=fi.length;class Zt extends Ue.Container{constructor(t){super(t),this.canvas=new gi.SceneCanvas,this.hitCanvas=new gi.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(t){return this.getContext().clear(t),this.getHitCanvas().getContext().clear(t),this}setZIndex(t){super.setZIndex(t);var e=this.getStage();return e&&e.content&&(e.content.removeChild(this.getNativeCanvasElement()),t<e.children.length-1?e.content.insertBefore(this.getNativeCanvasElement(),e.children[t+1].getCanvas()._canvas):e.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){qt.Node.prototype.moveToTop.call(this);var t=this.getStage();return t&&t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){var t=qt.Node.prototype.moveUp.call(this);if(!t)return!1;var e=this.getStage();return!e||!e.content?!1:(e.content.removeChild(this.getNativeCanvasElement()),this.index<e.children.length-1?e.content.insertBefore(this.getNativeCanvasElement(),e.children[this.index+1].getCanvas()._canvas):e.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(qt.Node.prototype.moveDown.call(this)){var t=this.getStage();if(t){var e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(qt.Node.prototype.moveToBottom.call(this)){var t=this.getStage();if(t){var e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){var t=this.getNativeCanvasElement();return qt.Node.prototype.remove.call(this),t&&t.parentNode&&At.Util._isInDocument(t)&&t.parentNode.removeChild(t),this}getStage(){return this.parent}setSize({width:t,height:e}){return this.canvas.setSize(t,e),this.hitCanvas.setSize(t,e),this._setSmoothEnabled(),this}_validateAdd(t){var e=t.getType();e!=="Group"&&e!=="Shape"&&At.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(t){return t=t||{},t.width=t.width||this.getWidth(),t.height=t.height||this.getHeight(),t.x=t.x!==void 0?t.x:this.x(),t.y=t.y!==void 0?t.y:this.y(),qt.Node.prototype._toKonvaCanvas.call(this,t)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){At.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){At.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,At.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(t){if(!this.isListening()||!this.isVisible())return null;for(var e=1,i=!1;;){for(let r=0;r<Ur;r++){const n=fi[r],s=this._getIntersection({x:t.x+n.x*e,y:t.y+n.y*e}),o=s.shape;if(o)return o;if(i=!!s.antialiased,!s.antialiased)break}if(i)e+=1;else return null}}_getIntersection(t){const e=this.hitCanvas.pixelRatio,i=this.hitCanvas.context.getImageData(Math.round(t.x*e),Math.round(t.y*e),1,1).data,r=i[3];if(r===255){const n=At.Util._rgbToHex(i[0],i[1],i[2]),s=Or.shapes[Fr+n];return s?{shape:s}:{antialiased:!0}}else if(r>0)return{antialiased:!0};return{}}drawScene(t,e){var i=this.getLayer(),r=t||i&&i.getCanvas();return this._fire(Br,{node:this}),this.clearBeforeDraw()&&r.getContext().clear(),Ue.Container.prototype.drawScene.call(this,r,e),this._fire(Nr,{node:this}),this}drawHit(t,e){var i=this.getLayer(),r=t||i&&i.hitCanvas;return i&&i.clearBeforeDraw()&&i.getHitCanvas().getContext().clear(),Ue.Container.prototype.drawHit.call(this,r,e),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(t){At.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(t)}getHitGraphEnabled(t){return At.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!(!this.parent||!this.parent.content)){var t=this.parent,e=!!this.hitCanvas._canvas.parentNode;e?t.content.removeChild(this.hitCanvas._canvas):t.content.appendChild(this.hitCanvas._canvas)}}destroy(){return At.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}}de=Ne.Layer=Zt,Zt.prototype.nodeType="Layer",(0,Gr._registerNode)(Zt),Ie.Factory.addGetterSetter(Zt,"imageSmoothingEnabled",!0),Ie.Factory.addGetterSetter(Zt,"clearBeforeDraw",!0),Ie.Factory.addGetterSetter(Zt,"hitGraphEnabled",!0,(0,Mr.getBooleanValidator)());const ka="";function He(a){return a===Object(a)&&!Array.isArray(a)&&typeof a!="function"}function Ir(a){return typeof a<"u"&&a!==""&&a!==null}function ze(a,t){if(!t)return a;const e={...a};return He(a)&&He(t)&&Object.keys(t).forEach(i=>{He(t[i])?i in a?e[i]=ze(a[i],t[i]):Object.assign(e,{[i]:t[i]}):Ir(t[i])&&Object.assign(e,{[i]:t[i]})}),e}function Tt(a){const t=document.createElement("div");return t.innerHTML=a,t.firstElementChild}class ce{constructor(t,e,i,r,n){m(this,"$container");m(this,"$icon");m(this,"disabled",!1);m(this,"$button");m(this,"id");m(this,"shortcut");this.drawer=t,this.id=e,this.$container=document.createElement("div"),this.$container.classList.add("drawer-tool-container","drawer-tool-button-container",`drawer-internal-widgetId--${e.replace(/\W/g,"-")}`),this.$button=document.createElement("button"),this.$button.classList.add("drawer-button"),this.$button.setAttribute("role","button"),this.$button.tabIndex=0,this.$button.title=i??e,this.$icon=typeof r=="string"?Tt(r):r,this.shortcut=n,this._initEvents()}addTo(t){if(this.$container.appendChild(this.$button),this.$button.append(this.$icon),this.shortcut){const e=document.createElement("div");e.classList.add("tool-key-shortcut"),e.innerText=this.shortcut,this.$button.append(e)}t.appendChild(this.$container)}toggleDisable(){this.disabled=!this.disabled,this.$button.classList.add("disabled")}_initEvents(){this.$button.addEventListener("click",()=>{this.setActive(!0)})}setActive(t){t?(this.drawer.activeWidget&&this.drawer.activeWidget.setActive(!1),this.drawer.toolbar.setActiveWidget(this),this.$button.classList.add("active"),this.onActive(),this.drawer.focus()):(this.onDesactive(),this.$button.classList.remove("active"))}}const Hr=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE xml>
<svg aria-hidden="true" focusable="false" role="img" viewBox="0 0 20 20" class="" fill="none"
    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
    <g stroke-width="1.25">
        <path clip-rule="evenodd"
            d="m7.643 15.69 7.774-7.773a2.357 2.357 0 1 0-3.334-3.334L4.31 12.357a3.333 3.333 0 0 0-.977 2.357v1.953h1.953c.884 0 1.732-.352 2.357-.977Z"></path>
        <path d="m11.25 5.417 3.333 3.333"></path>
    </g>
</svg>
`;var Ve={};Object.defineProperty(Ve,"__esModule",{value:!0});var pt=Ve.Line=void 0;const ke=bt,zr=mt,pi=z,Vr=ht;function We(a,t,e,i,r,n,s){var o=Math.sqrt(Math.pow(e-a,2)+Math.pow(i-t,2)),l=Math.sqrt(Math.pow(r-e,2)+Math.pow(n-i,2)),c=s*o/(o+l),g=s*l/(o+l),w=e-c*(r-a),y=i-c*(n-t),x=e+g*(r-a),L=i+g*(n-t);return[w,y,x,L]}function vi(a,t){var e=a.length,i=[],r,n;for(r=2;r<e-2;r+=2)n=We(a[r-2],a[r-1],a[r],a[r+1],a[r+2],a[r+3],t),!isNaN(n[0])&&(i.push(n[0]),i.push(n[1]),i.push(a[r]),i.push(a[r+1]),i.push(n[2]),i.push(n[3]));return i}class Ft extends zr.Shape{constructor(t){super(t),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(t){var e=this.points(),i=e.length,r=this.tension(),n=this.closed(),s=this.bezier(),o,l,c;if(i){if(t.beginPath(),t.moveTo(e[0],e[1]),r!==0&&i>4){for(o=this.getTensionPoints(),l=o.length,c=n?0:4,n||t.quadraticCurveTo(o[0],o[1],o[2],o[3]);c<l-2;)t.bezierCurveTo(o[c++],o[c++],o[c++],o[c++],o[c++],o[c++]);n||t.quadraticCurveTo(o[l-2],o[l-1],e[i-2],e[i-1])}else if(s)for(c=2;c<i;)t.bezierCurveTo(e[c++],e[c++],e[c++],e[c++],e[c++],e[c++]);else for(c=2;c<i;c+=2)t.lineTo(e[c],e[c+1]);n?(t.closePath(),t.fillStrokeShape(this)):t.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():vi(this.points(),this.tension())}_getTensionPointsClosed(){var t=this.points(),e=t.length,i=this.tension(),r=We(t[e-2],t[e-1],t[0],t[1],t[2],t[3],i),n=We(t[e-4],t[e-3],t[e-2],t[e-1],t[0],t[1],i),s=vi(t,i),o=[r[2],r[3]].concat(s).concat([n[0],n[1],t[e-2],t[e-1],n[2],n[3],r[0],r[1],t[0],t[1]]);return o}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){var t=this.points();if(t.length<4)return{x:t[0]||0,y:t[1]||0,width:0,height:0};this.tension()!==0?t=[t[0],t[1],...this._getTensionPoints(),t[t.length-2],t[t.length-1]]:t=this.points();for(var e=t[0],i=t[0],r=t[1],n=t[1],s,o,l=0;l<t.length/2;l++)s=t[l*2],o=t[l*2+1],e=Math.min(e,s),i=Math.max(i,s),r=Math.min(r,o),n=Math.max(n,o);return{x:e,y:r,width:i-e,height:n-r}}}pt=Ve.Line=Ft,Ft.prototype.className="Line",Ft.prototype._attrsAffectingSize=["points","bezier","tension"],(0,Vr._registerNode)(Ft),ke.Factory.addGetterSetter(Ft,"closed",!1),ke.Factory.addGetterSetter(Ft,"bezier",!1),ke.Factory.addGetterSetter(Ft,"tension",0,(0,pi.getNumberValidator)()),ke.Factory.addGetterSetter(Ft,"points",[],(0,pi.getNumberArrayValidator)());const Wr=`<svg aria-hidden="true" focusable="false" role="img" viewBox="0 0 20 20" class="" fill="none"\r
    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">\r
    <path d="M5 10h10" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"\r
        stroke-linejoin="round"></path>\r
</svg>`,Ta="",mi={id:"drawer-"+Date.now(),tool:"brush",width:window.innerWidth,height:window.innerHeight,strokeWidth:5,strokeColor:"#000",zoom:!0,zoomWidget:!0,scaling:1.11,autoSave:!0,localStorageKey:"free-drawing",opacity:1},gt={line:"drawer-line",text:"drawer-text",selection:"drawer-selection",guideLine:"drawer-guide-line",gridLine:"drawer-grid-line",background:"drawer-background"};class yi{constructor(t){m(this,"$overlayContainer");m(this,"drawer");m(this,"$strokeColorContainer");m(this,"$strokeColorBtnContainer");m(this,"$strokeWidthContainer");m(this,"$strokeWidthBtnContainer");m(this,"$fontSizeContainer");m(this,"$fontSizeBtnContainer");m(this,"$opacityContainer");m(this,"$opacityRange");m(this,"selectors",{container:"overlay-picker-container",buttonContainer:"overlay-picker-btn-container",button:"overlay-picker__button"});this.drawer=t,this.$overlayContainer=document.createElement("div"),this.$overlayContainer.classList.add("drawer-overlay-container","tool"),this.drawer.$drawerContainer.append(this.$overlayContainer),this._init()}_init(){this._createStrokeColorFields(),this._createStrokeWidthFields(),this._createFontsizeFields(),this._createOpacityField(),this.appendContent([this.$strokeColorContainer,this.$strokeWidthContainer,this.$fontSizeContainer,this.$opacityContainer])}_createStrokeColorFields(){this.$strokeColorContainer=document.createElement("div"),this.$strokeColorContainer.classList.add(this.selectors.container);const t=document.createElement("h6");t.classList.add("title"),t.innerText="Stroke",this.$strokeColorContainer.append(t),this.$strokeColorBtnContainer=document.createElement("div"),this.$strokeColorBtnContainer.classList.add(this.selectors.buttonContainer);const e=[];["#000","#e03131","#2f9e44","#1971c2","#f08c00"].forEach(r=>{const n=document.createElement("button");n.classList.add(this.selectors.button),n.style.backgroundColor=r,n.dataset.color=r,n.addEventListener("click",()=>{var s;(s=this.$strokeColorBtnContainer.querySelector(`.${this.selectors.button}.active`))==null||s.classList.remove("active"),n.classList.add("active"),this.drawer.setColor(r)}),e.push(n)}),this.$strokeColorBtnContainer.append(...e),this.$strokeColorContainer.append(this.$strokeColorBtnContainer)}_createStrokeWidthFields(){this.$strokeWidthContainer=document.createElement("div"),this.$strokeWidthContainer.classList.add(this.selectors.container);const t=document.createElement("h6");t.classList.add("title"),t.innerText="Stroke width",this.$strokeWidthContainer.append(t),this.$strokeWidthBtnContainer=document.createElement("div"),this.$strokeWidthBtnContainer.classList.add(this.selectors.buttonContainer);const e=[];[3,5,8,12].forEach(r=>{const n=document.createElement("button");n.innerHTML=Wr.replace('stroke-width="2.5"',`stroke-width="${r}"`),n.dataset.strokeWidth=r.toString(),n.classList.add("drawer-button",this.selectors.button),n.addEventListener("click",()=>{var s;(s=this.$strokeWidthBtnContainer.querySelector(`.${this.selectors.button}.active`))==null||s.classList.remove("active"),n.classList.add("active"),this.drawer.setStrokeWidth(n.dataset.strokeWidth)}),e.push(n)}),this.$strokeWidthBtnContainer.append(...e),this.$strokeWidthContainer.append(this.$strokeWidthBtnContainer)}_createFontsizeFields(){this.$fontSizeContainer=document.createElement("div"),this.$fontSizeContainer.classList.add(this.selectors.container);const t=document.createElement("h6");t.classList.add("title"),t.innerText="Font size",this.$fontSizeContainer.append(t),this.$fontSizeBtnContainer=document.createElement("div"),this.$fontSizeBtnContainer.classList.add(this.selectors.buttonContainer);const e=[];[{label:"S",value:10},{label:"M",value:15},{label:"L",value:20},{label:"XL",value:25}].forEach(r=>{const n=document.createElement("button");n.innerHTML=r.label,n.dataset.fontSize=r.value.toString(),n.classList.add("drawer-button",this.selectors.button),n.addEventListener("click",()=>{var s;(s=this.$fontSizeBtnContainer.querySelector(`.${this.selectors.button}.active`))==null||s.classList.remove("active"),n.classList.add("active"),this.drawer.setStrokeWidth(n.dataset.strokeWidth)}),e.push(n)}),this.$fontSizeBtnContainer.append(...e),this.$fontSizeContainer.append(this.$fontSizeBtnContainer)}_createOpacityField(){this.$opacityContainer=document.createElement("div"),this.$opacityContainer.classList.add("opacity-container");const t=document.createElement("h6");t.classList.add("title"),t.innerText="Opacity",this.$opacityContainer.append(t),this.$opacityRange=document.createElement("input"),this.$opacityRange.type="range",this.$opacityRange.min="0",this.$opacityRange.max="10",this.$opacityRange.step="1",this.$opacityRange.addEventListener("change",()=>{const e=Number(this.$opacityRange.value)/10;this.drawer.setOpacity(e)}),this.$opacityContainer.append(this.$opacityRange)}appendContent(t){this.$overlayContainer.append(...t)}show(t){var i,r;this.$overlayContainer.classList.add("show"),(i=this.$strokeColorBtnContainer.querySelector(`.${this.selectors.button}.active`))==null||i.classList.remove("active"),(r=this.$strokeWidthBtnContainer.querySelector(`.${this.selectors.button}.active`))==null||r.classList.remove("active");let e={color:this.drawer.options.strokeColor,strokeWidth:this.drawer.options.strokeWidth,opacity:this.drawer.options.opacity};t&&t[0]instanceof mt.Shape&&(e={color:t[0].stroke(),strokeWidth:t[0].strokeWidth(),opacity:t[0].opacity()}),this._updateFields(e,t)}_updateFields(t,e){var s,o;(s=this.$strokeColorBtnContainer.querySelector(`.${this.selectors.button}.active`))==null||s.classList.remove("active"),(o=this.$strokeWidthBtnContainer.querySelector(`.${this.selectors.button}.active`))==null||o.classList.remove("active");const i=this.$strokeColorBtnContainer.querySelector(`.${this.selectors.button}[data-color="${t.color}"]`);i&&i.classList.add("active");const r=e==null?void 0:e.filter(l=>l.hasName(gt.text));r!=null&&r.length&&(r==null?void 0:r.length)===(e==null?void 0:e.length)?this._setupTextOverlay():this._setupShapeOverlay();const n=this.$strokeWidthBtnContainer.querySelector(`.${this.selectors.button}[data-stroke-width="${t.strokeWidth}"]`);n&&n.classList.add("active"),this.$opacityRange.value=(t.opacity*10).toString()}_setupTextOverlay(){this.$strokeWidthContainer.style.display="none",this.$fontSizeContainer.style.display=""}_setupShapeOverlay(){this.$strokeWidthContainer.style.display="",this.$fontSizeContainer.style.display="none"}hide(){this.$overlayContainer.classList.remove("show")}}const La="";class Yr extends yi{constructor(t){super(t)}}function wi(a,t,e,i=r=>r){return a*i(.5-t*(.5-e))}function Xr(a){return[-a[0],-a[1]]}function Ct(a,t){return[a[0]+t[0],a[1]+t[1]]}function yt(a,t){return[a[0]-t[0],a[1]-t[1]]}function St(a,t){return[a[0]*t,a[1]*t]}function Kr(a,t){return[a[0]/t,a[1]/t]}function ue(a){return[a[1],-a[0]]}function _i(a,t){return a[0]*t[0]+a[1]*t[1]}function jr(a,t){return a[0]===t[0]&&a[1]===t[1]}function qr(a){return Math.hypot(a[0],a[1])}function Zr(a){return a[0]*a[0]+a[1]*a[1]}function bi(a,t){return Zr(yt(a,t))}function Ci(a){return Kr(a,qr(a))}function Jr(a,t){return Math.hypot(a[1]-t[1],a[0]-t[0])}function ge(a,t,e){let i=Math.sin(e),r=Math.cos(e),n=a[0]-t[0],s=a[1]-t[1],o=n*r-s*i,l=n*i+s*r;return[o+t[0],l+t[1]]}function Ye(a,t,e){return Ct(a,St(yt(t,a),e))}function Si(a,t,e){return Ct(a,St(t,e))}var{min:Jt,PI:Qr}=Math,xi=.275,fe=Qr+1e-4;function tn(a,t={}){let{size:e=16,smoothing:i=.5,thinning:r=.5,simulatePressure:n=!0,easing:s=A=>A,start:o={},end:l={},last:c=!1}=t,{cap:g=!0,easing:w=A=>A*(2-A)}=o,{cap:y=!0,easing:x=A=>--A*A*A+1}=l;if(a.length===0||e<=0)return[];let L=a[a.length-1].runningLength,k=o.taper===!1?0:o.taper===!0?Math.max(e,L):o.taper,M=l.taper===!1?0:l.taper===!0?Math.max(e,L):l.taper,$=Math.pow(e*i,2),U=[],h=[],d=a.slice(0,10).reduce((A,N)=>{let F=N.pressure;if(n){let B=Jt(1,N.distance/e),X=Jt(1,1-B);F=Jt(1,A+(X-A)*(B*xi))}return(A+F)/2},a[0].pressure),p=wi(e,r,a[a.length-1].pressure,s),C,T=a[0].vector,f=a[0].point,E=f,v=f,_=E,P=!1;for(let A=0;A<a.length;A++){let{pressure:N}=a[A],{point:F,vector:B,distance:X,runningLength:at}=a[A];if(A<a.length-1&&L-at<3)continue;if(r){if(n){let V=Jt(1,X/e),W=Jt(1,1-V);N=Jt(1,d+(W-d)*(V*xi))}p=wi(e,r,N,s)}else p=e/2;C===void 0&&(C=p);let dt=at<k?w(at/k):1,lt=L-at<M?x((L-at)/M):1;p=Math.max(.01,p*Math.min(dt,lt));let wt=(A<a.length-1?a[A+1]:a[A]).vector,Q=A<a.length-1?_i(B,wt):1,u=_i(B,T)<0&&!P,b=Q!==null&&Q<0;if(u||b){let V=St(ue(T),p);for(let W=.07692307692307693,q=0;q<=1;q+=W)v=ge(yt(F,V),F,fe*q),U.push(v),_=ge(Ct(F,V),F,fe*-q),h.push(_);f=v,E=_,b&&(P=!0);continue}if(P=!1,A===a.length-1){let V=St(ue(B),p);U.push(yt(F,V)),h.push(Ct(F,V));continue}let R=St(ue(Ye(wt,B,Q)),p);v=yt(F,R),(A<=1||bi(f,v)>$)&&(U.push(v),f=v),_=Ct(F,R),(A<=1||bi(E,_)>$)&&(h.push(_),E=_),d=N,T=B}let S=a[0].point.slice(0,2),O=a.length>1?a[a.length-1].point.slice(0,2):Ct(a[0].point,[1,1]),D=[],it=[];if(a.length===1){if(!(k||M)||c){let A=Si(S,Ci(ue(yt(S,O))),-(C||p)),N=[];for(let F=.07692307692307693,B=F;B<=1;B+=F)N.push(ge(A,S,fe*2*B));return N}}else{if(!(k||M&&a.length===1))if(g)for(let N=.07692307692307693,F=N;F<=1;F+=N){let B=ge(h[0],S,fe*F);D.push(B)}else{let N=yt(U[0],h[0]),F=St(N,.5),B=St(N,.51);D.push(yt(S,F),yt(S,B),Ct(S,B),Ct(S,F))}let A=ue(Xr(a[a.length-1].vector));if(M||k&&a.length===1)it.push(O);else if(y){let N=Si(O,A,p);for(let F=.034482758620689655,B=F;B<1;B+=F)it.push(ge(N,O,fe*3*B))}else it.push(Ct(O,St(A,p)),Ct(O,St(A,p*.99)),yt(O,St(A,p*.99)),yt(O,St(A,p)))}return U.concat(it,h.reverse(),D)}function en(a,t={}){var e;let{streamline:i=.5,size:r=16,last:n=!1}=t;if(a.length===0)return[];let s=.15+(1-i)*.85,o=Array.isArray(a[0])?a:a.map(({x,y:L,pressure:k=.5})=>[x,L,k]);if(o.length===2){let x=o[1];o=o.slice(0,-1);for(let L=1;L<5;L++)o.push(Ye(o[0],x,L/4))}o.length===1&&(o=[...o,[...Ct(o[0],[1,1]),...o[0].slice(2)]]);let l=[{point:[o[0][0],o[0][1]],pressure:o[0][2]>=0?o[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],c=!1,g=0,w=l[0],y=o.length-1;for(let x=1;x<o.length;x++){let L=n&&x===y?o[x].slice(0,2):Ye(w.point,o[x],s);if(jr(w.point,L))continue;let k=Jr(L,w.point);if(g+=k,x<y&&!c){if(g<r)continue;c=!0}w={point:L,pressure:o[x][2]>=0?o[x][2]:.5,vector:Ci(yt(w.point,L)),distance:k,runningLength:g},l.push(w)}return l[0].vector=((e=l[1])==null?void 0:e.vector)||[0,0],l}function rn(a,t={}){return tn(en(a,t),t)}class Ei extends ce{constructor(e){const i=Tt(Hr);super(e,"brush","Brush",i,"b");Mt(this,Rt,new pt);m(this,"isPaint",!1);Mt(this,ee,[]);m(this,"overlay");this.drawer=e,this.overlay=new Yr(e)}onActive(){this.initEvents(),this.updateCursor(),this.overlay.show()}onDesactive(){this.removeEvents(),this.overlay.hide()}initEvents(){this.drawer.stage.on("mousedown touchstart",e=>{if(e.evt.button===2)return;e.evt.preventDefault(),this.isPaint=!0,this.drawer.UIPointerEvents("none");const i=this.drawer._getRelativePointerPos();Et(this,Rt,new pt({stroke:this.drawer.options.strokeColor,fill:this.drawer.options.strokeColor,opacity:this.drawer.options.opacity,tension:.3,strokeWidth:this.drawer.options.strokeWidth,hitStrokeWidth:20,globalCompositeOperation:"source-over",shadowForStrokeEnabled:!1,lineCap:"round",lineJoin:"round",points:[i.x,i.y,i.x,i.y],name:gt.line})),st(this,Rt).on("dragend",()=>{this.drawer.stage.fire("change")}),this.drawer.drawLayer.add(st(this,Rt))}),this.drawer.stage.on("mousemove touchmove",e=>{e.evt.preventDefault(),this.isPaint&&this._updateLine()}),this.drawer.stage.on("mouseup touchend",e=>{if(e.evt.button===2)return;this._updateLine(!0),this.isPaint=!1,this.drawer.UIPointerEvents("all"),Et(this,ee,[]),this.drawer.stage.fire("change");const i=this.drawer.getWidget("selection");i==null||i.transformer.nodes([]),e.evt.preventDefault()})}_updateLine(e){var s;const i=this.drawer._getRelativePointerPos();st(this,ee).push(i);const r=rn(st(this,ee),{size:this.drawer.options.strokeWidth,smoothing:1,thinning:.6,easing:o=>Math.sin(o*Math.PI/2),last:e});st(this,Rt).closed()||st(this,Rt).closed(!0);const n=r.flat();(s=st(this,Rt))==null||s.points(n)}removeEvents(){this.drawer.stage.off("mousedown touchstart"),this.drawer.stage.off("mousemove touchmove"),this.drawer.stage.off("mouseup touchend")}getSvgPathFromStroke(e){const i=/(\s?[A-Z]?,?-?[0-9]*\.[0-9]{0,2})(([0-9]|e|-)*)/g;if(!e.length)return"";const r=e.length-1;return e.reduce((n,s,o,l)=>(o===r?n.push(s,this.med(s,l[0]),"L",l[0],"Z"):n.push(s,this.med(s,l[o+1])),n),["M",e[0],"Q"]).join(" ").replace(i,"$1")}med(e,i){return[(e[0]+i[0])/2,(e[1]+i[1])/2]}updateCursor(){this.drawer.$stageContainer.style.cursor=`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: black;'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='1' dy='1' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(0 16 16)' filter='url(%23shadow)'><path d='m25 16h-6.01v-6h-2.98v6h-6.01v3h6.01v6h2.98v-6h6.01z' fill='white'/><path d='m23.9902 17.0103h-6v-6.01h-.98v6.01h-6v.98h6v6.01h.98v-6.01h6z' fill='%23231f1f'/></g></svg>") 16 16, crosshair`}}Rt=new WeakMap,ee=new WeakMap;const nn=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE xml>
<svg aria-hidden="true" focusable="false" role="img" viewBox="0 0 24 24" class="" fill="none" stroke-width="2" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><g stroke-width="1.5"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M19 20h-10.5l-4.21 -4.3a1 1 0 0 1 0 -1.41l10 -10a1 1 0 0 1 1.41 0l5 5a1 1 0 0 1 0 1.41l-9.2 9.3"></path><path d="M18 13.3l-6.3 -6.3"></path></g></svg>
`;class an extends ce{constructor(e){const i=Tt(nn);super(e,"eraser","Eraser",i,"e");m(this,"isErasing",!1);Mt(this,Wt,[]);this.drawer=e}initEvents(){this.drawer.stage.on("mousedown touchstart",e=>{e.target===this.drawer.stage&&(e.evt.preventDefault(),this.isErasing=!0,this.drawer.UIPointerEvents("none"))}),this.drawer.stage.on("mousemove touchmove",e=>{if(!this.isErasing)return;e.evt.preventDefault();const i=this.drawer.getDrawingShapes(),r=this.drawer._getPointerPos();i.filter(s=>s==this.drawer.stage.getIntersection(r)).forEach(s=>{s.opacity()!==.5&&(st(this,Wt).push(s),s.opacity(.5))})}),this.drawer.stage.on("mouseup touchend",e=>{this.isErasing=!1,this.drawer.UIPointerEvents("all");const i=this.drawer.getWidget("selection");i==null||i.transformer.nodes([]),e.evt.preventDefault(),st(this,Wt).length&&(st(this,Wt).forEach(r=>r.destroy()),Et(this,Wt,[]),this.drawer.stage.fire("change"))}),this.drawer.stage.on("click tap",e=>{e.target!==this.drawer.stage&&!e.target.hasName("background")&&!e.target.hasName("selection")&&e.target.destroy()})}removeEvents(){this.drawer.stage.off("mousedown touchstart"),this.drawer.stage.off("mousemove touchmove"),this.drawer.stage.off("mouseup touchend"),this.drawer.stage.off("click tap")}updateCursor(){this.drawer.$stageContainer.style.cursor=`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: black;'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='1' dy='1' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(0 16 16)' filter='url(%23shadow)'><path d='m25 16h-6.01v-6h-2.98v6h-6.01v3h6.01v6h2.98v-6h6.01z' fill='white'/><path d='m23.9902 17.0103h-6v-6.01h-.98v6.01h-6v.98h6v6.01h.98v-6.01h6z' fill='%23231f1f'/></g></svg>") 16 16, crosshair`}onActive(){this.initEvents(),this.updateCursor()}onDesactive(){this.removeEvents()}}Wt=new WeakMap;const sn=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE xml>
<svg width="24" height="24" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
    <path fill="currentColor"
        d="M8 26H4a2.002 2.002 0 0 1-2-2v-4h2v4h4zM2 12h2v4H2zm24-4h-2V4h-4V2h4a2.002 2.002 0 0 1 2 2zM12 2h4v2h-4zM4 8H2V4a2.002 2.002 0 0 1 2-2h4v2H4zm23 24a.997.997 0 0 1-.707-.293l-6.138-6.138l-3.323 4.986a1 1 0 0 1-1.79-.268l-6-20a1 1 0 0 1 1.245-1.245l20 6a1 1 0 0 1 .268 1.79l-4.986 3.323l6.138 6.138a1 1 0 0 1 0 1.414l-4 4A.997.997 0 0 1 27 32m0-2.414L29.586 27l-7.155-7.155l5.246-3.498l-16.185-4.855l4.855 16.185l3.498-5.246z" />
</svg>
`;var Xe={},Te={};Object.defineProperty(Te,"__esModule",{value:!0});var Le=Te.Rect=void 0;const on=bt,hn=mt,ln=ht,dn=ct,cn=z;class Pe extends hn.Shape{_sceneFunc(t){var e=this.cornerRadius(),i=this.width(),r=this.height();t.beginPath(),e?dn.Util.drawRoundedRectPath(t,i,r,e):t.rect(0,0,i,r),t.closePath(),t.fillStrokeShape(this)}}Le=Te.Rect=Pe,Pe.prototype.className="Rect",(0,ln._registerNode)(Pe),on.Factory.addGetterSetter(Pe,"cornerRadius",0,(0,cn.getNumberOrArrayOfNumbersValidator)(4));var $e={};Object.defineProperty($e,"__esModule",{value:!0}),$e.Group=void 0;const un=ct,gn=Kt,fn=ht;class Ke extends gn.Container{_validateAdd(t){var e=t.getType();e!=="Group"&&e!=="Shape"&&un.Util.throw("You may only add groups and shapes to groups.")}}$e.Group=Ke,Ke.prototype.nodeType="Group",(0,fn._registerNode)(Ke),Object.defineProperty(Xe,"__esModule",{value:!0});var ki=Xe.Transformer=void 0;const K=ct,Y=bt,Ti=It,pn=mt,vn=Te,Li=$e,xt=ht,Bt=z,mn=ht;var Pi="tr-konva",yn=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(a=>a+`.${Pi}`).join(" "),$i="nodesRect",wn=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],_n={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135};const bn="ontouchstart"in xt.Konva._global;function Cn(a,t,e){if(a==="rotater")return e;t+=K.Util.degToRad(_n[a]||0);var i=(K.Util.radToDeg(t)%360+360)%360;return K.Util._inRange(i,337.5,360)||K.Util._inRange(i,0,22.5)?"ns-resize":K.Util._inRange(i,22.5,67.5)?"nesw-resize":K.Util._inRange(i,67.5,112.5)?"ew-resize":K.Util._inRange(i,112.5,157.5)?"nwse-resize":K.Util._inRange(i,157.5,202.5)?"ns-resize":K.Util._inRange(i,202.5,247.5)?"nesw-resize":K.Util._inRange(i,247.5,292.5)?"ew-resize":K.Util._inRange(i,292.5,337.5)?"nwse-resize":(K.Util.error("Transformer has unknown angle for cursor detection: "+i),"pointer")}var Ae=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"],Ai=1e8;function Sn(a){return{x:a.x+a.width/2*Math.cos(a.rotation)+a.height/2*Math.sin(-a.rotation),y:a.y+a.height/2*Math.cos(a.rotation)+a.width/2*Math.sin(a.rotation)}}function Ri(a,t,e){const i=e.x+(a.x-e.x)*Math.cos(t)-(a.y-e.y)*Math.sin(t),r=e.y+(a.x-e.x)*Math.sin(t)+(a.y-e.y)*Math.cos(t);return{...a,rotation:a.rotation+t,x:i,y:r}}function xn(a,t){const e=Sn(a);return Ri(a,t,e)}function En(a,t,e){let i=t;for(let r=0;r<a.length;r++){const n=xt.Konva.getAngle(a[r]),s=Math.abs(n-t)%(Math.PI*2);Math.min(s,Math.PI*2-s)<e&&(i=n)}return i}class H extends Li.Group{constructor(t){super(t),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(yn,this.update),this.getNode()&&this.update()}attachTo(t){return this.setNode(t),this}setNode(t){return K.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([t])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return Pi+this._id}setNodes(t=[]){this._nodes&&this._nodes.length&&this.detach();const e=t.filter(r=>r.isAncestorOf(this)?(K.Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);this._nodes=t=e,t.length===1&&this.useSingleNodeRotation()?this.rotation(t[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(r=>{const n=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()},s=r._attrsAffectingSize.map(o=>o+"Change."+this._getEventNamespace()).join(" ");r.on(s,n),r.on(wn.map(o=>o+`.${this._getEventNamespace()}`).join(" "),n),r.on(`absoluteTransformChange.${this._getEventNamespace()}`,n),this._proxyDrag(r)}),this._resetTransformCache();var i=!!this.findOne(".top-left");return i&&this.update(),this}_proxyDrag(t){let e;t.on(`dragstart.${this._getEventNamespace()}`,i=>{e=t.getAbsolutePosition(),!this.isDragging()&&t!==this.findOne(".back")&&this.startDrag(i,!1)}),t.on(`dragmove.${this._getEventNamespace()}`,i=>{if(!e)return;const r=t.getAbsolutePosition(),n=r.x-e.x,s=r.y-e.y;this.nodes().forEach(o=>{if(o===t||o.isDragging())return;const l=o.getAbsolutePosition();o.setAbsolutePosition({x:l.x+n,y:l.y+s}),o.startDrag(i)}),e=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(t=>{t.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache($i),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache($i,this.__getNodeRect)}__getNodeShape(t,e=this.rotation(),i){var r=t.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),n=t.getAbsoluteScale(i),s=t.getAbsolutePosition(i),o=r.x*n.x-t.offsetX()*n.x,l=r.y*n.y-t.offsetY()*n.y;const c=(xt.Konva.getAngle(t.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),g={x:s.x+o*Math.cos(c)+l*Math.sin(-c),y:s.y+l*Math.cos(c)+o*Math.sin(c),width:r.width*n.x,height:r.height*n.y,rotation:c};return Ri(g,-xt.Konva.getAngle(e),{x:0,y:0})}__getNodeRect(){var t=this.getNode();if(!t)return{x:-Ai,y:-Ai,width:0,height:0,rotation:0};const e=[];this.nodes().map(c=>{const g=c.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()});var w=[{x:g.x,y:g.y},{x:g.x+g.width,y:g.y},{x:g.x+g.width,y:g.y+g.height},{x:g.x,y:g.y+g.height}],y=c.getAbsoluteTransform();w.forEach(function(x){var L=y.point(x);e.push(L)})});const i=new K.Transform;i.rotate(-xt.Konva.getAngle(this.rotation()));var r=1/0,n=1/0,s=-1/0,o=-1/0;e.forEach(function(c){var g=i.point(c);r===void 0&&(r=s=g.x,n=o=g.y),r=Math.min(r,g.x),n=Math.min(n,g.y),s=Math.max(s,g.x),o=Math.max(o,g.y)}),i.invert();const l=i.point({x:r,y:n});return{x:l.x,y:l.y,width:s-r,height:o-n,rotation:xt.Konva.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),Ae.forEach(t=>{this._createAnchor(t)}),this._createAnchor("rotater")}_createAnchor(t){var e=new vn.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:t+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:bn?10:"auto"}),i=this;e.on("mousedown touchstart",function(r){i._handleMouseDown(r)}),e.on("dragstart",r=>{e.stopDrag(),r.cancelBubble=!0}),e.on("dragend",r=>{r.cancelBubble=!0}),e.on("mouseenter",()=>{var r=xt.Konva.getAngle(this.rotation()),n=this.rotateAnchorCursor(),s=Cn(t,r,n);e.getStage().content&&(e.getStage().content.style.cursor=s),this._cursorChange=!0}),e.on("mouseout",()=>{e.getStage().content&&(e.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(e)}_createBack(){var t=new pn.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(e,i){var r=i.getParent(),n=r.padding();e.beginPath(),e.rect(-n,-n,i.width()+n*2,i.height()+n*2),e.moveTo(i.width()/2,-n),r.rotateEnabled()&&r.rotateLineVisible()&&e.lineTo(i.width()/2,-r.rotateAnchorOffset()*K.Util._sign(i.height())-n),e.fillStrokeShape(i)},hitFunc:(e,i)=>{if(this.shouldOverdrawWholeArea()){var r=this.padding();e.beginPath(),e.rect(-r,-r,i.width()+r*2,i.height()+r*2),e.fillStrokeShape(i)}}});this.add(t),this._proxyDrag(t),t.on("dragstart",e=>{e.cancelBubble=!0}),t.on("dragmove",e=>{e.cancelBubble=!0}),t.on("dragend",e=>{e.cancelBubble=!0}),this.on("dragmove",e=>{this.update()})}_handleMouseDown(t){this._movingAnchorName=t.target.name().split(" ")[0];var e=this._getNodeRect(),i=e.width,r=e.height,n=Math.sqrt(Math.pow(i,2)+Math.pow(r,2));this.sin=Math.abs(r/n),this.cos=Math.abs(i/n),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;var s=t.target.getAbsolutePosition(),o=t.target.getStage().getPointerPosition();this._anchorDragOffset={x:o.x-s.x,y:o.y-s.y},this._fire("transformstart",{evt:t.evt,target:this.getNode()}),this._nodes.forEach(l=>{l._fire("transformstart",{evt:t.evt,target:l})})}_handleMouseMove(t){var e,i,r,n=this.findOne("."+this._movingAnchorName),s=n.getStage();s.setPointersPositions(t);const o=s.getPointerPosition();let l={x:o.x-this._anchorDragOffset.x,y:o.y-this._anchorDragOffset.y};const c=n.getAbsolutePosition();this.anchorDragBoundFunc()&&(l=this.anchorDragBoundFunc()(c,l,t)),n.setAbsolutePosition(l);const g=n.getAbsolutePosition();if(!(c.x===g.x&&c.y===g.y)){if(this._movingAnchorName==="rotater"){var w=this._getNodeRect();e=n.x()-w.width/2,i=-n.y()+w.height/2;let S=Math.atan2(-i,e)+Math.PI/2;w.height<0&&(S-=Math.PI);var y=xt.Konva.getAngle(this.rotation());const O=y+S,D=xt.Konva.getAngle(this.rotationSnapTolerance()),A=En(this.rotationSnaps(),O,D)-w.rotation,N=xn(w,A);this._fitNodesInto(N,t);return}var x=this.shiftBehavior(),L;x==="inverted"?L=this.keepRatio()&&!t.shiftKey:x==="none"?L=this.keepRatio():L=this.keepRatio()||t.shiftKey;var h=this.centeredScaling()||t.altKey;if(this._movingAnchorName==="top-left"){if(L){var k=h?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};r=Math.sqrt(Math.pow(k.x-n.x(),2)+Math.pow(k.y-n.y(),2));var M=this.findOne(".top-left").x()>k.x?-1:1,$=this.findOne(".top-left").y()>k.y?-1:1;e=r*this.cos*M,i=r*this.sin*$,this.findOne(".top-left").x(k.x-e),this.findOne(".top-left").y(k.y-i)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(n.y());else if(this._movingAnchorName==="top-right"){if(L){var k=h?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};r=Math.sqrt(Math.pow(n.x()-k.x,2)+Math.pow(k.y-n.y(),2));var M=this.findOne(".top-right").x()<k.x?-1:1,$=this.findOne(".top-right").y()>k.y?-1:1;e=r*this.cos*M,i=r*this.sin*$,this.findOne(".top-right").x(k.x+e),this.findOne(".top-right").y(k.y-i)}var U=n.position();this.findOne(".top-left").y(U.y),this.findOne(".bottom-right").x(U.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(n.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(n.x());else if(this._movingAnchorName==="bottom-left"){if(L){var k=h?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};r=Math.sqrt(Math.pow(k.x-n.x(),2)+Math.pow(n.y()-k.y,2));var M=k.x<n.x()?-1:1,$=n.y()<k.y?-1:1;e=r*this.cos*M,i=r*this.sin*$,n.x(k.x-e),n.y(k.y+i)}U=n.position(),this.findOne(".top-left").x(U.x),this.findOne(".bottom-right").y(U.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(n.y());else if(this._movingAnchorName==="bottom-right"){if(L){var k=h?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};r=Math.sqrt(Math.pow(n.x()-k.x,2)+Math.pow(n.y()-k.y,2));var M=this.findOne(".bottom-right").x()<k.x?-1:1,$=this.findOne(".bottom-right").y()<k.y?-1:1;e=r*this.cos*M,i=r*this.sin*$,this.findOne(".bottom-right").x(k.x+e),this.findOne(".bottom-right").y(k.y+i)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));var h=this.centeredScaling()||t.altKey;if(h){var d=this.findOne(".top-left"),p=this.findOne(".bottom-right"),C=d.x(),T=d.y(),f=this.getWidth()-p.x(),E=this.getHeight()-p.y();p.move({x:-C,y:-T}),d.move({x:f,y:E})}var v=this.findOne(".top-left").getAbsolutePosition();e=v.x,i=v.y;var _=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),P=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:e,y:i,width:_,height:P,rotation:xt.Konva.getAngle(this.rotation())},t)}}_handleMouseUp(t){this._removeEvents(t)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(t){if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));var e=this.getNode();this._fire("transformend",{evt:t,target:e}),e&&this._nodes.forEach(i=>{i._fire("transformend",{evt:t,target:i})}),this._movingAnchorName=null}}_fitNodesInto(t,e){var i=this._getNodeRect();const r=1;if(K.Util._inRange(t.width,-this.padding()*2-r,r)){this.update();return}if(K.Util._inRange(t.height,-this.padding()*2-r,r)){this.update();return}var n=new K.Transform;if(n.rotate(xt.Konva.getAngle(this.rotation())),this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("left")>=0){const y=n.point({x:-this.padding()*2,y:0});t.x+=y.x,t.y+=y.y,t.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=y.x,this._anchorDragOffset.y-=y.y}else if(this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("right")>=0){const y=n.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=y.x,this._anchorDragOffset.y-=y.y,t.width+=this.padding()*2}if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("top")>=0){const y=n.point({x:0,y:-this.padding()*2});t.x+=y.x,t.y+=y.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=y.x,this._anchorDragOffset.y-=y.y,t.height+=this.padding()*2}else if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const y=n.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=y.x,this._anchorDragOffset.y-=y.y,t.height+=this.padding()*2}if(this.boundBoxFunc()){const y=this.boundBoxFunc()(i,t);y?t=y:K.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const s=1e7,o=new K.Transform;o.translate(i.x,i.y),o.rotate(i.rotation),o.scale(i.width/s,i.height/s);const l=new K.Transform,c=t.width/s,g=t.height/s;this.flipEnabled()===!1?(l.translate(t.x,t.y),l.rotate(t.rotation),l.translate(t.width<0?t.width:0,t.height<0?t.height:0),l.scale(Math.abs(c),Math.abs(g))):(l.translate(t.x,t.y),l.rotate(t.rotation),l.scale(c,g));const w=l.multiply(o.invert());this._nodes.forEach(y=>{var x;const L=y.getParent().getAbsoluteTransform(),k=y.getTransform().copy();k.translate(y.offsetX(),y.offsetY());const M=new K.Transform;M.multiply(L.copy().invert()).multiply(w).multiply(L).multiply(k);const $=M.decompose();y.setAttrs($),this._fire("transform",{evt:e,target:y}),y._fire("transform",{evt:e,target:y}),(x=y.getLayer())===null||x===void 0||x.batchDraw()}),this.rotation(K.Util._getRotation(t.rotation)),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(t,e){this.findOne(t).setAttrs(e)}update(){var t,e=this._getNodeRect();this.rotation(K.Util._getRotation(e.rotation));var i=e.width,r=e.height,n=this.enabledAnchors(),s=this.resizeEnabled(),o=this.padding(),l=this.anchorSize();const c=this.find("._anchor");c.forEach(w=>{w.setAttrs({width:l,height:l,offsetX:l/2,offsetY:l/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:l/2+o,offsetY:l/2+o,visible:s&&n.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:i/2,y:0,offsetY:l/2+o,visible:s&&n.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:i,y:0,offsetX:l/2-o,offsetY:l/2+o,visible:s&&n.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:r/2,offsetX:l/2+o,visible:s&&n.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:i,y:r/2,offsetX:l/2-o,visible:s&&n.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:r,offsetX:l/2+o,offsetY:l/2-o,visible:s&&n.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:i/2,y:r,offsetY:l/2-o,visible:s&&n.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:i,y:r,offsetX:l/2-o,offsetY:l/2-o,visible:s&&n.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:i/2,y:-this.rotateAnchorOffset()*K.Util._sign(r)-o,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:i,height:r,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});const g=this.anchorStyleFunc();g&&c.forEach(w=>{g(w)}),(t=this.getLayer())===null||t===void 0||t.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();var t=this.findOne("."+this._movingAnchorName);t&&t.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),Li.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return Ti.Node.prototype.toObject.call(this)}clone(t){var e=Ti.Node.prototype.clone.call(this,t);return e}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}}ki=Xe.Transformer=H;function kn(a){return a instanceof Array||K.Util.warn("enabledAnchors value should be an array"),a instanceof Array&&a.forEach(function(t){Ae.indexOf(t)===-1&&K.Util.warn("Unknown anchor name: "+t+". Available names are: "+Ae.join(", "))}),a||[]}H.prototype.className="Transformer",(0,mn._registerNode)(H),Y.Factory.addGetterSetter(H,"enabledAnchors",Ae,kn),Y.Factory.addGetterSetter(H,"flipEnabled",!0,(0,Bt.getBooleanValidator)()),Y.Factory.addGetterSetter(H,"resizeEnabled",!0),Y.Factory.addGetterSetter(H,"anchorSize",10,(0,Bt.getNumberValidator)()),Y.Factory.addGetterSetter(H,"rotateEnabled",!0),Y.Factory.addGetterSetter(H,"rotateLineVisible",!0),Y.Factory.addGetterSetter(H,"rotationSnaps",[]),Y.Factory.addGetterSetter(H,"rotateAnchorOffset",50,(0,Bt.getNumberValidator)()),Y.Factory.addGetterSetter(H,"rotateAnchorCursor","crosshair"),Y.Factory.addGetterSetter(H,"rotationSnapTolerance",5,(0,Bt.getNumberValidator)()),Y.Factory.addGetterSetter(H,"borderEnabled",!0),Y.Factory.addGetterSetter(H,"anchorStroke","rgb(0, 161, 255)"),Y.Factory.addGetterSetter(H,"anchorStrokeWidth",1,(0,Bt.getNumberValidator)()),Y.Factory.addGetterSetter(H,"anchorFill","white"),Y.Factory.addGetterSetter(H,"anchorCornerRadius",0,(0,Bt.getNumberValidator)()),Y.Factory.addGetterSetter(H,"borderStroke","rgb(0, 161, 255)"),Y.Factory.addGetterSetter(H,"borderStrokeWidth",1,(0,Bt.getNumberValidator)()),Y.Factory.addGetterSetter(H,"borderDash"),Y.Factory.addGetterSetter(H,"keepRatio",!0),Y.Factory.addGetterSetter(H,"shiftBehavior","default"),Y.Factory.addGetterSetter(H,"centeredScaling",!1),Y.Factory.addGetterSetter(H,"ignoreStroke",!1),Y.Factory.addGetterSetter(H,"padding",0,(0,Bt.getNumberValidator)()),Y.Factory.addGetterSetter(H,"node"),Y.Factory.addGetterSetter(H,"nodes"),Y.Factory.addGetterSetter(H,"boundBoxFunc"),Y.Factory.addGetterSetter(H,"anchorDragBoundFunc"),Y.Factory.addGetterSetter(H,"anchorStyleFunc"),Y.Factory.addGetterSetter(H,"shouldOverdrawWholeArea",!1),Y.Factory.addGetterSetter(H,"useSingleNodeRotation",!0),Y.Factory.backCompat(H,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"});class Tn extends yi{constructor(t){super(t)}}var pe={};Object.defineProperty(pe,"__esModule",{value:!0});var Qt=pe.Text=pe.stringToArray=void 0;const je=ct,ut=bt,Ln=mt,Nt=z,Pn=ht;function Di(a){return Array.from(a)}pe.stringToArray=Di;var te="auto",$n="center",Mi="inherit",ve="justify",An="Change.konva",Rn="2d",Oi="-",Gi="left",Dn="text",Mn="Text",On="top",Gn="bottom",Fi="middle",Bi="normal",Fn="px ",Re=" ",Bn="right",Ni="rtl",Nn="word",Un="char",Ui="none",qe="",Ii=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],In=Ii.length;function Hn(a){return a.split(",").map(t=>{t=t.trim();const e=t.indexOf(" ")>=0,i=t.indexOf('"')>=0||t.indexOf("'")>=0;return e&&!i&&(t=`"${t}"`),t}).join(", ")}var De;function Ze(){return De||(De=je.Util.createCanvasElement().getContext(Rn),De)}function zn(a){a.fillText(this._partialText,this._partialTextX,this._partialTextY)}function Vn(a){a.setAttr("miterLimit",2),a.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function Wn(a){return a=a||{},!a.fillLinearGradientColorStops&&!a.fillRadialGradientColorStops&&!a.fillPatternImage&&(a.fill=a.fill||"black"),a}class et extends Ln.Shape{constructor(t){super(Wn(t)),this._partialTextX=0,this._partialTextY=0;for(var e=0;e<In;e++)this.on(Ii[e]+An,this._setTextData);this._setTextData()}_sceneFunc(t){var e=this.textArr,i=e.length;if(this.text()){var r=this.padding(),n=this.fontSize(),s=this.lineHeight()*n,o=this.verticalAlign(),l=this.direction(),c=0,g=this.align(),w=this.getWidth(),y=this.letterSpacing(),x=this.fill(),L=this.textDecoration(),k=L.indexOf("underline")!==-1,M=L.indexOf("line-through")!==-1,$;l=l===Mi?t.direction:l;var U=0,U=s/2,h=0,d=0;for(l===Ni&&t.setAttr("direction",l),t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",Fi),t.setAttr("textAlign",Gi),o===Fi?c=(this.getHeight()-i*s-r*2)/2:o===Gn&&(c=this.getHeight()-i*s-r*2),t.translate(r,c+r),$=0;$<i;$++){var h=0,d=0,p=e[$],C=p.text,T=p.width,f=p.lastInParagraph,E,v,_;if(t.save(),g===Bn?h+=w-T-r*2:g===$n&&(h+=(w-T-r*2)/2),k){t.save(),t.beginPath(),t.moveTo(h,U+d+Math.round(n/2)),E=C.split(" ").length-1,v=E===0,_=g===ve&&!f?w-r*2:T,t.lineTo(h+Math.round(_),U+d+Math.round(n/2)),t.lineWidth=n/15;const A=this._getLinearGradient();t.strokeStyle=A||x,t.stroke(),t.restore()}if(M){t.save(),t.beginPath(),t.moveTo(h,U+d),E=C.split(" ").length-1,v=E===0,_=g===ve&&f&&!v?w-r*2:T,t.lineTo(h+Math.round(_),U+d),t.lineWidth=n/15;const A=this._getLinearGradient();t.strokeStyle=A||x,t.stroke(),t.restore()}if(l!==Ni&&(y!==0||g===ve)){E=C.split(" ").length-1;for(var P=Di(C),S=0;S<P.length;S++){var O=P[S];O===" "&&!f&&g===ve&&(h+=(w-r*2-T)/E),this._partialTextX=h,this._partialTextY=U+d,this._partialText=O,t.fillStrokeShape(this),h+=this.measureSize(O).width+y}}else y!==0&&t.setAttr("letterSpacing",`${y}px`),this._partialTextX=h,this._partialTextY=U+d,this._partialText=C,t.fillStrokeShape(this);t.restore(),i>1&&(U+=s)}}}_hitFunc(t){var e=this.getWidth(),i=this.getHeight();t.beginPath(),t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this)}setText(t){var e=je.Util._isString(t)?t:t==null?"":t+"";return this._setAttr(Dn,e),this}getWidth(){var t=this.attrs.width===te||this.attrs.width===void 0;return t?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){var t=this.attrs.height===te||this.attrs.height===void 0;return t?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return je.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(t){var e=Ze(),i=this.fontSize(),r;return e.save(),e.font=this._getContextFont(),r=e.measureText(t),e.restore(),{width:r.width,height:i}}_getContextFont(){return this.fontStyle()+Re+this.fontVariant()+Re+(this.fontSize()+Fn)+Hn(this.fontFamily())}_addTextLine(t){this.align()===ve&&(t=t.trim());var i=this._getTextWidth(t);return this.textArr.push({text:t,width:i,lastInParagraph:!1})}_getTextWidth(t){var e=this.letterSpacing(),i=t.length;return Ze().measureText(t).width+(i?e*(i-1):0)}_setTextData(){var t=this.text().split(`
`),e=+this.fontSize(),i=0,r=this.lineHeight()*e,n=this.attrs.width,s=this.attrs.height,o=n!==te&&n!==void 0,l=s!==te&&s!==void 0,c=this.padding(),g=n-c*2,w=s-c*2,y=0,x=this.wrap(),L=x!==Ui,k=x!==Un&&L,M=this.ellipsis();this.textArr=[],Ze().font=this._getContextFont();for(var $=M?this._getTextWidth(qe):0,U=0,h=t.length;U<h;++U){var d=t[U],p=this._getTextWidth(d);if(o&&p>g)for(;d.length>0;){for(var C=0,T=d.length,f="",E=0;C<T;){var v=C+T>>>1,_=d.slice(0,v+1),P=this._getTextWidth(_)+$;P<=g?(C=v+1,f=_,E=P):T=v}if(f){if(k){var S,O=d[f.length],D=O===Re||O===Oi;D&&E<=g?S=f.length:S=Math.max(f.lastIndexOf(Re),f.lastIndexOf(Oi))+1,S>0&&(C=S,f=f.slice(0,C),E=this._getTextWidth(f))}f=f.trimRight(),this._addTextLine(f),i=Math.max(i,E),y+=r;var it=this._shouldHandleEllipsis(y);if(it){this._tryToAddEllipsisToLastLine();break}if(d=d.slice(C),d=d.trimLeft(),d.length>0&&(p=this._getTextWidth(d),p<=g)){this._addTextLine(d),y+=r,i=Math.max(i,p);break}}else break}else this._addTextLine(d),y+=r,i=Math.max(i,p),this._shouldHandleEllipsis(y)&&U<h-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),l&&y+r>w)break}this.textHeight=e,this.textWidth=i}_shouldHandleEllipsis(t){var e=+this.fontSize(),i=this.lineHeight()*e,r=this.attrs.height,n=r!==te&&r!==void 0,s=this.padding(),o=r-s*2,l=this.wrap(),c=l!==Ui;return!c||n&&t+i>o}_tryToAddEllipsisToLastLine(){var t=this.attrs.width,e=t!==te&&t!==void 0,i=this.padding(),r=t-i*2,n=this.ellipsis(),s=this.textArr[this.textArr.length-1];if(!(!s||!n)){if(e){var o=this._getTextWidth(s.text+qe)<r;o||(s.text=s.text.slice(0,s.text.length-3))}this.textArr.splice(this.textArr.length-1,1),this._addTextLine(s.text+qe)}}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const t=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,e=this.hasShadow();return t&&e?!0:super._useBufferCanvas()}}Qt=pe.Text=et,et.prototype._fillFunc=zn,et.prototype._strokeFunc=Vn,et.prototype.className=Mn,et.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],(0,Pn._registerNode)(et),ut.Factory.overWriteSetter(et,"width",(0,Nt.getNumberOrAutoValidator)()),ut.Factory.overWriteSetter(et,"height",(0,Nt.getNumberOrAutoValidator)()),ut.Factory.addGetterSetter(et,"direction",Mi),ut.Factory.addGetterSetter(et,"fontFamily","Arial"),ut.Factory.addGetterSetter(et,"fontSize",12,(0,Nt.getNumberValidator)()),ut.Factory.addGetterSetter(et,"fontStyle",Bi),ut.Factory.addGetterSetter(et,"fontVariant",Bi),ut.Factory.addGetterSetter(et,"padding",0,(0,Nt.getNumberValidator)()),ut.Factory.addGetterSetter(et,"align",Gi),ut.Factory.addGetterSetter(et,"verticalAlign",On),ut.Factory.addGetterSetter(et,"lineHeight",1,(0,Nt.getNumberValidator)()),ut.Factory.addGetterSetter(et,"wrap",Nn),ut.Factory.addGetterSetter(et,"ellipsis",!1,(0,Nt.getBooleanValidator)()),ut.Factory.addGetterSetter(et,"letterSpacing",0,(0,Nt.getNumberValidator)()),ut.Factory.addGetterSetter(et,"text","",(0,Nt.getStringValidator)()),ut.Factory.addGetterSetter(et,"textDecoration","");class Yn extends ce{constructor(e){const i=Tt(sn);super(e,"selection","Select",i,"s");Mt(this,ie,0);Mt(this,re,0);Mt(this,Yt,0);Mt(this,Xt,0);m(this,"defaultAnchors",["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"]);m(this,"color","rgba(152, 158, 255, 1)");m(this,"selectionRectangle",new Le);m(this,"transformer",new ki({borderStroke:this.color,anchorStroke:this.color,enabledAnchors:this.defaultAnchors,keepRatio:!0,anchorStyleFunc(e){(e.hasName("top-center")||e.hasName("bottom-center"))&&(e.height(6),e.offsetY(3),e.width(30),e.offsetX(15)),(e.hasName("middle-left")||e.hasName("middle-right"))&&(e.height(30),e.offsetY(15),e.width(6),e.offsetX(3))},anchorCornerRadius:3}));m(this,"isSelecting",!1);m(this,"snapping",!1);m(this,"overlay");this.drawer=e,this.transformer.on("transformstart dragstart",()=>{this.drawer.activeTool!=="selection"&&(this.transformer.stopTransform(),this.transformer.nodes([]),this.drawer.debug&&this.drawer.toast('You need to use "selection" tool.',"info"))}),this.drawer.selectionLayer.add(this.transformer),this.overlay=new Tn(e)}initEvents(){this.drawer.stage.on("mousedown touchstart",e=>{if(e.target!==this.drawer.stage||e.evt.button===2)return;e.evt.preventDefault();const i=this.drawer._getRelativePointerPos();Et(this,ie,i.x),Et(this,re,i.y),Et(this,Yt,i.x),Et(this,Xt,i.y),this.selectionRectangle.width(0),this.selectionRectangle.height(0),this.isSelecting=!0,this.drawer.UIPointerEvents("none")}),this.drawer.stage.on("mousemove touchmove",e=>{if(!this.isSelecting){if(e.target.hasName("_anchor")||this.transformer.isTransforming())return;e.target!==this.drawer.stage?this.drawer.$stageContainer.style.cursor="move":this.drawer.$stageContainer.style.cursor="default";return}e.evt.preventDefault();const i=this.drawer._getRelativePointerPos();Et(this,Yt,i.x),Et(this,Xt,i.y),this.selectionRectangle.setAttrs({visible:!0,x:Math.min(st(this,ie),st(this,Yt)),y:Math.min(st(this,re),st(this,Xt)),width:Math.abs(st(this,Yt)-st(this,ie)),height:Math.abs(st(this,Xt)-st(this,re))})}),this.drawer.stage.on("mouseup touchend",e=>{if(e.evt.button===2)return;this.isSelecting=!1,this.drawer.UIPointerEvents("all"),e.evt.preventDefault(),this.selectionRectangle.visible(!1);const i=this.drawer.getDrawingShapes(),r=this.selectionRectangle.getClientRect(),{x:n,y:s}=this.drawer._getPointerPos();let o=i.filter(c=>c.listening()&&ct.Util.haveIntersection(r,c.getClientRect()));r.x<0&&r.y<0&&(o=i.filter(c=>c.listening()&&ct.Util.haveIntersection({x:n,y:s,width:1,height:1},c.getClientRect()))),this._restoreHit(),o.forEach(c=>{c instanceof pt&&(c.hitFunc((g,w)=>{const{x:y,y:x,width:L,height:k}=w.getSelfRect();g.beginPath(),g.rect(y,x,L,k),g.closePath(),g.fillStrokeShape(w)}),c.hitStrokeWidth("auto"))});const l=o.filter(c=>c.hasName(gt.text));l.length>0&&l.length===o.length?(this.transformer.enabledAnchors(["top-left","top-right","bottom-left","bottom-right"]),this.transformer.boundBoxFunc(function(c,g){return g.width=Math.max(30,g.width),g})):this.transformer.enabledAnchors(this.defaultAnchors),o.length?this.overlay.show(o):this.overlay.hide(),this.transformer.nodes(o),this.$container.focus(),this.selectionRectangle.setAttrs({visible:!0,x:0,y:0,width:0,height:0})}),this.transformer.on("transformend dragend",()=>{this.drawer.stage.fire("change")})}_restoreHit(){this.transformer.nodes().forEach(i=>{i.hitFunc(void 0),i.hitStrokeWidth(20)})}onActive(){this.selectionRectangle=new Le({fill:"rgba(152, 158, 255, .2)",stroke:"rgba(152, 158, 255, .8)",strokeWidth:1,visible:!1,name:gt.selection}),this.drawer.selectionLayer.add(this.selectionRectangle),this.initEvents(),this.updateCursor(),this.drawer.getDrawingShapes().forEach(i=>{i.draggable(!0)})}selectAll(){const e=this.drawer.getDrawingShapes();this.transformer.nodes(e),this.overlay.show(e),this.drawer.focus();const i=this.drawer.getWidget("brush");i==null||i.overlay.hide()}onDesactive(){this.selectionRectangle.destroy(),this.removeEvents(),this._restoreHit(),this.drawer.getDrawingShapes().forEach(i=>{i.draggable(!1)}),this.transformer.nodes([]),this.overlay.hide()}_initSnapEvents(){this.snapping=!0,this.drawer.drawLayer.on("dragmove",e=>{this.drawer.selectionLayer.find("."+gt.guideLine).forEach(o=>o.destroy());const i=this._getLineGuideStops(e.target),r=this._getObjectSnappingEdges(e.target),n=this._getGuides(i,r);if(!n.length)return;this._drawGuides(n);const s=e.target.absolutePosition();n.forEach(o=>{switch(o.snap){case"start":case"center":case"end":{switch(o.orientation){case"V":{s.x=o.lineGuide+o.offset;break}case"H":{s.y=o.lineGuide+o.offset;break}}break}}}),e.target.absolutePosition(s)}),this.drawer.drawLayer.on("dragend",()=>{this.drawer.selectionLayer.find("."+gt.guideLine).forEach(e=>e.destroy())})}_removeSnapEvents(){this.snapping=!1,this.drawer.drawLayer.off("dragmove"),this.drawer.drawLayer.off("dragend")}removeEvents(){this.drawer.stage.off("mousedown touchstart"),this.drawer.stage.off("mousemove touchmove"),this.drawer.stage.off("mouseup touchend")}_getLineGuideStops(e){const i=[0,this.drawer.stage.width()/2,this.drawer.stage.width()],r=[0,this.drawer.stage.height()/2,this.drawer.stage.height()];return this.drawer.getDrawingShapes().forEach(n=>{if(n===e)return;const s=n.getClientRect();i.push(s.x,s.x+s.width,s.x+s.width/2),r.push(s.y,s.y+s.height,s.y+s.height/2)}),{vertical:i,horizontal:r}}_getObjectSnappingEdges(e){const i=e.getClientRect(),r=e.absolutePosition();return{vertical:[{guide:Math.round(i.x),offset:Math.round(r.x-i.x),snap:"start"},{guide:Math.round(i.x+i.width/2),offset:Math.round(r.x-i.x-i.width/2),snap:"center"},{guide:Math.round(i.x+i.width),offset:Math.round(r.x-i.x-i.width),snap:"end"}],horizontal:[{guide:Math.round(i.y),offset:Math.round(r.y-i.y),snap:"start"},{guide:Math.round(i.y+i.height/2),offset:Math.round(r.y-i.y-i.height/2),snap:"center"},{guide:Math.round(i.y+i.height),offset:Math.round(r.y-i.y-i.height),snap:"end"}]}}_getGuides(e,i){const r=[],n=[];e.vertical.forEach(g=>{i.vertical.forEach(w=>{const y=Math.abs(g-w.guide);y<5&&r.push({lineGuide:g,diff:y,snap:w.snap,offset:w.offset})})}),e.horizontal.forEach(g=>{i.horizontal.forEach(w=>{const y=Math.abs(g-w.guide);y<5&&n.push({lineGuide:g,diff:y,snap:w.snap,offset:w.offset})})});const o=[],l=r.toSorted((g,w)=>g.diff-w.diff)[0],c=n.toSorted((g,w)=>g.diff-w.diff)[0];return l&&o.push({lineGuide:l.lineGuide,offset:l.offset,orientation:"V",snap:l.snap}),c&&o.push({lineGuide:c.lineGuide,offset:c.offset,orientation:"H",snap:c.snap}),o}_drawGuides(e){e.forEach(i=>{if(i.orientation==="H"){const r=new pt({points:[-6e3,0,6e3,0],stroke:this.color,strokeWidth:1,name:gt.guideLine,dash:[4,6]});this.drawer.selectionLayer.add(r),r.absolutePosition({x:0,y:i.lineGuide})}else if(i.orientation==="V"){const r=new pt({points:[0,-6e3,0,6e3],stroke:this.color,strokeWidth:1,name:gt.guideLine,dash:[4,6]});this.drawer.selectionLayer.add(r),r.absolutePosition({x:i.lineGuide,y:0})}})}setBgColor(e){const i=this.transformer.nodes();i.forEach((r,n)=>{if(r instanceof mt.Shape){if(r instanceof pt)return;r.fill(e),r.draw(),n===i.length-1&&this.drawer.stage.fire("change")}})}setColor(e){const i=this.transformer.nodes();i.forEach((r,n)=>{r instanceof mt.Shape&&(r instanceof pt?(r.fill(e),r.stroke(e)):r instanceof Qt?r.fill(e):r.stroke(e),r.draw(),n===i.length-1&&this.drawer.stage.fire("change"))})}setStrokeWidth(e){const i=this.transformer.nodes();i.forEach((r,n)=>{r instanceof mt.Shape&&(r.strokeWidth(e),r.draw(),n===i.length-1&&this.drawer.stage.fire("change"))})}setOpacity(e){const i=this.transformer.nodes();i.forEach((r,n)=>{r instanceof mt.Shape&&(r.opacity(e),r.draw(),n===i.length-1&&this.drawer.stage.fire("change"))})}toggleSnapping(e=!0){e&&!this.snapping?(this.drawer.grid&&this.drawer.hideGrid(),this.drawer.contextMenu.$snappingBtn.classList.add("active"),this._initSnapEvents()):!e&&this.snapping&&(this._removeSnapEvents(),this.drawer.contextMenu.$snappingBtn.classList.remove("active")),this.drawer.stage.fire("change")}updateCursor(){this.drawer.$stageContainer.style.cursor="default"}}ie=new WeakMap,re=new WeakMap,Yt=new WeakMap,Xt=new WeakMap;const Xn=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE xml>
<svg width="24" height="24" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
    <path fill="currentColor"
        d="M13.5 2.4c-.4-.4-1-.5-1.5-.3c0-.3-.1-.6-.4-.9c-.2-.2-.6-.4-1.1-.4c-.3 0-.5.1-.7.1c0-.2-.1-.3-.2-.5c-.5-.6-1.5-.6-2 0c-.2.2-.4.4-.4.6C7 1 6.8.9 6.6.9c-.5 0-.8.2-1.1.5C5 1.9 5 2.7 5 2.7v3.8c-.3-.3-.8-.8-1.5-.8c-.2 0-.5.1-.7.2c-.4.2-.6.5-.7.9c-.3 1 .6 2.4.6 2.5c.1.1 1.2 2.7 2.2 3.8C5.9 14.3 7 15 9.8 15c2.9 0 4.2-1.6 4.2-5.1V4.4c0-.1.1-1.3-.5-2M8 2c0-.3-.1-1 .5-1c.5 0 .5.5.5 1v4c0 .3.2.5.5.5s.5-.2.5-.5V2.2s0-.4.5-.4c.6 0 .5.9.5.9V6c0 .3.2.5.5.5s.5-.2.5-.5V3.6c0-.1 0-.6.5-.6s.5 1 .5 1v5.9c0 3.4-1.3 4.1-3.2 4.1c-2.4 0-3.3-.5-4.1-1.6c-.9-1-2.1-3.6-2.1-3.7c-.3-.3-.7-1.2-.6-1.6c0-.1.1-.2.2-.3c.1 0 .2-.1.2-.1c.4 0 .8.5.9.7l.6.9c.1.2.4.3.6.2c.4 0 .5-.2.5-.4V2.9c0-.4 0-1 .5-1c.4 0 .5.3.5.8V6c0 .3.2.5.5.5S8 6.3 8 6z" />
</svg>
`;class Kn extends ce{constructor(e){const i=Tt(Xn);super(e,"pan","Pan",i,"h");m(this,"isGrabbing",!1);m(this,"hasMoved",!1);this.drawer=e}initEvents(){this.drawer.stage.on("mousedown touchstart",()=>{this.isGrabbing=!0,this.drawer.UIPointerEvents("none"),this.drawer.$stageContainer.style.cursor="grabbing"}),this.drawer.stage.on("mousemove touchmove",e=>{e.target!==this.drawer.stage||!this.isGrabbing||(this.hasMoved=!0,this.drawer.$stageContainer.style.cursor="grabbing")}),this.drawer.stage.on("mouseup touchend",()=>{this.hasMoved&&this.drawer.stage.fire("change"),this.isGrabbing=!1,this.drawer.UIPointerEvents("all"),this.hasMoved=!1,this.drawer.$stageContainer.style.cursor="grab"})}removeEvents(){this.drawer.stage.off("mousedown touchstart"),this.drawer.stage.off("mousemove touchmove"),this.drawer.stage.off("mouseup touchend")}onActive(){this.initEvents(),this.updateCursor(),this.drawer.stage.draggable(!0)}onDesactive(){this.removeEvents(),this.drawer.stage.draggable(!1)}updateCursor(){this.drawer.$stageContainer.style.cursor="grab"}}const jn=`<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path fill="currentColor"
        d="M5 6a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v1a1 1 0 1 1-2 0V6h-4v12h1a1 1 0 1 1 0 2h-4a1 1 0 1 1 0-2h1V6H7v1a1 1 0 0 1-2 0z" />
</svg>
`;class qn extends ce{constructor(e){super(e,"text","Text",jn,"t");Mt(this,me,void 0);m(this,"isEditing",!1)}onActive(){this.initEvents(),this.updateCursor()}onDesactive(){this.removeEvents()}addTextNode(e=""){const{x:i,y:r}=this.drawer._getRelativePointerPos(),n=this.drawer.activeTool==="selection",s=new Qt({text:e,x:i,y:r,fontFamily:"Ubuntu",fontSize:15,name:gt.text,fill:this.drawer.options.strokeColor,draggable:n,width:100});if(e){const c=e.split(`
`).toSorted((g,w)=>w.length-g.length)[0];s.width(s.measureSize(c).width)}this.addTextNodeEvents(s),this.drawer.drawLayer.add(s);const o=this.drawer.getWidget("selection");return o==null||o.setActive(!0),s}addTextNodeEvents(e){e.on("dblclick",i=>{this.editTextNode(i.target)})}initEvents(){this.drawer.stage.on("click tap",()=>{Et(this,me,this.addTextNode()),this.editTextNode(st(this,me))})}editTextNode(e){e.hide();const i=this.drawer.toolbar.getWidget("selection");i==null||i.transformer.hide();const r=this._createTextarea(e),n=e.rotation();let s="";n&&(s+="rotateZ("+n+"deg)");let o=0;navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(o+=2+Math.round(e.fontSize()/20)),s+="translateY(-"+o+"px)",r.style.transform=s,r.style.height="auto",r.style.height=r.scrollHeight+3+"px",r.focus(),this.isEditing=!0,this._initEventsTextarea(e,r)}_createTextarea(e){const i=e.absolutePosition(),r={x:this.drawer.stage.container().offsetLeft+i.x,y:this.drawer.stage.container().offsetTop+i.y+5},n=document.createElement("textarea");return this.drawer.$drawerContainer.appendChild(n),n.value=e.text(),n.style.position="absolute",n.style.top=r.y+2+"px",n.style.left=r.x+"px",n.style.width=(e.width()-e.padding()*2)*this.drawer.stage.scaleX()+"px",n.style.height=e.height()-e.padding()*2+5+"px",n.style.fontSize=e.fontSize()*this.drawer.stage.scaleX()*e.scaleX()+"px",n.style.border="none",n.style.padding="0px",n.style.margin="0px",n.style.overflow="hidden",n.style.background="none",n.style.outline="none",n.style.resize="none",n.style.zIndex="999",n.style.lineHeight=e.lineHeight().toString(),n.style.fontFamily=e.fontFamily(),n.style.transformOrigin="left top",n.style.textAlign=e.align(),n.style.color=e.fill(),n}_initEventsTextarea(e,i){const r=()=>{var o;if((o=i.parentNode)==null||o.removeChild(i),window.removeEventListener("click",n),this.isEditing=!1,this.drawer.focus(),i.value===""){e.destroy();return}e.show();const s=this.drawer.toolbar.getWidget("selection");s==null||s.transformer.show(),s==null||s.transformer.forceUpdate(),this.drawer.stage.fire("change")};i.addEventListener("keydown",s=>{i.style.height="auto",i.style.height=i.scrollHeight+e.fontSize()+"px",s.code==="Enter"&&!s.shiftKey&&(e.text(i.value),r()),s.code==="Escape"&&r()});const n=s=>{s.target!==i&&(e.text(i.value),r())};setTimeout(()=>{window.addEventListener("click",n)})}removeEvents(){this.drawer.stage.off("click tap")}updateCursor(){this.drawer.$stageContainer.style.cursor="text"}}me=new WeakMap;class Zn{constructor(t){m(this,"drawer");m(this,"$toolbarRoot");m(this,"widgets",new Map);m(this,"$toolbarContent");this.drawer=t,this.$toolbarContent=document.createElement("div"),this.$toolbarContent.classList.add("drawer-toolbar-container"),this.$toolbarRoot=document.createElement("div"),this.$toolbarRoot.classList.add("drawer-toolbar-root","tool"),this.$toolbarRoot.setAttribute("role","toolbar"),this.$toolbarContent.append(this.$toolbarRoot),this.drawer.$footerContainer.append(this.$toolbarContent),this.init()}init(){this.addWidget(new Kn(this.drawer)),this.addWidget(new Yn(this.drawer)),this.addWidget(new Ei(this.drawer)),this.addWidget(new an(this.drawer)),this.addWidget(new qn(this.drawer))}addWidget(t){this.widgets.set(t.id,t),t.addTo(this.$toolbarRoot)}setActiveWidget(t){this.drawer.activeWidget=t,this.drawer.activeTool=t.id}getWidget(t){return this.widgets.get(t)}}const Pa="",Jn=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE xml>
<svg width="24" height="24" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg">
    <path fill="currentColor"
        d="M16 4a12 12 0 1 0 12 12A12 12 0 0 0 16 4m0 21.91A10 10 0 1 1 26 16a10 10 0 0 1-10 9.91"
        class="clr-i-outline clr-i-outline-path-1" />
    <path fill="currentColor"
        d="m31.71 29.69l-5.17-5.17A13.68 13.68 0 0 1 25.15 26l5.15 5.15a1 1 0 0 0 1.41-1.41Z"
        class="clr-i-outline clr-i-outline-path-2" />
    <path fill="currentColor" d="M20 15h-8a1 1 0 0 0 0 2h8a1 1 0 0 0 0-2"
        class="clr-i-outline clr-i-outline-path-3" />
    <path fill="none" d="M0 0h36v36H0z" />
</svg>
`,Qn=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE xml>
<svg width="24" height="24" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg">
    <path fill="currentColor" d="M16 4a12 12 0 1 0 12 12A12 12 0 0 0 16 4m0 21.91A10 10 0 1 1 26 16a10 10 0 0 1-10 9.91" class="clr-i-outline clr-i-outline-path-1"/>
    <path fill="currentColor" d="m31.71 29.69l-5.17-5.17A13.68 13.68 0 0 1 25.15 26l5.15 5.15a1 1 0 0 0 1.41-1.41Z" class="clr-i-outline clr-i-outline-path-2"/>
    <path fill="currentColor" d="M21 15h-4v-4a1 1 0 0 0-2 0v4h-4a1 1 0 0 0 0 2h4v4a1 1 0 0 0 2 0v-4h4a1 1 0 0 0 0-2" class="clr-i-outline clr-i-outline-path-3"/>
    <path fill="none" d="M0 0h36v36H0z"/>
</svg>
`,Hi=`<svg width="24" height="24" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
    <path fill="currentColor"
        d="m31 29.586l-4.688-4.688a8.028 8.028 0 1 0-1.415 1.414L29.586 31zM20 26a6 6 0 1 1 6-6a6.007 6.007 0 0 1-6 6M8 26H4a2.002 2.002 0 0 1-2-2v-4h2v4h4zM2 12h2v4H2zm24-4h-2V4h-4V2h4a2.002 2.002 0 0 1 2 2zM12 2h4v2h-4zM4 8H2V4a2.002 2.002 0 0 1 2-2h4v2H4z" />
</svg>
`;class ta{constructor(t){m(this,"drawer");m(this,"$zoomContainer");m(this,"$btnMinus");m(this,"$btnReset");m(this,"$btnPlus");this.drawer=t,this.$zoomContainer=document.createElement("div"),this.$zoomContainer.classList.add("drawer-zoom-container","tool"),this.$btnMinus=document.createElement("button"),this.$btnReset=document.createElement("button"),this.$btnPlus=document.createElement("button"),this.$btnMinus.role="button",this.$btnMinus.classList.add("drawer-button","drawer-button-neutral"),this.$btnMinus.tabIndex=0,this.$btnMinus.innerHTML=Jn,this.$btnReset.role="button",this.$btnReset.classList.add("drawer-button","drawer-button-neutral","reset-zoom"),this.$btnReset.tabIndex=0,this.$btnReset.title="Reset zoom",this.$btnReset.innerHTML=Hi+this._formatPercentage(),this.$btnPlus.role="button",this.$btnPlus.classList.add("drawer-button","drawer-button-neutral"),this.$btnPlus.tabIndex=0,this.$btnPlus.innerHTML=Qn,this.$zoomContainer.append(this.$btnMinus,this.$btnReset,this.$btnPlus),this.drawer.$footerLeftElement.append(this.$zoomContainer),this.$btnMinus.addEventListener("click",()=>{this.zoomMinus()}),this.$btnReset.addEventListener("click",()=>{this.resetZoom()}),this.$btnPlus.addEventListener("click",()=>{this.zoomPlus()})}zoomMinus(){const t=this.drawer.stage.scaleX(),e={x:this.drawer.stage.width()/2,y:this.drawer.stage.height()/2},i={x:(e.x-this.drawer.stage.x())/t,y:(e.y-this.drawer.stage.y())/t},r=this.drawer.getZoomLevel()/this.drawer.options.scaling;this.drawer.stage.scale({x:r,y:r});const n={x:e.x-i.x*r,y:e.y-i.y*r};this.drawer.stage.position({x:n.x,y:n.y}),this.update()}resetZoom(){this.drawer.stage.scale({x:1,y:1}),this.drawer.stage.position({x:0,y:0}),this.update()}zoomPlus(){const t=this.drawer.stage.scaleX(),e={x:this.drawer.stage.width()/2,y:this.drawer.stage.height()/2},i={x:(e.x-this.drawer.stage.x())/t,y:(e.y-this.drawer.stage.y())/t},r=this.drawer.getZoomLevel()*this.drawer.options.scaling;this.drawer.stage.scale({x:r,y:r});const n={x:e.x-i.x*r,y:e.y-i.y*r};this.drawer.stage.position({x:n.x,y:n.y}),this.update()}update(){this.$btnReset.innerHTML=Hi+this._formatPercentage(),this.drawer._update()}_formatPercentage(){return Number(this.drawer.getZoomLevel()).toLocaleString(void 0,{style:"percent",maximumFractionDigits:0})}}const $a="",Aa="",ea={id:Date.now().toString(),showHeader:!0,bodyContent:void 0,footerContent:void 0,closeOnClickOutside:!0,closeOnEsc:!0,backdrop:!0},ia={message:"Would you confirm action ?",cancelLabel:"Cancel",confirmLabel:"Confirm",onCancel:a=>{a.hide()},onConfirm:a=>{a.drawer.clearCanvas(!0),a.hide()}},ra=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE xml>
<svg width="24" height="24" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
    <path fill="currentColor"
        d="m3.219 2.154l6.778 6.773l6.706-6.705c.457-.407.93-.164 1.119.04a.777.777 0 0 1-.044 1.035l-6.707 6.704l6.707 6.702c.298.25.298.74.059 1.014c-.24.273-.68.431-1.095.107l-6.745-6.749l-6.753 6.752c-.296.265-.784.211-1.025-.052c-.242-.264-.334-.72-.025-1.042l6.729-6.732l-6.701-6.704c-.245-.27-.33-.764 0-1.075c.33-.311.822-.268.997-.068" />
</svg>
`;class zi{constructor(t,e){m(this,"$modal");m(this,"$modalHeader");m(this,"$modalBody");m(this,"$modalFooter");m(this,"options");m(this,"drawer");m(this,"$backdrop");try{this.drawer=t,this.options={...ea,...e},this._init(),this._setupDefaultEvents()}catch(i){throw new Error(i.message)}}_init(){this._createModal(),this.options.showHeader?this.setHeaderContent(`<h2 class="drawer-modal-title">${this.options.title??"Modal"}</h2><button title="Close" class="btn-close" data-modal="close">${ra}</button>`):this.$modalHeader.remove(),this.setBodyContent(this.options.bodyContent??""),this.setFooterContent(this.options.footerContent??"")}_setupDefaultEvents(){const t=this.$modalHeader.querySelector("[data-modal=close]");t&&t.addEventListener("click",()=>{this.hide()}),this.options.closeOnClickOutside&&document.addEventListener("click",e=>{e.target&&!this.drawer.setting.$clearCanvasButton.contains(e.target)&&!this.drawer.setting.$clearStorageButton.contains(e.target)&&!this.drawer.help.$button.contains(e.target)&&!this.$modal.contains(e.target)&&this.isVisible()&&this.hide()},!1),this.options.closeOnEsc&&document.addEventListener("keydown",e=>{e.key==="Escape"&&this.isVisible()&&this.hide()})}_createModal(){this.$modal=Tt(`
    <div class="drawer-modal"></div>`),this.$modalHeader=Tt(`
      <div class="drawer-modal-header"></div>`),this.$modalBody=Tt(`
      <div class="drawer-modal-body"></div>`),this.$modalFooter=Tt(`
      <div class="drawer-modal-footer"></div>`),this.$modal.append(this.$modalHeader,this.$modalBody,this.$modalFooter),this.options.backdrop?(this.$backdrop=Tt(`
      <div class="backdrop"></div>
      `),this.$backdrop.append(this.$modal),this.drawer.$drawerContainer.append(this.$backdrop)):this.drawer.$drawerContainer.append(this.$modal)}setHeaderContent(t){t&&(this.$modalHeader.innerHTML=t)}setBodyContent(t){this.$modalBody.innerHTML=t}appendBodyContent(t){this.$modalBody.append(t)}setFooterContent(t){this.$modalFooter.innerHTML=t}show(){this.$backdrop&&this.$backdrop.classList.add("show"),this.$modal.classList.add("show")}hide(){this.$backdrop&&this.$backdrop.classList.remove("show"),this.$modal.classList.remove("show"),this.drawer.focus()}isVisible(){return this.$modal.classList.contains("show")}destroy(){this.hide(),this.$modal.remove()}}const na=`<svg width="64" height="64" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
    <path fill="currentColor"
        d="M8 15c-3.86 0-7-3.14-7-7s3.14-7 7-7s7 3.14 7 7s-3.14 7-7 7M8 2C4.69 2 2 4.69 2 8s2.69 6 6 6s6-2.69 6-6s-2.69-6-6-6" />
    <path fill="currentColor"
        d="M8 4.5c-1.11 0-2 .89-2 2h1c0-.55.45-1 1-1s1 .45 1 1c0 1-1.5.88-1.5 2.5h1c0-1.12 1.5-1.25 1.5-2.5c0-1.11-.89-2-2-2" />
    <circle cx="8" cy="11" r=".62" fill="currentColor" />
    <circle cx="6.5" cy="6.5" r=".5" fill="currentColor" />
    <circle cx="8" cy="9" r=".5" fill="currentColor" />
</svg>
`,Vi=`<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path fill="currentColor"
        d="M20 11a1 1 0 0 0-1 1v6a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h6a1 1 0 0 0 0-2H6a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3h12a3 3 0 0 0 3-3v-6a1 1 0 0 0-1-1" />
    <path fill="currentColor"
        d="M16 5h1.58l-6.29 6.28a1 1 0 0 0 0 1.42a1 1 0 0 0 1.42 0L19 6.42V8a1 1 0 0 0 1 1a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1h-4a1 1 0 0 0 0 2" />
</svg>
`;class aa extends zi{constructor(e){super(e,{title:"Help"});m(this,"$button");m(this,"$helpContainer");const i=`
    <div class="drawer-modal-help-links">
      <a class="drawer-link" href="">Documentation${Vi}</a>
      <a class="drawer-link" href="https://github.com/fabienwnklr/free-drawing/" target="_blank">Found issue ? Please inform us !${Vi}</a>
    </div>
    <h3>Keyboard shortcuts</h3>
    <div class="drawer-modal-help-grid">
      <div class="drawer-modal-help-grid-container">
        <h4>Tools</h4>
        <ul class="drawer-modal-help-shortcut-container">
            <li class="drawer-modal-help-shortcut">
              <div>
                Hand (panning tool)
              </div>
              <div>
                <kbd class="drawer-modal-help-kdb">H</kbd>
              </div>
            </li>
            <li class="drawer-modal-help-shortcut">
            Selection <kbd class="drawer-modal-help-kdb">S</kbd>
            </li>
            <li class="drawer-modal-help-shortcut">
            Brush <kbd class="drawer-modal-help-kdb">B</kbd>
            </li>
            <li class="drawer-modal-help-shortcut">
            Eraser <kbd class="drawer-modal-help-kdb">E</kbd>
            </li>
          </ul>
        </div>

        <div class="drawer-modal-help-grid-container">
          <h4>Editor</h4>
          <ul class="drawer-modal-help-shortcut-container">
            <li class="drawer-modal-help-shortcut">
              Undo
              <span>
                <kbd class="drawer-modal-help-kdb">Ctrl+Z</kbd>
            </li>
            <li class="drawer-modal-help-shortcut">
              Redo
              <span>
                <kbd class="drawer-modal-help-kdb">Ctrl+Y</kbd>
              </span>
            </li>
            <li class="drawer-modal-help-shortcut">
              Clear canvas
              <span>
                <kbd class="drawer-modal-help-kdb">Ctrl+Delete</kbd>
                or
                <kbd class="drawer-modal-help-kdb">Ctrl+Backspace</kbd>
              </span>
            </li>
            <li class="drawer-modal-help-shortcut">
              Select all
              <span>
                <kbd class="drawer-modal-help-kdb">Ctrl+A</kbd>
              </span>
            </li>
          </ul>
        </div>

        <div class="drawer-modal-help-grid-container">
          <h4>View</h4>
          <ul class="drawer-modal-help-shortcut-container">
            <li class="drawer-modal-help-shortcut">
              Zen mode
              <span>
                <kbd class="drawer-modal-help-kdb">Alt+Z</kbd>
              </span>
            </li>
          </ul>
        </div>

      </div>
    `;this.$modal.classList.add("drawer-modal-help"),this.setBodyContent(i),this.$helpContainer=document.createElement("div"),this.$helpContainer.classList.add("drawer-help-container","tool"),this.$button=document.createElement("button"),this.$button.classList.add("drawer-button","drawer-button-neutral"),this.$button.innerHTML=na,this.$helpContainer.append(this.$button),this.drawer.$footerContainer.append(this.$helpContainer),this.$button.addEventListener("click",()=>{this.show()})}}const Ra="";class sa{constructor(){m(this,"$dropdownContainer");m(this,"$button");m(this,"$menu");m(this,"$dropdownList");m(this,"$dropdownItem");this.$button=document.createElement("button"),this.$button.role="button",this.$button.classList.add("drawer-button","drawer-button-neutral","tool","drawer-button-dropdown"),this.$menu=document.createElement("div"),this.$menu.classList.add("drawer-dropdown"),this.$dropdownContainer=document.createElement("div"),this.$dropdownContainer.classList.add("drawer-dropdown-container"),this.$dropdownContainer.append(this.$button,this.$menu),this.$dropdownList=document.createElement("ul"),this.$dropdownList.classList.add("drawer-dropdown-list"),this.$dropdownItem=document.createElement("li"),this.$dropdownItem.classList.add("drawer-dropdown-list-item"),this.setContent(this.$dropdownList),this._initEvents()}setContent(t){typeof t=="string"?this.$menu.innerHTML=t:this.$menu.append(t)}show(){this.$menu.classList.add("show")}hide(){this.$menu.classList.remove("show")}_initEvents(){this.$button.addEventListener("click",()=>{this.$menu.classList.toggle("show")}),document.addEventListener("click",t=>{t.target&&(this.$button.contains(t.target)||this.hide())},!1)}}const Da="",oa=`<svg width="24" height="24" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
    <g fill="currentColor" fill-rule="evenodd" clip-rule="evenodd">
        <path d="M2.5 9.2a1 1 0 0 1 1-1h10.308a1 1 0 1 1 0 2H3.5a1 1 0 0 1-1-1m0-4a1 1 0 0 1 1-1h14a1 1 0 1 1 0 2h-14a1 1 0 0 1-1-1m0 8a1 1 0 0 1 1-1h14a1 1 0 1 1 0 2h-14a1 1 0 0 1-1-1m0 4a1 1 0 0 1 1-1h10.308a1 1 0 1 1 0 2H3.5a1 1 0 0 1-1-1" opacity=".2"/>
        <path d="M2 8.5a.5.5 0 0 1 .5-.5h11.308a.5.5 0 0 1 0 1H2.5a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h15a.5.5 0 0 1 0 1h-15a.5.5 0 0 1-.5-.5m0 8a.5.5 0 0 1 .5-.5h15a.5.5 0 0 1 0 1h-15a.5.5 0 0 1-.5-.5m0 4a.5.5 0 0 1 .5-.5h11.308a.5.5 0 0 1 0 1H2.5a.5.5 0 0 1-.5-.5"/>
    </g>
</svg>
`,ha=`<svg width="24" height="24" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
    <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"
        d="M28 11v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6c3 0 3 3 5 3h9.003C27.108 9 28 9.895 28 11Z" />
</svg>
`,la=`<svg aria-hidden="true" focusable="false" role="img" viewBox="0 0 24 24" class="" fill="none"
    stroke-width="2" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
    <g stroke-width="1.25">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
        <path d="M15 8h.01"></path>
        <path d="M12 20h-5a3 3 0 0 1 -3 -3v-10a3 3 0 0 1 3 -3h10a3 3 0 0 1 3 3v5"></path>
        <path d="M4 15l4 -4c.928 -.893 2.072 -.893 3 0l4 4"></path>
        <path d="M14 14l1 -1c.617 -.593 1.328 -.793 2.009 -.598"></path>
        <path d="M19 16v6"></path>
        <path d="M22 19l-3 3l-3 -3"></path>
    </g>
</svg>
`,da=`<svg width="24" height="24" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg">
    <path fill="currentColor"
        d="M27.14 34H8.86A2.93 2.93 0 0 1 6 31V11.23h2V31a.93.93 0 0 0 .86 1h18.28a.93.93 0 0 0 .86-1V11.23h2V31a2.93 2.93 0 0 1-2.86 3"
        class="clr-i-outline clr-i-outline-path-1" />
    <path fill="currentColor" d="M30.78 9H5a1 1 0 0 1 0-2h25.78a1 1 0 0 1 0 2"
        class="clr-i-outline clr-i-outline-path-2" />
    <path fill="currentColor" d="M21 13h2v15h-2z" class="clr-i-outline clr-i-outline-path-3" />
    <path fill="currentColor" d="M13 13h2v15h-2z" class="clr-i-outline clr-i-outline-path-4" />
    <path fill="currentColor" d="M23 5.86h-1.9V4h-6.2v1.86H13V4a2 2 0 0 1 1.9-2h6.2A2 2 0 0 1 23 4Z"
        class="clr-i-outline clr-i-outline-path-5" />
    <path fill="none" d="M0 0h36v36H0z" />
</svg>
`,ca=`<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path fill="currentColor"
        d="M8 8H4V4h4zm6-4h-4v4h4zm6 0h-4v4h4zM8 10H4v4h4zm6 0h-4v4h4zm6 0h-4v4h4zM8 16H4v4h4zm6 0h-4v4h4zm6 0h-4v4h4z" />
</svg>
`,ua=`<svg width="24" height="24" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg">
    <g fill="#181616">
        <path fill-rule="evenodd"
            d="M64 5.103c-33.347 0-60.388 27.035-60.388 60.388c0 26.682 17.303 49.317 41.297 57.303c3.017.56 4.125-1.31 4.125-2.905c0-1.44-.056-6.197-.082-11.243c-16.8 3.653-20.345-7.125-20.345-7.125c-2.747-6.98-6.705-8.836-6.705-8.836c-5.48-3.748.413-3.67.413-3.67c6.063.425 9.257 6.223 9.257 6.223c5.386 9.23 14.127 6.562 17.573 5.02c.542-3.903 2.107-6.568 3.834-8.076c-13.413-1.525-27.514-6.704-27.514-29.843c0-6.593 2.36-11.98 6.223-16.21c-.628-1.52-2.695-7.662.584-15.98c0 0 5.07-1.623 16.61 6.19C53.7 35 58.867 34.327 64 34.304c5.13.023 10.3.694 15.127 2.033c11.526-7.813 16.59-6.19 16.59-6.19c3.287 8.317 1.22 14.46.593 15.98c3.872 4.23 6.215 9.617 6.215 16.21c0 23.194-14.127 28.3-27.574 29.796c2.167 1.874 4.097 5.55 4.097 11.183c0 8.08-.07 14.583-.07 16.572c0 1.607 1.088 3.49 4.148 2.897c23.98-7.994 41.263-30.622 41.263-57.294C124.388 32.14 97.35 5.104 64 5.104z"
            clip-rule="evenodd" />
        <path
            d="M26.484 91.806c-.133.3-.605.39-1.035.185c-.44-.196-.685-.605-.543-.906c.13-.31.603-.395 1.04-.188c.44.197.69.61.537.91zm2.446 2.729c-.287.267-.85.143-1.232-.28c-.396-.42-.47-.983-.177-1.254c.298-.266.844-.14 1.24.28c.394.426.472.984.17 1.255zm2.382 3.477c-.37.258-.976.017-1.35-.52c-.37-.538-.37-1.183.01-1.44c.373-.258.97-.025 1.35.507c.368.545.368 1.19-.01 1.452zm3.261 3.361c-.33.365-1.036.267-1.552-.23c-.527-.487-.674-1.18-.343-1.544c.336-.366 1.045-.264 1.564.23c.527.486.686 1.18.333 1.543zm4.5 1.951c-.147.473-.825.688-1.51.486c-.683-.207-1.13-.76-.99-1.238c.14-.477.823-.7 1.512-.485c.683.206 1.13.756.988 1.237m4.943.361c.017.498-.563.91-1.28.92c-.723.017-1.308-.387-1.315-.877c0-.503.568-.91 1.29-.924c.717-.013 1.306.387 1.306.88zm4.598-.782c.086.485-.413.984-1.126 1.117c-.7.13-1.35-.172-1.44-.653c-.086-.498.422-.997 1.122-1.126c.714-.123 1.354.17 1.444.663zm0 0" />
    </g>
</svg>
`,ga=`<svg width="24" height="24" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
    <path stroke-width="3px" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="M24.061 23.795s-5.093 13.721-9.147 13.721c-3.535 0-4.886-3.222-5.198-8.94c-.208-2.286 6.237-4.573 6.237-4.573s-8.42.831-8.836-.624c-2.183-7.588-4.782-13.098.416-12.89c10.811.312 16.528 13.306 16.528 13.306m0 0s5.094 13.721 9.148 13.721c3.534 0 4.886-3.222 5.198-8.94c.104-2.286-6.341-4.573-6.341-4.573s8.42.831 8.836-.624c2.183-7.588 4.781-12.994-.52-12.89c-10.603.312-16.32 13.306-16.32 13.306"/>
</svg>
`,fa=`<svg width="24" height="24" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
    <circle cx="10" cy="28" r="2" fill="currentColor" />
    <circle cx="24" cy="28" r="2" fill="currentColor" />
    <path fill="currentColor"
        d="M4.98 2.804A1 1 0 0 0 4 2H0v2h3.18l3.84 19.196A1 1 0 0 0 8 24h18v-2H8.82l-.8-4H26a1 1 0 0 0 .976-.783L29.244 7h-2.047l-1.999 9H7.62Z" />
    <path fill="currentColor"
        d="M18.41 8L22 4.41L20.59 3L17 6.59L13.41 3L12 4.41L15.59 8L12 11.59L13.41 13L17 9.41L20.59 13L22 11.59z" />
</svg>
`;class pa extends sa{constructor(e){super();m(this,"drawer");m(this,"$exportButton");m(this,"$openButton");m(this,"$clearCanvasButton");m(this,"$toggleGridButton");m(this,"$githubButton");m(this,"$zenModeButton");m(this,"$clearStorageButton");m(this,"$bgColorContainer");m(this,"$bgColorBtnContainer");this.drawer=e,this.$dropdownContainer.classList.add("drawer-dropdown-setting"),this.$button.innerHTML=oa,this.$openButton=document.createElement("button"),this.$openButton.classList.add("drawer-button","drawer-button-neutral","drawer-dropdown-list-item"),this.$openButton.innerHTML=ha+"Open",this.$openButton.role="button",this.$exportButton=document.createElement("button"),this.$exportButton.classList.add("drawer-button","drawer-button-neutral","drawer-dropdown-list-item"),this.$exportButton.innerHTML=la+"Export to...",this.$exportButton.role="button",this.$clearCanvasButton=document.createElement("button"),this.$clearCanvasButton.classList.add("drawer-button","drawer-button-neutral","drawer-dropdown-list-item"),this.$clearCanvasButton.innerHTML=da+"Clear canvas",this.$clearCanvasButton.role="button",this.$toggleGridButton=document.createElement("button"),this.$toggleGridButton.classList.add("drawer-button","drawer-button-neutral","drawer-dropdown-list-item"),this.$toggleGridButton.innerHTML=ca+"Show grid",this.$toggleGridButton.role="button",this.$zenModeButton=document.createElement("button"),this.$zenModeButton.classList.add("drawer-button","drawer-button-neutral","drawer-dropdown-list-item"),this.$zenModeButton.innerHTML=ga+'Zen mode <span class="text-muted">Altr+Z</span>',this.$zenModeButton.role="button",this.$githubButton=document.createElement("button"),this.$githubButton.classList.add("drawer-button","drawer-button-neutral","drawer-dropdown-list-item"),this.$githubButton.innerHTML=ua+"Github",this.$githubButton.role="button",this.$clearStorageButton=document.createElement("button"),this.$clearStorageButton.classList.add("drawer-button","drawer-button-neutral","drawer-dropdown-list-item"),this.$clearStorageButton.innerHTML=fa+"Clear stored data",this.$clearStorageButton.role="button",this.$bgColorContainer=document.createElement("div"),this.$bgColorContainer.classList.add("color-picker-container");const i=document.createElement("h6");i.classList.add("title"),i.innerText="Background color",this.$bgColorContainer.append(i),this.$bgColorBtnContainer=document.createElement("div"),this.$bgColorBtnContainer.classList.add("color-picker-btn-container");const r=[];["#fff","#f8f9fa","#f5faff","#fffce8","#fdf8f6"].forEach(s=>{const o=document.createElement("button");o.classList.add("color-picker__button"),o.style.backgroundColor=s,o.addEventListener("click",()=>{var l;(l=this.$bgColorBtnContainer.querySelector(".color-picker__button.active"))==null||l.classList.remove("active"),o.classList.add("active"),this.drawer.setBgColor(s),this.drawer.focus()}),this.drawer.options.strokeColor===s&&o.classList.add("active"),r.push(o)}),this.$bgColorBtnContainer.append(...r),this.$bgColorContainer.append(this.$bgColorBtnContainer),this.$dropdownList.append(this.$clearCanvasButton,this.$toggleGridButton,this.$zenModeButton,this.$githubButton,this.getSeparator(),this.$clearStorageButton,this.getSeparator(),this.$bgColorContainer),this.drawer.$drawerContainer.append(this.$dropdownContainer),this.initEvents()}getSeparator(){return document.createElement("hr")}initEvents(){this.$clearCanvasButton.addEventListener("click",()=>{this.drawer.clearCanvas()}),this.$toggleGridButton.addEventListener("click",()=>{this.toggleGrid()}),this.$zenModeButton.addEventListener("click",()=>{this.toggleZenMode()}),this.$githubButton.addEventListener("click",()=>{window.open("https://github.com/fabienwnklr/free-drawing","blank")}),this.$clearStorageButton.addEventListener("click",()=>{this.drawer.clearStoredData()})}toggleZenMode(){this.$zenModeButton.classList.toggle("active"),this.$zenModeButton.classList.contains("active")?(this.drawer.zoom&&(this.drawer.zoom.$zoomContainer.style.display="none"),this.drawer.help.$helpContainer.style.display="none",this.drawer.undoRedo.$undoRedoContainer.style.display="none"):(this.drawer.zoom&&(this.drawer.zoom.$zoomContainer.style.display=""),this.drawer.help.$helpContainer.style.display="",this.drawer.undoRedo.$undoRedoContainer.style.display="")}toggleSnapping(){const e=this.drawer.getWidget("selection"),i=!(e!=null&&e.snapping);e==null||e.toggleSnapping(i),this.drawer.focus()}toggleGrid(){this.drawer.grid?this.drawer.hideGrid():this.drawer.showGrid(),this.drawer.focus(),this.drawer.stage.fire("change")}}function Je(a,t){a.split(/\s+/).forEach(e=>{t(e)})}class va{constructor(){m(this,"_events",{});this._events={}}on(t,e){Je(t,i=>{const r=this._events[i]||[];r.push(e),this._events[i]=r})}off(t,e){const i=arguments.length;if(i===0){this._events={};return}Je(t,r=>{if(i===1){delete this._events[r];return}const n=this._events[r];n!==void 0&&(n.splice(n.indexOf(e),1),this._events[r]=n)})}trigger(t,...e){Je(t,i=>{const r=this._events[i];r!==void 0&&r.forEach(n=>{n.apply(this,e)})})}}const Ma="";class Wi extends zi{constructor(e,i={}){super(e,{showHeader:!1});m(this,"drawer");m(this,"$cancelBtn");m(this,"$confirmBtn");m(this,"message");m(this,"cancelLabel");m(this,"onCancel");m(this,"confirmLabel");m(this,"onConfirm");m(this,"_options");this.$modal.classList.add("drawer-modal-confirm"),this._options=ze(ia,i),this.drawer=e,this.message=this._options.message,this.cancelLabel=this._options.cancelLabel,this.onCancel=this._options.onCancel,this.confirmLabel=this._options.confirmLabel,this.onConfirm=this._options.onConfirm,this.fill(),this._setupElements(),this._initEvents()}fill(){this.setBodyContent(`<p class="p-2">${this.message}</p>`),this.setFooterContent(`<div class="drawer-button drawer-button-neutral">${this.cancelLabel}</div><div class="drawer-button drawer-button-danger">${this.confirmLabel}</div>`)}_setupElements(){this.$cancelBtn=this.$modalFooter.querySelector(".drawer-button-neutral"),this.$confirmBtn=this.$modalFooter.querySelector(".drawer-button-danger")}_initEvents(){var e,i;(e=this.$cancelBtn)==null||e.addEventListener("click",()=>{this.onCancel(this)}),(i=this.$confirmBtn)==null||i.addEventListener("click",()=>{this.onConfirm(this)})}}class ma{constructor(t){m(this,"appHistory",[[]]);m(this,"appHistoryStep",0);m(this,"drawer");this.drawer=t}saveState(){const e=this.drawer.getDrawingShapes().map(i=>({type:i.className,...i.attrs}));this.appHistory=this.appHistory.slice(0,this.appHistoryStep+1),this.appHistory=this.appHistory.concat([e]),this.appHistoryStep+=1}canUndo(){return!!this.appHistory[this.appHistoryStep-1]}undo(){try{const t=this.appHistory[this.appHistoryStep-1];if(t){const e=this.drawer.getWidget("selection");e==null||e.transformer.nodes([]),this.appHistoryStep-=1,this.drawer.getDrawingShapes().forEach(i=>i.destroy()),t.forEach(i=>{if(i.type==="Line"){const r=new pt(i);r.draggable(!0),r.on("dragend",()=>{this.drawer.stage.fire("change")}),this.drawer.drawLayer.add(r)}i.type==="Text"&&this.drawer.drawLayer.add(new Qt(i))})}}catch(t){throw new Error(t.message)}}canRedo(){return!!this.appHistory[this.appHistoryStep+1]}redo(){try{const t=this.appHistory[this.appHistoryStep+1];if(t){const e=this.drawer.getWidget("selection");e==null||e.transformer.nodes([]),this.appHistoryStep+=1,this.drawer.getDrawingShapes().forEach(i=>i.destroy()),t.forEach(i=>{i.type==="Line"&&this.drawer.drawLayer.add(new pt(i)),i.type==="Text"&&this.drawer.drawLayer.add(new Qt(i))})}}catch(t){throw new Error(t.message)}}}const ya=`<svg width="24" height="24" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg">
    <path fill="currentColor"
        d="M20.87 11.14h-13l5.56-5.49A1 1 0 0 0 12 4.22l-8 7.91L12 20a1 1 0 0 0 1.41-1.42l-5.55-5.44h13a9.08 9.08 0 0 1 9.13 9a9 9 0 0 1-5 8a1 1 0 0 0 .94 1.86a11 11 0 0 0-5.06-20.82Z"
        class="clr-i-outline clr-i-outline-path-1" />
    <path fill="none" d="M0 0h36v36H0z" />
</svg>
`,wa=`<svg width="24" height="24" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg">
    <path fill="currentColor"
        d="M24 4.22a1 1 0 0 0-1.41 1.42l5.56 5.49h-13A11 11 0 0 0 10.07 32a1 1 0 0 0 .93-1.82a9 9 0 0 1-5-8a9.08 9.08 0 0 1 9.13-9h13l-5.54 5.48A1 1 0 0 0 24 20l8-7.91Z"
        class="clr-i-outline clr-i-outline-path-1" />
    <path fill="none" d="M0 0h36v36H0z" />
</svg>
`,Oa="";function Yi(a){a.ariaDisabled="true",a.classList.add("disabled"),a instanceof HTMLButtonElement&&(a.disabled=!0)}function Xi(a){a.removeAttribute("aria-disabled"),a.classList.remove("disabled"),a instanceof HTMLButtonElement&&(a.disabled=!1)}class _a extends ma{constructor(e){super(e);m(this,"$undoRedoContainer");m(this,"$btnUndo");m(this,"$btnRedo");this.$undoRedoContainer=document.createElement("div"),this.$undoRedoContainer.classList.add("drawer-undoredo-container","tool"),this.$btnUndo=document.createElement("button"),this.$btnUndo.role="button",this.$btnUndo.classList.add("drawer-button","drawer-button-neutral"),this.$btnUndo.tabIndex=0,this.$btnUndo.innerHTML=ya,this.$btnRedo=document.createElement("button"),this.$btnRedo.role="button",this.$btnRedo.classList.add("drawer-button","drawer-button-neutral"),this.$btnRedo.tabIndex=0,this.$btnRedo.innerHTML=wa,this.$undoRedoContainer.append(this.$btnUndo,this.$btnRedo),this.drawer.$footerLeftElement.append(this.$undoRedoContainer),this._initEvents()}_initEvents(){this.$btnUndo.addEventListener("click",()=>{this.undo(),this.manageButtons()}),this.$btnRedo.addEventListener("click",()=>{this.redo(),this.manageButtons()})}manageUndoBtn(){this.canUndo()?Xi(this.$btnUndo):(this.$btnUndo.ariaDisabled="true",Yi(this.$btnUndo))}manageRedoBtn(){this.canRedo()?Xi(this.$btnRedo):Yi(this.$btnRedo)}manageButtons(){this.manageUndoBtn(),this.manageRedoBtn()}}const Ga="";class ba{constructor(t){m(this,"drawer");m(this,"currentShape",null);m(this,"$menu");m(this,"$list");m(this,"$pasteBtn");m(this,"$snappingBtn");m(this,"$gridBtn");m(this,"$lockShapeBtn");m(this,"focusedShape",null);this.drawer=t,this.$menu=document.createElement("div"),this.$menu.classList.add("drawer-context-menu"),this.$list=document.createElement("ul"),this.$pasteBtn=document.createElement("button"),this.$pasteBtn.classList.add("drawer-button","drawer-button-neutral","drawer-context-menu-list-item"),this.$pasteBtn.innerHTML='<span class="drawer-context-menu-item__label">Paste</span><kbd class="drawer-context-menu-item__shortcut">Ctrl+V</kbd>',this.$pasteBtn.role="button",this.$snappingBtn=document.createElement("button"),this.$snappingBtn.classList.add("drawer-button","drawer-button-neutral","drawer-context-menu-list-item"),this.$snappingBtn.innerHTML='<span class="drawer-context-menu-item__label">Snap to object</span><kbd class="drawer-context-menu-item__shortcut">Alt+S</kbd>',this.$snappingBtn.role="button",this.$gridBtn=document.createElement("button"),this.$gridBtn.classList.add("drawer-button","drawer-button-neutral","drawer-context-menu-list-item"),this.$gridBtn.innerHTML='<span class="drawer-context-menu-item__label">Show grid</span><kbd class="drawer-context-menu-item__shortcut">Alt+G</kbd>',this.$gridBtn.role="button",this.$lockShapeBtn=document.createElement("button"),this.$lockShapeBtn.classList.add("drawer-button","drawer-button-neutral","drawer-context-menu-list-item"),this.$lockShapeBtn.innerHTML='<span class="drawer-context-menu-item__label">Lock</span><kbd class="drawer-context-menu-item__shortcut"></kbd>',this.$lockShapeBtn.role="button",this.$list.append(this.$pasteBtn,this.$snappingBtn,this.$gridBtn),this.$menu.append(this.$list),this.drawer.$drawerContainer.append(this.$menu),this._initEvents()}_initEvents(){window.addEventListener("click",()=>{this.hide()}),this.$menu.addEventListener("contextmenu",t=>{t.preventDefault()}),this.$pasteBtn.addEventListener("click",async()=>{const t=await navigator.clipboard.readText(),e=this.drawer.getWidget("text");e==null||e.addTextNode(t)}),this.$snappingBtn.addEventListener("click",()=>{this.drawer.setting.toggleSnapping()}),this.$gridBtn.addEventListener("click",()=>{this.drawer.setting.toggleGrid()}),this.$lockShapeBtn.addEventListener("click",()=>{var t;(t=this.focusedShape)==null||t.listening(!1)}),this.drawer.stage.on("contextmenu",t=>{t.evt.preventDefault();const e=this.drawer.$drawerContainer,{left:i,top:r}=e.getBoundingClientRect(),n=this.drawer._getPointerPos().x-i,s=this.drawer._getPointerPos().y-r,o=n+this.$menu.clientWidth>e.clientWidth,l=s+this.$menu.clientHeight>e.clientHeight;let c=this.drawer._getPointerPos().x,g=this.drawer._getPointerPos().y;o&&(c=i+e.clientWidth-this.$menu.clientWidth-4),l&&(g=r+e.clientHeight-this.$menu.clientHeight-4),this.$menu.style.top=g+"px",this.$menu.style.left=c+"px",this.show()})}show(){this.$menu.classList.add("show")}hide(){this.$menu.classList.remove("show")}}const Fa="";class Ca{constructor(t,e,i="neutral",r=3e3){m(this,"$toastContainer");m(this,"timeout",3e3);this.timeout=r,this.$toastContainer=document.createElement("div"),this.$toastContainer.classList.add("drawer-toast",i),this.$toastContainer.innerHTML=e,t.$drawerContainer.append(this.$toastContainer)}show(){this.$toastContainer.classList.add("show"),this.timeout&&setTimeout(()=>{this.hide()},this.timeout)}hide(){this.$toastContainer.addEventListener("animationend",()=>{this.$toastContainer.classList.remove("show","hide"),this.$toastContainer.classList.remove()}),this.$toastContainer.classList.add("hide")}destroy(){this.$toastContainer.remove()}}class Sa extends va{constructor(e,i={}){super();m(this,"$el");m(this,"$drawerContainer");m(this,"$stageContainer");m(this,"stage");m(this,"gridLayer");m(this,"drawLayer");m(this,"selectionLayer");m(this,"toolbar");m(this,"activeTool","brush");m(this,"activeWidget");m(this,"options");m(this,"background");m(this,"zoom");m(this,"help");m(this,"setting");m(this,"$clearConfirmModal",null);m(this,"$clearStoredConfirmModal",null);m(this,"debug",!1);m(this,"undoRedo");m(this,"$footerContainer");m(this,"$footerLeftElement");m(this,"contextMenu");m(this,"grid",!1);m(this,"bgLayer");this.$el=e,this.options=ze(mi,i),this.$drawerContainer=document.createElement("div"),this.$drawerContainer.classList.add("drawer-container"),this.$drawerContainer.tabIndex=1,this.$el.replaceChildren(this.$drawerContainer);const r=this.options.width,n=this.options.height;let s=this.options.tool??"brush";r===window.innerWidth&&n===window.innerHeight&&this.$drawerContainer.classList.add("is-full");const o=localStorage.getItem(this.options.localStorageKey),l=localStorage.getItem(this.options.localStorageKey+"-tool");o?(this.stage=ni.create(o,this.$drawerContainer),this.stage.width(r),this.stage.height(n),this.bgLayer=this.stage.findOne(".background"),this.gridLayer=this.stage.findOne(".grid"),this.drawLayer=this.stage.findOne(".draw"),this.selectionLayer=this.stage.findOne(".selection"),this.background=this.bgLayer.findOne("."+gt.background),this.grid=this.gridLayer.children.length>0,s=l??s):(this.stage=new se.Stage({container:this.$drawerContainer,width:r,height:n}),this.bgLayer=new de({name:"background"}),this.gridLayer=new de({name:"grid"}),this.drawLayer=new de({name:" draw"}),this.selectionLayer=new de({name:"selection"}),this.background=new Le({fill:"#fff",width:this.stage.width()*100,height:this.stage.height()*100,listening:!1,name:gt.background}),this.bgLayer.add(this.background),this.stage.add(this.bgLayer),this.stage.add(this.gridLayer),this.stage.add(this.drawLayer),this.stage.add(this.selectionLayer)),this.$stageContainer=this.stage.content,this.$footerContainer=document.createElement("footer"),this.$footerContainer.classList.add("drawer-footer-container"),this.$footerLeftElement=document.createElement("div"),this.$footerLeftElement.classList.add("drawer-footer-left"),this.$footerContainer.append(this.$footerLeftElement),this.contextMenu=new ba(this),this.setting=new pa(this),this.options.zoomWidget&&(this.zoom=new ta(this)),this.undoRedo=new _a(this),this.toolbar=new Zn(this),this.help=new aa(this),this.grid&&this.showGrid();const c=this.getWidget(s);if(c==null||c.setActive(!0),o){const g=this.getWidget("text");this.drawLayer.find(".text").forEach(w=>{w instanceof Qt&&(g==null||g.addTextNodeEvents(w))})}this.$drawerContainer.appendChild(this.$footerContainer),this.focus(),this.undoRedo.manageButtons(),this._initEvents()}getZoomLevel(){return this.stage.scaleX()}getDrawingShapes(){return[...this.drawLayer.children]}getDrawingShapeByName(e){return this.drawLayer.children.filter(i=>{if(i.hasName(gt[e]))return i})}_getRelativePointerPos(){const{x:e,y:i}=this.stage.getRelativePointerPosition()??{x:0,y:0};return{x:e,y:i}}_getPointerPos(){const{x:e,y:i}=this.stage.getPointerPosition()??{x:0,y:0};return{x:e,y:i}}_update(){this.grid&&this._drawLines(),this.bgLayer.position({x:-this._unScale(this.stage.position().x),y:-this._unScale(this.stage.position().y)})}_initEvents(){this._initHotKey(),this._initZoomWheel(),this.stage.on("dragmove",()=>{this._update()}),this.stage.on("wheel",()=>{this._update()}),this.stage.on("change",()=>{this.options.autoSave&&this.save(),this.undoRedo.saveState(),this.undoRedo.manageButtons(),this.trigger("change",this)})}_initHotKey(){this.$drawerContainer.addEventListener("keydown",i=>{if(this._duringAction())return;const r=this.getWidget("selection");if(i.key==="Backspace"||i.key==="Delete"){const s=r==null?void 0:r.transformer.nodes();s&&(s.forEach(o=>o.destroy()),r==null||r.transformer.nodes([]),r==null||r.overlay.hide(),this.activeWidget instanceof Ei&&this.activeWidget.overlay.show(),this.stage.fire("change"))}i.ctrlKey&&i.key==="a"&&(r==null||r.selectAll()),r!=null&&r.transformer.nodes().length&&(r==null||r.transformer.nodes().forEach(s=>{if(i.key==="ArrowLeft")s.x(s.x()-4);else if(i.key==="ArrowUp")s.y(s.y()-4);else if(i.key==="ArrowRight")s.x(s.x()+4);else if(i.key==="ArrowDown")s.y(s.y()+4);else return}),i.preventDefault());const n=this.getWidget("pan");if(!i.altKey&&i.key==="s"){if(this._duringAction())return;r==null||r.setActive(!0),r==null||r.$button.focus();return}if(i.key==="h"){if(this._duringAction())return;n==null||n.setActive(!0),n==null||n.$button.focus();return}if(i.altKey&&i.key==="s"&&this.setting.toggleSnapping(),i.key==="b"){if(this._duringAction())return;const s=this.getWidget("brush");s==null||s.setActive(!0),s==null||s.$button.focus();return}if(i.key==="e"){if(this._duringAction())return;const s=this.getWidget("eraser");s==null||s.setActive(!0),s==null||s.$button.focus()}if(i.key==="t"){if(this._duringAction())return;const s=this.getWidget("text");s==null||s.setActive(!0),s==null||s.$button.focus()}i.altKey&&i.key==="z"&&this.setting.toggleZenMode(),i.altKey&&i.key==="z"&&this.setting.toggleSnapping(),i.ctrlKey&&i.key==="Delete"&&this.clearCanvas(),i.ctrlKey&&i.key==="z"&&this.undoRedo.undo(),i.ctrlKey&&i.key==="y"&&this.undoRedo.redo(),i.altKey&&i.key==="g"&&this.setting.toggleGrid()})}getWidget(e){return this.toolbar.getWidget(e)}_duringAction(){const e=this.getWidget("eraser"),i=this.getWidget("brush"),r=this.getWidget("selection"),n=this.getWidget("text");return!!(e!=null&&e.isErasing||r!=null&&r.isSelecting||i!=null&&i.isPaint||n!=null&&n.isEditing)}_initZoomWheel(){this.options.zoom&&this.stage.on("wheel",e=>{var c;if(!e.evt.ctrlKey)return;e.evt.preventDefault();const i=this.stage.scaleX(),r=this._getRelativePointerPos(),n={x:(r.x-this.stage.x())/i,y:(r.y-this.stage.y())/i};let o=(e.evt.deltaY>0?-1:1)>0?i*this.options.scaling:i/this.options.scaling;o<=.1?o=.1:o>=30&&(o=30),this.stage.scale({x:o,y:o});const l={x:r.x-n.x*o,y:r.y-n.y*o};this.stage.position(l),(c=this.zoom)==null||c.update()})}save(){localStorage.setItem(this.options.localStorageKey,this.stage.toJSON()),localStorage.setItem(this.options.localStorageKey+"-tool",this.activeTool)}setBgColor(e){this.background.fill(e);const i=this.getWidget("selection");i!=null&&i.transformer.nodes().length&&(i==null||i.setBgColor(e)),this.stage.fire("change")}setColor(e){this.options.strokeColor=e;const i=this.getWidget("selection");i!=null&&i.transformer.nodes().length&&(i==null||i.setColor(e))}setStrokeWidth(e){e=Number(e),this.options.strokeWidth=e;const i=this.getWidget("selection");i!=null&&i.transformer.nodes().length&&(i==null||i.setStrokeWidth(e))}setOpacity(e){this.options.opacity=e;const i=this.getWidget("selection");i!=null&&i.transformer.nodes().length&&(i==null||i.setOpacity(e))}toast(e,i){const r=new Ca(this,e,i);return r.show(),r}UIPointerEvents(e){document.getElementsByTagName("html")[0].style.setProperty("--drawer-pointer-events",e)}clearCanvas(e=!1){if(!e)this.$clearConfirmModal||(this.$clearConfirmModal=new Wi(this,{message:"Are you sure to remove all canvas draw ?"})),this.$clearConfirmModal.show();else{const i=this.getDrawingShapes();i&&i.forEach((r,n)=>{r.destroy(),n===i.length-1&&this.stage.fire("change")})}}clearStoredData(e=!1){e?localStorage.removeItem(this.options.localStorageKey):(this.$clearStoredConfirmModal||(this.$clearStoredConfirmModal=new Wi(this,{message:"Are you sure to remove all stored data ?",onConfirm:i=>{localStorage.removeItem(this.options.localStorageKey),i.hide()}})),this.$clearStoredConfirmModal.show())}showGrid(){this.grid=!0,this.contextMenu.$gridBtn.classList.add("active"),this.setting.$toggleGridButton.classList.add("active"),this._drawLines(),this._initSnapGridEvents();const e=this.getWidget("selection");e!=null&&e.snapping&&e.toggleSnapping(!1)}_initSnapGridEvents(){const e=this.getWidget("selection"),i=40;this.drawLayer.on("dragmove",n=>{if(n.target instanceof mt.Shape){if(n.target instanceof pt)return;n.target.position({x:Math.round(n.target.x()/i)*i,y:Math.round(n.target.y()/i)*i})}}),e==null||e.transformer.anchorDragBoundFunc((n,s)=>e.transformer.getActiveAnchor()==="rotater"||!this.grid||Math.sqrt(Math.pow(s.x-n.x,2)+Math.pow(s.y-n.y,2))>10?s:r(n,s));function r(n,s){if(Math.sqrt(Math.pow(s.x-n.x,2)+Math.pow(s.y-n.y,2))>10)return s;const l=Math.round(s.x/i)*i,c=Math.abs(s.x-l),g=Math.round(s.y/i)*i,w=Math.abs(s.y-g),y=c<10,x=w<10;return y&&!x?{x:l,y:n.y}:x&&!y?{x:n.x,y:g}:y&&x?{x:l,y:g}:s}e==null||e.transformer.rotationSnaps([0,90,180,270])}_removeSnapGridEvents(){const e=this.getWidget("selection");e==null||e.transformer.anchorDragBoundFunc(void 0),e==null||e.transformer.rotationSnaps(void 0),this.drawLayer.off("dragmove")}_unScale(e){return e/this.getZoomLevel()}_drawLines(){this.gridLayer.clear(),this.gridLayer.removeChildren(),this.gridLayer.clipWidth(0);const e=40,i={x1:0,y1:0,x2:this.stage.width(),y2:this.stage.height(),offset:{x:this._unScale(this.stage.position().x),y:this._unScale(this.stage.position().y)}},r={x1:-i.offset.x,y1:-i.offset.y,x2:this._unScale(this.stage.width())-i.offset.x,y2:this._unScale(this.stage.height())-i.offset.y},n={x:Math.ceil(this._unScale(this.stage.position().x)/e)*e,y:Math.ceil(this._unScale(this.stage.position().y)/e)*e},s={x1:-n.x,y1:-n.y,x2:this._unScale(this.stage.width())-n.x+e,y2:this._unScale(this.stage.height())-n.y+e},o={x1:Math.min(i.x1,s.x1),y1:Math.min(i.y1,s.y1),x2:Math.max(i.x2,s.x2),y2:Math.max(i.y2,s.y2)};this.gridLayer.clip({x:r.x1,y:r.y1,width:r.x2-r.x1,height:r.y2-r.y1});const l=o.x2-o.x1,c=o.y2-o.y1,g=Math.round(l/e),w=Math.round(c/e);for(let y=0;y<=g;y++)this.gridLayer.add(new pt({x:o.x1+y*e,y:o.y1,points:[0,0,0,c],stroke:"rgba(0, 0, 0, 0.2)",strokeWidth:1,dash:[3,3],name:gt.gridLine}));for(let y=0;y<=w;y++)this.gridLayer.add(new pt({x:o.x1,y:o.y1+y*e,points:[0,0,l,0],stroke:"rgba(0, 0, 0, 0.2)",strokeWidth:1,dash:[3,3],name:gt.gridLine}))}hideGrid(){this.grid=!1,this.setting.$toggleGridButton.classList.remove("active"),this.contextMenu.$gridBtn.classList.remove("active"),this.gridLayer.clear(),this.gridLayer.removeChildren(),this._removeSnapGridEvents()}focus(){this.$drawerContainer.focus()}resetDraw(){this.options=mi}}return J.Drawer=Sa,Object.defineProperty(J,Symbol.toStringTag,{value:"Module"}),J}({});
